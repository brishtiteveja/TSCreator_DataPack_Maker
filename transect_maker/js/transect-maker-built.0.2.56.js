// ┌────────────────────────────────────────────────────────────────────┐ \\
// │ Raphaël 2.1.1 - JavaScript Vector Library                          │ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright © 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)    │ \\
// │ Copyright © 2008-2012 Sencha Labs (http://sencha.com)              │ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Licensed under the MIT (http://raphaeljs.com/license.html) license.│ \\
// └────────────────────────────────────────────────────────────────────┘ \\
// Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
// 
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
// 
// http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
// ┌────────────────────────────────────────────────────────────┐ \\
// │ Eve 0.4.2 - JavaScript Events Library                      │ \\
// ├────────────────────────────────────────────────────────────┤ \\
// │ Author Dmitry Baranovskiy (http://dmitry.baranovskiy.com/) │ \\
// └────────────────────────────────────────────────────────────┘ \\

// ┌─────────────────────────────────────────────────────────────────────┐ \\
// │ "Raphaël 2.1.0" - JavaScript Vector Library                         │ \\
// ├─────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\
// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\
// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\
// └─────────────────────────────────────────────────────────────────────┘ \\

// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\

// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\

// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\

/*
		PolyK library
		url: http://polyk.ivank.net
		Released under MIT licence.
		
		Copyright (c) 2012 Ivan Kuckir

		Permission is hereby granted, free of charge, to any person
		obtaining a copy of this software and associated documentation
		files (the "Software"), to deal in the Software without
		restriction, including without limitation the rights to use,
		copy, modify, merge, publish, distribute, sublicense, and/or sell
		copies of the Software, and to permit persons to whom the
		Software is furnished to do so, subject to the following
		conditions:

		The above copyright notice and this permission notice shall be
		included in all copies or substantial portions of the Software.

		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
		EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
		OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
		NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
		HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
		WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
		FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
		OTHER DEALINGS IN THE SOFTWARE.
	*/

/*!

JSZip - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

(function(e){var t="0.4.2",n="hasOwnProperty",r=/[\.\/]/,i="*",s=function(){},o=function(e,t){return e-t},u,a,f={n:{}},l=function(e,t){e=String(e);var n=f,r=a,i=Array.prototype.slice.call(arguments,2),s=l.listeners(e),c=0,h=!1,p,d=[],v={},m=[],g=u,y=[];u=e,a=0;for(var b=0,w=s.length;b<w;b++)"zIndex"in s[b]&&(d.push(s[b].zIndex),s[b].zIndex<0&&(v[s[b].zIndex]=s[b]));d.sort(o);while(d[c]<0){p=v[d[c++]],m.push(p.apply(t,i));if(a)return a=r,m}for(b=0;b<w;b++){p=s[b];if("zIndex"in p)if(p.zIndex==d[c]){m.push(p.apply(t,i));if(a)break;do{c++,p=v[d[c]],p&&m.push(p.apply(t,i));if(a)break}while(p)}else v[p.zIndex]=p;else{m.push(p.apply(t,i));if(a)break}}return a=r,u=g,m.length?m:null};l._events=f,l.listeners=function(e){var t=e.split(r),n=f,s,o,u,a,l,c,h,p,d=[n],v=[];for(a=0,l=t.length;a<l;a++){p=[];for(c=0,h=d.length;c<h;c++){n=d[c].n,o=[n[t[a]],n[i]],u=2;while(u--)s=o[u],s&&(p.push(s),v=v.concat(s.f||[]))}d=p}return v},l.on=function(e,t){e=String(e);if(typeof t!="function")return function(){};var n=e.split(r),i=f;for(var o=0,u=n.length;o<u;o++)i=i.n,i=i.hasOwnProperty(n[o])&&i[n[o]]||(i[n[o]]={n:{}});i.f=i.f||[];for(o=0,u=i.f.length;o<u;o++)if(i.f[o]==t)return s;return i.f.push(t),function(e){+e==+e&&(t.zIndex=+e)}},l.f=function(e){var t=[].slice.call(arguments,1);return function(){l.apply(null,[e,null].concat(t).concat([].slice.call(arguments,0)))}},l.stop=function(){a=1},l.nt=function(e){return e?(new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)")).test(u):u},l.nts=function(){return u.split(r)},l.off=l.unbind=function(e,t){if(!e){l._events=f={n:{}};return}var s=e.split(r),o,u,a,c,h,p,d,v=[f];for(c=0,h=s.length;c<h;c++)for(p=0;p<v.length;p+=a.length-2){a=[p,1],o=v[p].n;if(s[c]!=i)o[s[c]]&&a.push(o[s[c]]);else for(u in o)o[n](u)&&a.push(o[u]);v.splice.apply(v,a)}for(c=0,h=v.length;c<h;c++){o=v[c];while(o.n){if(t){if(o.f){for(p=0,d=o.f.length;p<d;p++)if(o.f[p]==t){o.f.splice(p,1);break}!o.f.length&&delete o.f}for(u in o.n)if(o.n[n](u)&&o.n[u].f){var m=o.n[u].f;for(p=0,d=m.length;p<d;p++)if(m[p]==t){m.splice(p,1);break}!m.length&&delete o.n[u].f}}else{delete o.f;for(u in o.n)o.n[n](u)&&o.n[u].f&&delete o.n[u].f}o=o.n}}},l.once=function(e,t){var n=function(){return l.unbind(e,n),t.apply(this,arguments)};return l.on(e,n)},l.version=t,l.toString=function(){return"You are running Eve "+t},typeof module!="undefined"&&module.exports?module.exports=l:typeof define!="undefined"?define("eve",[],function(){return l}):e.eve=l})(this),function(e,t){typeof define=="function"&&define.amd?define("raphael",["eve"],function(n){return t(e,n)}):t(e,e.eve)}(this,function(e,t){function n(e){if(n.is(e,"function"))return r?e():t.on("raphael.DOMload",e);if(n.is(e,_))return n._engine.create[d](n,e.splice(0,3+n.is(e[0],O))).add(e);var i=Array.prototype.slice.call(arguments,0);if(n.is(i[i.length-1],"function")){var s=i.pop();return r?s.call(n._engine.create[d](n,i)):t.on("raphael.DOMload",function(){s.call(n._engine.create[d](n,i))})}return n._engine.create[d](n,arguments)}function dt(e){if(typeof e=="function"||Object(e)!==e)return e;var t=new e.constructor;for(var n in e)e[a](n)&&(t[n]=dt(e[n]));return t}function St(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return e.push(e.splice(n,1)[0])}function xt(e,t,n){function r(){var i=Array.prototype.slice.call(arguments,0),s=i.join("␀"),o=r.cache=r.cache||{},u=r.count=r.count||[];return o[a](s)?(St(u,s),n?n(o[s]):o[s]):(u.length>=1e3&&delete o[u.shift()],u.push(s),o[s]=e[d](t,i),n?n(o[s]):o[s])}return r}function Nt(){return this.hex}function Ct(e,t){var n=[];for(var r=0,i=e.length;i-2*!t>r;r+=2){var s=[{x:+e[r-2],y:+e[r-1]},{x:+e[r],y:+e[r+1]},{x:+e[r+2],y:+e[r+3]},{x:+e[r+4],y:+e[r+5]}];t?r?i-4==r?s[3]={x:+e[0],y:+e[1]}:i-2==r&&(s[2]={x:+e[0],y:+e[1]},s[3]={x:+e[2],y:+e[3]}):s[0]={x:+e[i-2],y:+e[i-1]}:i-4==r?s[3]=s[2]:r||(s[0]={x:+e[r],y:+e[r+1]}),n.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return n}function Lt(e,t,n,r,i){var s=-3*t+9*n-9*r+3*i,o=e*s+6*t-12*n+6*r;return e*o-3*t+3*n}function At(e,t,n,r,i,s,o,u,a){a==null&&(a=1),a=a>1?1:a<0?0:a;var f=a/2,l=12,c=[-0.1252,.1252,-0.3678,.3678,-0.5873,.5873,-0.7699,.7699,-0.9041,.9041,-0.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],p=0;for(var d=0;d<l;d++){var v=f*c[d]+f,m=Lt(v,e,n,i,o),g=Lt(v,t,r,s,u),y=m*m+g*g;p+=h[d]*T.sqrt(y)}return f*p}function Ot(e,t,n,r,i,s,o,u,a){if(a<0||At(e,t,n,r,i,s,o,u)<a)return;var f=1,l=f/2,c=f-l,h,p=.01;h=At(e,t,n,r,i,s,o,u,c);while(k(h-a)>p)l/=2,c+=(h<a?1:-1)*l,h=At(e,t,n,r,i,s,o,u,c);return c}function Mt(e,t,n,r,i,s,o,u){if(N(e,n)<C(i,o)||C(e,n)>N(i,o)||N(t,r)<C(s,u)||C(t,r)>N(s,u))return;var a=(e*r-t*n)*(i-o)-(e-n)*(i*u-s*o),f=(e*r-t*n)*(s-u)-(t-r)*(i*u-s*o),l=(e-n)*(s-u)-(t-r)*(i-o);if(!l)return;var c=a/l,h=f/l,p=+c.toFixed(2),d=+h.toFixed(2);if(p<+C(e,n).toFixed(2)||p>+N(e,n).toFixed(2)||p<+C(i,o).toFixed(2)||p>+N(i,o).toFixed(2)||d<+C(t,r).toFixed(2)||d>+N(t,r).toFixed(2)||d<+C(s,u).toFixed(2)||d>+N(s,u).toFixed(2))return;return{x:c,y:h}}function _t(e,t){return Pt(e,t)}function Dt(e,t){return Pt(e,t,1)}function Pt(e,t,r){var i=n.bezierBBox(e),s=n.bezierBBox(t);if(!n.isBBoxIntersect(i,s))return r?0:[];var o=At.apply(0,e),u=At.apply(0,t),a=~~(o/5),f=~~(u/5),l=[],c=[],h={},p=r?0:[];for(var d=0;d<a+1;d++){var v=n.findDotsAtSegment.apply(n,e.concat(d/a));l.push({x:v.x,y:v.y,t:d/a})}for(d=0;d<f+1;d++)v=n.findDotsAtSegment.apply(n,t.concat(d/f)),c.push({x:v.x,y:v.y,t:d/f});for(d=0;d<a;d++)for(var m=0;m<f;m++){var g=l[d],y=l[d+1],b=c[m],w=c[m+1],E=k(y.x-g.x)<.001?"y":"x",S=k(w.x-b.x)<.001?"y":"x",x=Mt(g.x,g.y,y.x,y.y,b.x,b.y,w.x,w.y);if(x){if(h[x.x.toFixed(4)]==x.y.toFixed(4))continue;h[x.x.toFixed(4)]=x.y.toFixed(4);var T=g.t+k((x[E]-g[E])/(y[E]-g[E]))*(y.t-g.t),N=b.t+k((x[S]-b[S])/(w[S]-b[S]))*(w.t-b.t);T>=0&&T<=1&&N>=0&&N<=1&&(r?p++:p.push({x:x.x,y:x.y,t1:T,t2:N}))}}return p}function Ht(e,t,r){e=n._path2curve(e),t=n._path2curve(t);var i,s,o,u,a,f,l,c,h,p,d=r?0:[];for(var v=0,m=e.length;v<m;v++){var g=e[v];if(g[0]=="M")i=a=g[1],s=f=g[2];else{g[0]=="C"?(h=[i,s].concat(g.slice(1)),i=h[6],s=h[7]):(h=[i,s,i,s,a,f,a,f],i=a,s=f);for(var y=0,b=t.length;y<b;y++){var w=t[y];if(w[0]=="M")o=l=w[1],u=c=w[2];else{w[0]=="C"?(p=[o,u].concat(w.slice(1)),o=p[6],u=p[7]):(p=[o,u,o,u,l,c,l,c],o=l,u=c);var E=Pt(h,p,r);if(r)d+=E;else{for(var S=0,x=E.length;S<x;S++)E[S].segment1=v,E[S].segment2=y,E[S].bez1=h,E[S].bez2=p;d=d.concat(E)}}}}}return d}function rn(e,t,n,r,i,s){e!=null?(this.a=+e,this.b=+t,this.c=+n,this.d=+r,this.e=+i,this.f=+s):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function bn(){return this.x+y+this.y}function wn(){return this.x+y+this.y+y+this.width+" × "+this.height}function _n(e,t,n,r,i,s){function h(e){return((a*e+u)*e+o)*e}function p(e,t){var n=d(e,t);return((c*n+l)*n+f)*n}function d(e,t){var n,r,i,s,f,l;for(i=e,l=0;l<8;l++){s=h(i)-e;if(k(s)<t)return i;f=(3*a*i+2*u)*i+o;if(k(f)<1e-6)break;i-=s/f}n=0,r=1,i=e;if(i<n)return n;if(i>r)return r;while(n<r){s=h(i);if(k(s-e)<t)return i;e>s?n=i:r=i,i=(r-n)/2+n}return i}var o=3*t,u=3*(r-t)-o,a=1-o-u,f=3*n,l=3*(i-n)-f,c=1-f-l;return p(e,1/(200*s))}function Dn(e,t){var n=[],r={};this.ms=t,this.times=1;if(e){for(var i in e)e[a](i)&&(r[W(i)]=e[i],n.push(W(i)));n.sort(st)}this.anim=r,this.top=n[n.length-1],this.percents=n}function Pn(e,r,s,o,u,f){s=W(s);var l,c,h,p=[],d,m,g,y=e.ms,E={},S={},x={};if(o)for(N=0,C=Ln.length;N<C;N++){var T=Ln[N];if(T.el.id==r.id&&T.anim==e){T.percent!=s?(Ln.splice(N,1),h=1):c=T,r.attr(T.totalOrigin);break}}else o=+S;for(var N=0,C=e.percents.length;N<C;N++){if(e.percents[N]==s||e.percents[N]>o*e.top){s=e.percents[N],m=e.percents[N-1]||0,y=y/e.top*(s-m),d=e.percents[N+1],l=e.anim[s];break}o&&r.attr(e.anim[e.percents[N]])}if(!l)return;if(!c){for(var k in l)if(l[a](k))if(J[a](k)||r.paper.customAttributes[a](k)){E[k]=r.attr(k),E[k]==null&&(E[k]=$[k]),S[k]=l[k];switch(J[k]){case O:x[k]=(S[k]-E[k])/y;break;case"colour":E[k]=n.getRGB(E[k]);var L=n.getRGB(S[k]);x[k]={r:(L.r-E[k].r)/y,g:(L.g-E[k].g)/y,b:(L.b-E[k].b)/y};break;case"path":var A=Xt(E[k],S[k]),M=A[1];E[k]=A[0],x[k]=[];for(N=0,C=E[k].length;N<C;N++){x[k][N]=[0];for(var _=1,D=E[k][N].length;_<D;_++)x[k][N][_]=(M[N][_]-E[k][N][_])/y}break;case"transform":var P=r._,H=nn(P[k],S[k]);if(H){E[k]=H.from,S[k]=H.to,x[k]=[],x[k].real=!0;for(N=0,C=E[k].length;N<C;N++){x[k][N]=[E[k][N][0]];for(_=1,D=E[k][N].length;_<D;_++)x[k][N][_]=(S[k][N][_]-E[k][N][_])/y}}else{var B=r.matrix||new rn,j={_:{transform:P.transform},getBBox:function(){return r.getBBox(1)}};E[k]=[B.a,B.b,B.c,B.d,B.e,B.f],en(j,S[k]),S[k]=j._.transform,x[k]=[(j.matrix.a-B.a)/y,(j.matrix.b-B.b)/y,(j.matrix.c-B.c)/y,(j.matrix.d-B.d)/y,(j.matrix.e-B.e)/y,(j.matrix.f-B.f)/y]}break;case"csv":var F=b(l[k])[w](i),I=b(E[k])[w](i);if(k=="clip-rect"){E[k]=I,x[k]=[],N=I.length;while(N--)x[k][N]=(F[N]-E[k][N])/y}S[k]=F;break;default:F=[][v](l[k]),I=[][v](E[k]),x[k]=[],N=r.paper.customAttributes[k].length;while(N--)x[k][N]=((F[N]||0)-(I[N]||0))/y}}var q=l.easing,U=n.easing_formulas[q];if(!U){U=b(q).match(R);if(U&&U.length==5){var z=U;U=function(e){return _n(e,+z[1],+z[2],+z[3],+z[4],y)}}else U=ut}g=l.start||e.start||+(new Date),T={anim:e,percent:s,timestamp:g,start:g+(e.del||0),status:0,initstatus:o||0,stop:!1,ms:y,easing:U,from:E,diff:x,to:S,el:r,callback:l.callback,prev:m,next:d,repeat:f||e.times,origin:r.attr(),totalOrigin:u},Ln.push(T);if(o&&!c&&!h){T.stop=!0,T.start=new Date-y*o;if(Ln.length==1)return On()}h&&(T.start=new Date-T.ms*o),Ln.length==1&&An(On)}else c.initstatus=o,c.start=new Date-c.ms*o;t("raphael.anim.start."+r.id,r,e)}function Hn(e){for(var t=0;t<Ln.length;t++)Ln[t].el.paper==e&&Ln.splice(t--,1)}n.version="2.1.0",n.eve=t;var r,i=/[, ]+/,s={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},o=/\{(\d+)\}/g,u="prototype",a="hasOwnProperty",f={doc:document,win:e},l={was:Object.prototype[a].call(f.win,"Raphael"),is:f.win.Raphael},c=function(){this.ca=this.customAttributes={}},h,p="appendChild",d="apply",v="concat",m="ontouchstart"in f.win||f.win.DocumentTouch&&f.doc instanceof DocumentTouch,g="",y=" ",b=String,w="split",E="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[w](y),S={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},x=b.prototype.toLowerCase,T=Math,N=T.max,C=T.min,k=T.abs,L=T.pow,A=T.PI,O="number",M="string",_="array",D="toString",P="fill",H=Object.prototype.toString,B={},j="push",F=n._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,I=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,q={NaN:1,Infinity:1,"-Infinity":1},R=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,U=T.round,z="setAttribute",W=parseFloat,X=parseInt,V=b.prototype.toUpperCase,$=n._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},J=n._availableAnimAttrs={blur:O,"clip-rect":"csv",cx:O,cy:O,fill:"colour","fill-opacity":O,"font-size":O,height:O,opacity:O,path:"path",r:O,rx:O,ry:O,stroke:"colour","stroke-opacity":O,"stroke-width":O,transform:"transform",width:O,x:O,y:O},K=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,Q=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,G={hs:1,rg:1},Y=/,?([achlmqrstvxz]),?/gi,Z=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,et=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,tt=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,nt=n._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,rt={},it=function(e,t){return e.key-t.key},st=function(e,t){return W(e)-W(t)},ot=function(){},ut=function(e){return e},at=n._rectPath=function(e,t,n,r,i){return i?[["M",e+i,t],["l",n-i*2,0],["a",i,i,0,0,1,i,i],["l",0,r-i*2],["a",i,i,0,0,1,-i,i],["l",i*2-n,0],["a",i,i,0,0,1,-i,-i],["l",0,i*2-r],["a",i,i,0,0,1,i,-i],["z"]]:[["M",e,t],["l",n,0],["l",0,r],["l",-n,0],["z"]]},ft=function(e,t,n,r){return r==null&&(r=n),[["M",e,t],["m",0,-r],["a",n,r,0,1,1,0,2*r],["a",n,r,0,1,1,0,-2*r],["z"]]},lt=n._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return ft(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return ft(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return at(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return at(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return at(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return at(t.x,t.y,t.width,t.height)}},ct=n.mapPath=function(e,t){if(!t)return e;var n,r,i,s,o,u,a;e=Xt(e);for(i=0,o=e.length;i<o;i++){a=e[i];for(s=1,u=a.length;s<u;s+=2)n=t.x(a[s],a[s+1]),r=t.y(a[s],a[s+1]),a[s]=n,a[s+1]=r}return e};n._g=f,n.type=f.win.SVGAngle||f.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if(n.type=="VML"){var ht=f.doc.createElement("div"),pt;ht.innerHTML='<v:shape adj="1"/>',pt=ht.firstChild,pt.style.behavior="url(#default#VML)";if(!pt||typeof pt.adj!="object")return n.type=g;ht=null}n.svg=!(n.vml=n.type=="VML"),n._Paper=c,n.fn=h=c.prototype=n.prototype,n._id=0,n._oid=0,n.is=function(e,t){return t=x.call(t),t=="finite"?!q[a](+e):t=="array"?e instanceof Array:t=="null"&&e===null||t==typeof e&&e!==null||t=="object"&&e===Object(e)||t=="array"&&Array.isArray&&Array.isArray(e)||H.call(e).slice(8,-1).toLowerCase()==t},n.angle=function(e,t,r,i,s,o){if(s==null){var u=e-r,a=t-i;return!u&&!a?0:(180+T.atan2(-a,-u)*180/A+360)%360}return n.angle(e,t,s,o)-n.angle(r,i,s,o)},n.rad=function(e){return e%360*A/180},n.deg=function(e){return e*180/A%360},n.snapTo=function(e,t,r){r=n.is(r,"finite")?r:10;if(n.is(e,_)){var i=e.length;while(i--)if(k(e[i]-t)<=r)return e[i]}else{e=+e;var s=t%e;if(s<r)return t-s;if(s>e-r)return t-s+e}return t};var vt=n.createUUID=function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=T.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)});n.setWindow=function(e){t("raphael.setWindow",n,f.win,e),f.win=e,f.doc=f.win.document,n._engine.initWin&&n._engine.initWin(f.win)};var mt=function(e){if(n.vml){var t=/^\s+|\s+$/g,r;try{var i=new ActiveXObject("htmlfile");i.write("<body>"),i.close(),r=i.body}catch(s){r=createPopup().document.body}var o=r.createTextRange();mt=xt(function(e){try{r.style.color=b(e).replace(t,g);var n=o.queryCommandValue("ForeColor");return n=(n&255)<<16|n&65280|(n&16711680)>>>16,"#"+("000000"+n.toString(16)).slice(-6)}catch(i){return"none"}})}else{var u=f.doc.createElement("i");u.title="Raphaël Colour Picker",u.style.display="none",f.doc.body.appendChild(u),mt=xt(function(e){return u.style.color=e,f.doc.defaultView.getComputedStyle(u,g).getPropertyValue("color")})}return mt(e)},gt=function(){return"hsb("+[this.h,this.s,this.b]+")"},yt=function(){return"hsl("+[this.h,this.s,this.l]+")"},bt=function(){return this.hex},wt=function(e,t,r){t==null&&n.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(r=e.b,t=e.g,e=e.r);if(t==null&&n.is(e,M)){var i=n.getRGB(e);e=i.r,t=i.g,r=i.b}if(e>1||t>1||r>1)e/=255,t/=255,r/=255;return[e,t,r]},Et=function(e,t,r,i){e*=255,t*=255,r*=255;var s={r:e,g:t,b:r,hex:n.rgb(e,t,r),toString:bt};return n.is(i,"finite")&&(s.opacity=i),s};n.color=function(e){var t;return n.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=n.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):n.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=n.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(n.is(e,"string")&&(e=n.getRGB(e)),n.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=n.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=n.rgb2hsb(e),e.v=t.b):(e={hex:"none"},e.r=e.g=e.b=e.h=e.s=e.v=e.l=-1)),e.toString=bt,e},n.hsb2rgb=function(e,t,n,r){this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(n=e.b,t=e.s,e=e.h,r=e.o),e*=360;var i,s,o,u,a;return e=e%360/60,a=n*t,u=a*(1-k(e%2-1)),i=s=o=n-a,e=~~e,i+=[a,u,0,0,u,a][e],s+=[u,a,a,u,0,0][e],o+=[0,0,u,a,a,u][e],Et(i,s,o,r)},n.hsl2rgb=function(e,t,n,r){this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(n=e.l,t=e.s,e=e.h);if(e>1||t>1||n>1)e/=360,t/=100,n/=100;e*=360;var i,s,o,u,a;return e=e%360/60,a=2*t*(n<.5?n:1-n),u=a*(1-k(e%2-1)),i=s=o=n-a/2,e=~~e,i+=[a,u,0,0,u,a][e],s+=[u,a,a,u,0,0][e],o+=[0,0,u,a,a,u][e],Et(i,s,o,r)},n.rgb2hsb=function(e,t,n){n=wt(e,t,n),e=n[0],t=n[1],n=n[2];var r,i,s,o;return s=N(e,t,n),o=s-C(e,t,n),r=o==0?null:s==e?(t-n)/o:s==t?(n-e)/o+2:(e-t)/o+4,r=(r+360)%6*60/360,i=o==0?0:o/s,{h:r,s:i,b:s,toString:gt}},n.rgb2hsl=function(e,t,n){n=wt(e,t,n),e=n[0],t=n[1],n=n[2];var r,i,s,o,u,a;return o=N(e,t,n),u=C(e,t,n),a=o-u,r=a==0?null:o==e?(t-n)/a:o==t?(n-e)/a+2:(e-t)/a+4,r=(r+360)%6*60/360,s=(o+u)/2,i=a==0?0:s<.5?a/(2*s):a/(2-2*s),{h:r,s:i,l:s,toString:yt}},n._path2string=function(){return this.join(",").replace(Y,"$1")};var Tt=n._preload=function(e,t){var n=f.doc.createElement("img");n.style.cssText="position:absolute;left:-9999em;top:-9999em",n.onload=function(){t.call(this),this.onload=null,f.doc.body.removeChild(this)},n.onerror=function(){f.doc.body.removeChild(this)},f.doc.body.appendChild(n),n.src=e};n.getRGB=xt(function(e){if(!e||!!((e=b(e)).indexOf("-")+1))return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Nt};if(e=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:Nt};!G[a](e.toLowerCase().substring(0,2))&&e.charAt()!="#"&&(e=mt(e));var t,r,i,s,o,u,f,l=e.match(I);return l?(l[2]&&(s=X(l[2].substring(5),16),i=X(l[2].substring(3,5),16),r=X(l[2].substring(1,3),16)),l[3]&&(s=X((u=l[3].charAt(3))+u,16),i=X((u=l[3].charAt(2))+u,16),r=X((u=l[3].charAt(1))+u,16)),l[4]&&(f=l[4][w](Q),r=W(f[0]),f[0].slice(-1)=="%"&&(r*=2.55),i=W(f[1]),f[1].slice(-1)=="%"&&(i*=2.55),s=W(f[2]),f[2].slice(-1)=="%"&&(s*=2.55),l[1].toLowerCase().slice(0,4)=="rgba"&&(o=W(f[3])),f[3]&&f[3].slice(-1)=="%"&&(o/=100)),l[5]?(f=l[5][w](Q),r=W(f[0]),f[0].slice(-1)=="%"&&(r*=2.55),i=W(f[1]),f[1].slice(-1)=="%"&&(i*=2.55),s=W(f[2]),f[2].slice(-1)=="%"&&(s*=2.55),(f[0].slice(-3)=="deg"||f[0].slice(-1)=="°")&&(r/=360),l[1].toLowerCase().slice(0,4)=="hsba"&&(o=W(f[3])),f[3]&&f[3].slice(-1)=="%"&&(o/=100),n.hsb2rgb(r,i,s,o)):l[6]?(f=l[6][w](Q),r=W(f[0]),f[0].slice(-1)=="%"&&(r*=2.55),i=W(f[1]),f[1].slice(-1)=="%"&&(i*=2.55),s=W(f[2]),f[2].slice(-1)=="%"&&(s*=2.55),(f[0].slice(-3)=="deg"||f[0].slice(-1)=="°")&&(r/=360),l[1].toLowerCase().slice(0,4)=="hsla"&&(o=W(f[3])),f[3]&&f[3].slice(-1)=="%"&&(o/=100),n.hsl2rgb(r,i,s,o)):(l={r:r,g:i,b:s,toString:Nt},l.hex="#"+(16777216|s|i<<8|r<<16).toString(16).slice(1),n.is(o,"finite")&&(l.opacity=o),l)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Nt}},n),n.hsb=xt(function(e,t,r){return n.hsb2rgb(e,t,r).hex}),n.hsl=xt(function(e,t,r){return n.hsl2rgb(e,t,r).hex}),n.rgb=xt(function(e,t,n){return"#"+(16777216|n|t<<8|e<<16).toString(16).slice(1)}),n.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},n=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),n.hex},n.getColor.reset=function(){delete this.start},n.parsePathString=function(e){if(!e)return null;var t=kt(e);if(t.arr)return jt(t.arr);var r={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},i=[];return n.is(e,_)&&n.is(e[0],_)&&(i=jt(e)),i.length||b(e).replace(Z,function(e,t,n){var s=[],o=t.toLowerCase();n.replace(tt,function(e,t){t&&s.push(+t)}),o=="m"&&s.length>2&&(i.push([t][v](s.splice(0,2))),o="l",t=t=="m"?"l":"L");if(o=="r")i.push([t][v](s));else while(s.length>=r[o]){i.push([t][v](s.splice(0,r[o])));if(!r[o])break}}),i.toString=n._path2string,t.arr=jt(i),i},n.parseTransformString=xt(function(e){if(!e)return null;var t={r:3,s:4,t:2,m:6},r=[];return n.is(e,_)&&n.is(e[0],_)&&(r=jt(e)),r.length||b(e).replace(et,function(e,t,n){var i=[],s=x.call(t);n.replace(tt,function(e,t){t&&i.push(+t)}),r.push([t][v](i))}),r.toString=n._path2string,r});var kt=function(e){var t=kt.ps=kt.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var n in t)t[a](n)&&n!=e&&(t[n].sleep--,!t[n].sleep&&delete t[n])}),t[e]};n.findDotsAtSegment=function(e,t,n,r,i,s,o,u,a){var f=1-a,l=L(f,3),c=L(f,2),h=a*a,p=h*a,d=l*e+c*3*a*n+f*3*a*a*i+p*o,v=l*t+c*3*a*r+f*3*a*a*s+p*u,m=e+2*a*(n-e)+h*(i-2*n+e),g=t+2*a*(r-t)+h*(s-2*r+t),y=n+2*a*(i-n)+h*(o-2*i+n),b=r+2*a*(s-r)+h*(u-2*s+r),w=f*e+a*n,E=f*t+a*r,S=f*i+a*o,x=f*s+a*u,N=90-T.atan2(m-y,g-b)*180/A;return(m>y||g<b)&&(N+=180),{x:d,y:v,m:{x:m,y:g},n:{x:y,y:b},start:{x:w,y:E},end:{x:S,y:x},alpha:N}},n.bezierBBox=function(e,t,r,i,s,o,u,a){n.is(e,"array")||(e=[e,t,r,i,s,o,u,a]);var f=Wt.apply(null,e);return{x:f.min.x,y:f.min.y,x2:f.max.x,y2:f.max.y,width:f.max.x-f.min.x,height:f.max.y-f.min.y}},n.isPointInsideBBox=function(e,t,n){return t>=e.x&&t<=e.x2&&n>=e.y&&n<=e.y2},n.isBBoxIntersect=function(e,t){var r=n.isPointInsideBBox;return r(t,e.x,e.y)||r(t,e.x2,e.y)||r(t,e.x,e.y2)||r(t,e.x2,e.y2)||r(e,t.x,t.y)||r(e,t.x2,t.y)||r(e,t.x,t.y2)||r(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},n.pathIntersection=function(e,t){return Ht(e,t)},n.pathIntersectionNumber=function(e,t){return Ht(e,t,1)},n.isPointInsidePath=function(e,t,r){var i=n.pathBBox(e);return n.isPointInsideBBox(i,t,r)&&Ht(e,[["M",t,r],["H",i.x2+10]],1)%2==1},n._removedFactory=function(e){return function(){t("raphael.log",null,"Raphaël: you are calling to method “"+e+"” of removed object",e)}};var Bt=n.pathBBox=function(e){var t=kt(e);if(t.bbox)return dt(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};e=Xt(e);var n=0,r=0,i=[],s=[],o;for(var u=0,a=e.length;u<a;u++){o=e[u];if(o[0]=="M")n=o[1],r=o[2],i.push(n),s.push(r);else{var f=Wt(n,r,o[1],o[2],o[3],o[4],o[5],o[6]);i=i[v](f.min.x,f.max.x),s=s[v](f.min.y,f.max.y),n=o[5],r=o[6]}}var l=C[d](0,i),c=C[d](0,s),h=N[d](0,i),p=N[d](0,s),m=h-l,g=p-c,y={x:l,y:c,x2:h,y2:p,width:m,height:g,cx:l+m/2,cy:c+g/2};return t.bbox=dt(y),y},jt=function(e){var t=dt(e);return t.toString=n._path2string,t},Ft=n._pathToRelative=function(e){var t=kt(e);if(t.rel)return jt(t.rel);if(!n.is(e,_)||!n.is(e&&e[0],_))e=n.parsePathString(e);var r=[],i=0,s=0,o=0,u=0,a=0;e[0][0]=="M"&&(i=e[0][1],s=e[0][2],o=i,u=s,a++,r.push(["M",i,s]));for(var f=a,l=e.length;f<l;f++){var c=r[f]=[],h=e[f];if(h[0]!=x.call(h[0])){c[0]=x.call(h[0]);switch(c[0]){case"a":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+(h[6]-i).toFixed(3),c[7]=+(h[7]-s).toFixed(3);break;case"v":c[1]=+(h[1]-s).toFixed(3);break;case"m":o=h[1],u=h[2];default:for(var p=1,d=h.length;p<d;p++)c[p]=+(h[p]-(p%2?i:s)).toFixed(3)}}else{c=r[f]=[],h[0]=="m"&&(o=h[1]+i,u=h[2]+s);for(var v=0,m=h.length;v<m;v++)r[f][v]=h[v]}var g=r[f].length;switch(r[f][0]){case"z":i=o,s=u;break;case"h":i+=+r[f][g-1];break;case"v":s+=+r[f][g-1];break;default:i+=+r[f][g-2],s+=+r[f][g-1]}}return r.toString=n._path2string,t.rel=jt(r),r},It=n._pathToAbsolute=function(e){var t=kt(e);if(t.abs)return jt(t.abs);if(!n.is(e,_)||!n.is(e&&e[0],_))e=n.parsePathString(e);if(!e||!e.length)return[["M",0,0]];var r=[],i=0,s=0,o=0,u=0,a=0;e[0][0]=="M"&&(i=+e[0][1],s=+e[0][2],o=i,u=s,a++,r[0]=["M",i,s]);var f=e.length==3&&e[0][0]=="M"&&e[1][0].toUpperCase()=="R"&&e[2][0].toUpperCase()=="Z";for(var l,c,h=a,p=e.length;h<p;h++){r.push(l=[]),c=e[h];if(c[0]!=V.call(c[0])){l[0]=V.call(c[0]);switch(l[0]){case"A":l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=+(c[6]+i),l[7]=+(c[7]+s);break;case"V":l[1]=+c[1]+s;break;case"H":l[1]=+c[1]+i;break;case"R":var d=[i,s][v](c.slice(1));for(var m=2,g=d.length;m<g;m++)d[m]=+d[m]+i,d[++m]=+d[m]+s;r.pop(),r=r[v](Ct(d,f));break;case"M":o=+c[1]+i,u=+c[2]+s;default:for(m=1,g=c.length;m<g;m++)l[m]=+c[m]+(m%2?i:s)}}else if(c[0]=="R")d=[i,s][v](c.slice(1)),r.pop(),r=r[v](Ct(d,f)),l=["R"][v](c.slice(-2));else for(var y=0,b=c.length;y<b;y++)l[y]=c[y];switch(l[0]){case"Z":i=o,s=u;break;case"H":i=l[1];break;case"V":s=l[1];break;case"M":o=l[l.length-2],u=l[l.length-1];default:i=l[l.length-2],s=l[l.length-1]}}return r.toString=n._path2string,t.abs=jt(r),r},qt=function(e,t,n,r){return[e,t,n,r,n,r]},Rt=function(e,t,n,r,i,s){var o=1/3,u=2/3;return[o*e+u*n,o*t+u*r,o*i+u*n,o*s+u*r,i,s]},Ut=function(e,t,n,r,i,s,o,u,a,f){var l=A*120/180,c=A/180*(+i||0),h=[],p,d=xt(function(e,t,n){var r=e*T.cos(n)-t*T.sin(n),i=e*T.sin(n)+t*T.cos(n);return{x:r,y:i}});if(!f){p=d(e,t,-c),e=p.x,t=p.y,p=d(u,a,-c),u=p.x,a=p.y;var m=T.cos(A/180*i),g=T.sin(A/180*i),y=(e-u)/2,b=(t-a)/2,E=y*y/(n*n)+b*b/(r*r);E>1&&(E=T.sqrt(E),n=E*n,r=E*r);var S=n*n,x=r*r,N=(s==o?-1:1)*T.sqrt(k((S*x-S*b*b-x*y*y)/(S*b*b+x*y*y))),C=N*n*b/r+(e+u)/2,L=N*-r*y/n+(t+a)/2,O=T.asin(((t-L)/r).toFixed(9)),M=T.asin(((a-L)/r).toFixed(9));O=e<C?A-O:O,M=u<C?A-M:M,O<0&&(O=A*2+O),M<0&&(M=A*2+M),o&&O>M&&(O-=A*2),!o&&M>O&&(M-=A*2)}else O=f[0],M=f[1],C=f[2],L=f[3];var _=M-O;if(k(_)>l){var D=M,P=u,H=a;M=O+l*(o&&M>O?1:-1),u=C+n*T.cos(M),a=L+r*T.sin(M),h=Ut(u,a,n,r,i,0,o,P,H,[M,D,C,L])}_=M-O;var B=T.cos(O),j=T.sin(O),F=T.cos(M),I=T.sin(M),q=T.tan(_/4),R=4/3*n*q,U=4/3*r*q,z=[e,t],W=[e+R*j,t-U*B],X=[u+R*I,a-U*F],V=[u,a];W[0]=2*z[0]-W[0],W[1]=2*z[1]-W[1];if(f)return[W,X,V][v](h);h=[W,X,V][v](h).join()[w](",");var $=[];for(var J=0,K=h.length;J<K;J++)$[J]=J%2?d(h[J-1],h[J],c).y:d(h[J],h[J+1],c).x;return $},zt=function(e,t,n,r,i,s,o,u,a){var f=1-a;return{x:L(f,3)*e+L(f,2)*3*a*n+f*3*a*a*i+L(a,3)*o,y:L(f,3)*t+L(f,2)*3*a*r+f*3*a*a*s+L(a,3)*u}},Wt=xt(function(e,t,n,r,i,s,o,u){var a=i-2*n+e-(o-2*i+n),f=2*(n-e)-2*(i-n),l=e-n,c=(-f+T.sqrt(f*f-4*a*l))/2/a,h=(-f-T.sqrt(f*f-4*a*l))/2/a,p=[t,u],v=[e,o],m;return k(c)>"1e12"&&(c=.5),k(h)>"1e12"&&(h=.5),c>0&&c<1&&(m=zt(e,t,n,r,i,s,o,u,c),v.push(m.x),p.push(m.y)),h>0&&h<1&&(m=zt(e,t,n,r,i,s,o,u,h),v.push(m.x),p.push(m.y)),a=s-2*r+t-(u-2*s+r),f=2*(r-t)-2*(s-r),l=t-r,c=(-f+T.sqrt(f*f-4*a*l))/2/a,h=(-f-T.sqrt(f*f-4*a*l))/2/a,k(c)>"1e12"&&(c=.5),k(h)>"1e12"&&(h=.5),c>0&&c<1&&(m=zt(e,t,n,r,i,s,o,u,c),v.push(m.x),p.push(m.y)),h>0&&h<1&&(m=zt(e,t,n,r,i,s,o,u,h),v.push(m.x),p.push(m.y)),{min:{x:C[d](0,v),y:C[d](0,p)},max:{x:N[d](0,v),y:N[d](0,p)}}}),Xt=n._path2curve=xt(function(e,t){var n=!t&&kt(e);if(!t&&n.curve)return jt(n.curve);var r=It(e),i=t&&It(t),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},u=function(e,t,n){var r,i;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null);switch(e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][v](Ut[d](0,[t.x,t.y][v](e.slice(1))));break;case"S":n=="C"||n=="S"?(r=t.x*2-t.bx,i=t.y*2-t.by):(r=t.x,i=t.y),e=["C",r,i][v](e.slice(1));break;case"T":n=="Q"||n=="T"?(t.qx=t.x*2-t.qx,t.qy=t.y*2-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"][v](Rt(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][v](Rt(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][v](qt(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][v](qt(t.x,t.y,e[1],t.y));break;case"V":e=["C"][v](qt(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][v](qt(t.x,t.y,t.X,t.Y))}return e},a=function(e,t){if(e[t].length>7){e[t].shift();var n=e[t];while(n.length)e.splice(t++,0,["C"][v](n.splice(0,6)));e.splice(t,1),c=N(r.length,i&&i.length||0)}},f=function(e,t,n,s,o){e&&t&&e[o][0]=="M"&&t[o][0]!="M"&&(t.splice(o,0,["M",s.x,s.y]),n.bx=0,n.by=0,n.x=e[o][1],n.y=e[o][2],c=N(r.length,i&&i.length||0))};for(var l=0,c=N(r.length,i&&i.length||0);l<c;l++){r[l]=u(r[l],s),a(r,l),i&&(i[l]=u(i[l],o)),i&&a(i,l),f(r,i,s,o,l),f(i,r,o,s,l);var h=r[l],p=i&&i[l],m=h.length,g=i&&p.length;s.x=h[m-2],s.y=h[m-1],s.bx=W(h[m-4])||s.x,s.by=W(h[m-3])||s.y,o.bx=i&&(W(p[g-4])||o.x),o.by=i&&(W(p[g-3])||o.y),o.x=i&&p[g-2],o.y=i&&p[g-1]}return i||(n.curve=jt(r)),i?[r,i]:r},null,jt),Vt=n._parseDots=xt(function(e){var t=[];for(var r=0,i=e.length;r<i;r++){var s={},o=e[r].match(/^([^:]*):?([\d\.]*)/);s.color=n.getRGB(o[1]);if(s.color.error)return null;s.color=s.color.hex,o[2]&&(s.offset=o[2]+"%"),t.push(s)}for(r=1,i=t.length-1;r<i;r++)if(!t[r].offset){var u=W(t[r-1].offset||0),a=0;for(var f=r+1;f<i;f++)if(t[f].offset){a=t[f].offset;break}a||(a=100,f=i),a=W(a);var l=(a-u)/(f-r+1);for(;r<f;r++)u+=l,t[r].offset=u+"%"}return t}),$t=n._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)},Jt=n._tofront=function(e,t){if(t.top===e)return;$t(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e},Kt=n._toback=function(e,t){if(t.bottom===e)return;$t(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e},Qt=n._insertafter=function(e,t,n){$t(e,n),t==n.top&&(n.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},Gt=n._insertbefore=function(e,t,n){$t(e,n),t==n.bottom&&(n.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},Yt=n.toMatrix=function(e,t){var n=Bt(e),r={_:{transform:g},getBBox:function(){return n}};return en(r,t),r.matrix},Zt=n.transformPath=function(e,t){return ct(e,Yt(e,t))},en=n._extractTransform=function(e,t){if(t==null)return e._.transform;t=b(t).replace(/\.{3}|\u2026/g,e._.transform||g);var r=n.parseTransformString(t),i=0,s=0,o=0,u=1,a=1,f=e._,l=new rn;f.transform=r||[];if(r)for(var c=0,h=r.length;c<h;c++){var p=r[c],d=p.length,v=b(p[0]).toLowerCase(),m=p[0]!=v,y=m?l.invert():0,w,E,S,x,T;v=="t"&&d==3?m?(w=y.x(0,0),E=y.y(0,0),S=y.x(p[1],p[2]),x=y.y(p[1],p[2]),l.translate(S-w,x-E)):l.translate(p[1],p[2]):v=="r"?d==2?(T=T||e.getBBox(1),l.rotate(p[1],T.x+T.width/2,T.y+T.height/2),i+=p[1]):d==4&&(m?(S=y.x(p[2],p[3]),x=y.y(p[2],p[3]),l.rotate(p[1],S,x)):l.rotate(p[1],p[2],p[3]),i+=p[1]):v=="s"?d==2||d==3?(T=T||e.getBBox(1),l.scale(p[1],p[d-1],T.x+T.width/2,T.y+T.height/2),u*=p[1],a*=p[d-1]):d==5&&(m?(S=y.x(p[3],p[4]),x=y.y(p[3],p[4]),l.scale(p[1],p[2],S,x)):l.scale(p[1],p[2],p[3],p[4]),u*=p[1],a*=p[2]):v=="m"&&d==7&&l.add(p[1],p[2],p[3],p[4],p[5],p[6]),f.dirtyT=1,e.matrix=l}e.matrix=l,f.sx=u,f.sy=a,f.deg=i,f.dx=s=l.e,f.dy=o=l.f,u==1&&a==1&&!i&&f.bbox?(f.bbox.x+=+s,f.bbox.y+=+o):f.dirtyT=1},tn=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return e.length==4?[t,0,e[2],e[3]]:[t,0];case"s":return e.length==5?[t,1,1,e[3],e[4]]:e.length==3?[t,1,1]:[t,1]}},nn=n._equaliseTransform=function(e,t){t=b(t).replace(/\.{3}|\u2026/g,e),e=n.parseTransformString(e)||[],t=n.parseTransformString(t)||[];var r=N(e.length,t.length),i=[],s=[],o=0,u,a,f,l;for(;o<r;o++){f=e[o]||tn(t[o]),l=t[o]||tn(f);if(f[0]!=l[0]||f[0].toLowerCase()=="r"&&(f[2]!=l[2]||f[3]!=l[3])||f[0].toLowerCase()=="s"&&(f[3]!=l[3]||f[4]!=l[4]))return;i[o]=[],s[o]=[];for(u=0,a=N(f.length,l.length);u<a;u++)u in f&&(i[o][u]=f[u]),u in l&&(s[o][u]=l[u])}return{from:i,to:s}};n._getContainer=function(e,t,r,i){var s;s=i==null&&!n.is(e,"object")?f.doc.getElementById(e):e;if(s==null)return;return s.tagName?t==null?{container:s,width:s.style.pixelWidth||s.offsetWidth,height:s.style.pixelHeight||s.offsetHeight}:{container:s,width:t,height:r}:{container:1,x:e,y:t,width:r,height:i}},n.pathToRelative=Ft,n._engine={},n.path2curve=Xt,n.matrix=function(e,t,n,r,i,s){return new rn(e,t,n,r,i,s)},function(e){function t(e){return e[0]*e[0]+e[1]*e[1]}function r(e){var n=T.sqrt(t(e));e[0]&&(e[0]/=n),e[1]&&(e[1]/=n)}e.add=function(e,t,n,r,i,s){var o=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],a=[[e,n,i],[t,r,s],[0,0,1]],f,l,c,h;e&&e instanceof rn&&(a=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]);for(f=0;f<3;f++)for(l=0;l<3;l++){h=0;for(c=0;c<3;c++)h+=u[f][c]*a[c][l];o[f][l]=h}this.a=o[0][0],this.b=o[1][0],this.c=o[0][1],this.d=o[1][1],this.e=o[0][2],this.f=o[1][2]},e.invert=function(){var e=this,t=e.a*e.d-e.b*e.c;return new rn(e.d/t,-e.b/t,-e.c/t,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.b*e.e-e.a*e.f)/t)},e.clone=function(){return new rn(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(e,t){this.add(1,0,0,1,e,t)},e.scale=function(e,t,n,r){t==null&&(t=e),(n||r)&&this.add(1,0,0,1,n,r),this.add(e,0,0,t,0,0),(n||r)&&this.add(1,0,0,1,-n,-r)},e.rotate=function(e,t,r){e=n.rad(e),t=t||0,r=r||0;var i=+T.cos(e).toFixed(9),s=+T.sin(e).toFixed(9);this.add(i,s,-s,i,t,r),this.add(1,0,0,1,-t,-r)},e.x=function(e,t){return e*this.a+t*this.c+this.e},e.y=function(e,t){return e*this.b+t*this.d+this.f},e.get=function(e){return+this[b.fromCharCode(97+e)].toFixed(4)},e.toString=function(){return n.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var i=[[this.a,this.c],[this.b,this.d]];e.scalex=T.sqrt(t(i[0])),r(i[0]),e.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1],i[1]=[i[1][0]-i[0][0]*e.shear,i[1][1]-i[0][1]*e.shear],e.scaley=T.sqrt(t(i[1])),r(i[1]),e.shear/=e.scaley;var s=-i[0][1],o=i[1][1];return o<0?(e.rotate=n.deg(T.acos(o)),s<0&&(e.rotate=360-e.rotate)):e.rotate=n.deg(T.asin(s)),e.isSimple=!+e.shear.toFixed(9)&&(e.scalex.toFixed(9)==e.scaley.toFixed(9)||!e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(e){var t=e||this[w]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:g)+(t.scalex!=1||t.scaley!=1?"s"+[t.scalex,t.scaley,0,0]:g)+(t.rotate?"r"+[t.rotate,0,0]:g)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(rn.prototype);var sn=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);navigator.vendor=="Apple Computer, Inc."&&(sn&&sn[1]<4||navigator.platform.slice(0,2)=="iP")||navigator.vendor=="Google Inc."&&sn&&sn[1]<8?h.safari=function(){var e=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){e.remove()})}:h.safari=ot;var on=function(){this.returnValue=!1},un=function(){return this.originalEvent.preventDefault()},an=function(){this.cancelBubble=!0},fn=function(){return this.originalEvent.stopPropagation()},ln=function(e){var t=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,n=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft;return{x:e.clientX+n,y:e.clientY+t}},cn=function(){if(f.doc.addEventListener)return function(e,t,n,r){var i=function(e){var t=ln(e);return n.call(r,e,t.x,t.y)};e.addEventListener(t,i,!1);if(m&&S[t]){var s=function(t){var i=ln(t),s=t;for(var o=0,u=t.targetTouches&&t.targetTouches.length;o<u;o++)if(t.targetTouches[o].target==e){t=t.targetTouches[o],t.originalEvent=s,t.preventDefault=un,t.stopPropagation=fn;break}return n.call(r,t,i.x,i.y)};e.addEventListener(S[t],s,!1)}return function(){return e.removeEventListener(t,i,!1),m&&S[t]&&e.removeEventListener(S[t],i,!1),!0}};if(f.doc.attachEvent)return function(e,t,n,r){var i=function(e){e=e||f.win.event;var t=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,i=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft,s=e.clientX+i,o=e.clientY+t;return e.preventDefault=e.preventDefault||on,e.stopPropagation=e.stopPropagation||an,n.call(r,e,s,o)};e.attachEvent("on"+t,i);var s=function(){return e.detachEvent("on"+t,i),!0};return s}}(),hn=[],pn=function(e){var n=e.clientX,r=e.clientY,i=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,s=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft,o,u=hn.length;while(u--){o=hn[u];if(m&&e.touches){var a=e.touches.length,l;while(a--){l=e.touches[a];if(l.identifier==o.el._drag.id){n=l.clientX,r=l.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}}else e.preventDefault();var c=o.el.node,h,p=c.nextSibling,d=c.parentNode,v=c.style.display;f.win.opera&&d.removeChild(c),c.style.display="none",h=o.el.paper.getElementByPoint(n,r),c.style.display=v,f.win.opera&&(p?d.insertBefore(c,p):d.appendChild(c)),h&&t("raphael.drag.over."+o.el.id,o.el,h),n+=s,r+=i,t("raphael.drag.move."+o.el.id,o.move_scope||o.el,n-o.el._drag.x,r-o.el._drag.y,n,r,e)}},dn=function(e){n.unmousemove(pn).unmouseup(dn);var r=hn.length,i;while(r--)i=hn[r],i.el._drag={},t("raphael.drag.end."+i.el.id,i.end_scope||i.start_scope||i.move_scope||i.el,e);hn=[]},vn=n.el={};for(var mn=E.length;mn--;)(function(e){n[e]=vn[e]=function(t,r){return n.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:cn(this.shape||this.node||f.doc,e,t,r||this)})),this},n["un"+e]=vn["un"+e]=function(t){var r=this.events||[],i=r.length;while(i--)r[i].name==e&&(n.is(t,"undefined")||r[i].f==t)&&(r[i].unbind(),r.splice(i,1),!r.length&&delete this.events);return this}})(E[mn]);vn.data=function(e,r){var i=rt[this.id]=rt[this.id]||{};if(arguments.length==0)return i;if(arguments.length==1){if(n.is(e,"object")){for(var s in e)e[a](s)&&this.data(s,e[s]);return this}return t("raphael.data.get."+this.id,this,i[e],e),i[e]}return i[e]=r,t("raphael.data.set."+this.id,this,r,e),this},vn.removeData=function(e){return e==null?rt[this.id]={}:rt[this.id]&&delete rt[this.id][e],this},vn.getData=function(){return dt(rt[this.id]||{})},vn.hover=function(e,t,n,r){return this.mouseover(e,n).mouseout(t,r||n)},vn.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var gn=[];vn.drag=function(e,r,i,s,o,u){function a(a){(a.originalEvent||a).preventDefault();var l=a.clientX,c=a.clientY,h=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,p=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft;this._drag.id=a.identifier;if(m&&a.touches){var d=a.touches.length,v;while(d--){v=a.touches[d],this._drag.id=v.identifier;if(v.identifier==this._drag.id){l=v.clientX,c=v.clientY;break}}}this._drag.x=l+p,this._drag.y=c+h,!hn.length&&n.mousemove(pn).mouseup(dn),hn.push({el:this,move_scope:s,start_scope:o,end_scope:u}),r&&t.on("raphael.drag.start."+this.id,r),e&&t.on("raphael.drag.move."+this.id,e),i&&t.on("raphael.drag.end."+this.id,i),t("raphael.drag.start."+this.id,o||s||this,a.clientX+p,a.clientY+h,a)}return this._drag={},gn.push({el:this,start:a}),this.mousedown(a),this},vn.onDragOver=function(e){e?t.on("raphael.drag.over."+this.id,e):t.unbind("raphael.drag.over."+this.id)},vn.undrag=function(){var e=gn.length;while(e--)gn[e].el==this&&(this.unmousedown(gn[e].start),gn.splice(e,1),t.unbind("raphael.drag.*."+this.id));!gn.length&&n.unmousemove(pn).unmouseup(dn),hn=[]},h.circle=function(e,t,r){var i=n._engine.circle(this,e||0,t||0,r||0);return this.__set__&&this.__set__.push(i),i},h.rect=function(e,t,r,i,s){var o=n._engine.rect(this,e||0,t||0,r||0,i||0,s||0);return this.__set__&&this.__set__.push(o),o},h.ellipse=function(e,t,r,i){var s=n._engine.ellipse(this,e||0,t||0,r||0,i||0);return this.__set__&&this.__set__.push(s),s},h.path=function(e){e&&!n.is(e,M)&&!n.is(e[0],_)&&(e+=g);var t=n._engine.path(n.format[d](n,arguments),this);return this.__set__&&this.__set__.push(t),t},h.image=function(e,t,r,i,s){var o=n._engine.image(this,e||"about:blank",t||0,r||0,i||0,s||0);return this.__set__&&this.__set__.push(o),o},h.text=function(e,t,r){var i=n._engine.text(this,e||0,t||0,b(r));return this.__set__&&this.__set__.push(i),i},h.set=function(e){!n.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new Bn(e);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t},h.setStart=function(e){this.__set__=e||this.set()},h.setFinish=function(e){var t=this.__set__;return delete this.__set__,t},h.setSize=function(e,t){return n._engine.setSize.call(this,e,t)},h.setViewBox=function(e,t,r,i,s){return n._engine.setViewBox.call(this,e,t,r,i,s)},h.top=h.bottom=null,h.raphael=n;var yn=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument,r=n.body,i=n.documentElement,s=i.clientTop||r.clientTop||0,o=i.clientLeft||r.clientLeft||0,u=t.top+(f.win.pageYOffset||i.scrollTop||r.scrollTop)-s,a=t.left+(f.win.pageXOffset||i.scrollLeft||r.scrollLeft)-o;return{y:u,x:a}};h.getElementByPoint=function(e,t){var n=this,r=n.canvas,i=f.doc.elementFromPoint(e,t);if(f.win.opera&&i.tagName=="svg"){var s=yn(r),o=r.createSVGRect();o.x=e-s.x,o.y=t-s.y,o.width=o.height=1;var u=r.getIntersectionList(o,null);u.length&&(i=u[u.length-1])}if(!i)return null;while(i.parentNode&&i!=r.parentNode&&!i.raphael)i=i.parentNode;return i==n.canvas.parentNode&&(i=r),i=i&&i.raphael?n.getById(i.raphaelid):null,i},h.getElementsByBBox=function(e){var t=this.set();return this.forEach(function(r){n.isBBoxIntersect(r.getBBox(),e)&&t.push(r)}),t},h.getById=function(e){var t=this.bottom;while(t){if(t.id==e)return t;t=t.next}return null},h.forEach=function(e,t){var n=this.bottom;while(n){if(e.call(t,n)===!1)return this;n=n.next}return this},h.getElementsByPoint=function(e,t){var n=this.set();return this.forEach(function(r){r.isPointInside(e,t)&&n.push(r)}),n},vn.isPointInside=function(e,t){var r=this.realPath=lt[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(r=n.transformPath(r,this.attr("transform"))),n.isPointInsidePath(r,e,t)},vn.getBBox=function(e){if(this.removed)return{};var t=this._;if(e){if(t.dirty||!t.bboxwt)this.realPath=lt[this.type](this),t.bboxwt=Bt(this.realPath),t.bboxwt.toString=wn,t.dirty=0;return t.bboxwt}if(t.dirty||t.dirtyT||!t.bbox){if(t.dirty||!this.realPath)t.bboxwt=0,this.realPath=lt[this.type](this);t.bbox=Bt(ct(this.realPath,this.matrix)),t.bbox.toString=wn,t.dirty=t.dirtyT=0}return t.bbox},vn.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},vn.glow=function(e){if(this.type=="text")return null;e=e||{};var t={width:(e.width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity||.5,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},n=t.width/2,r=this.paper,i=r.set(),s=this.realPath||lt[this.type](this);s=this.matrix?ct(s,this.matrix):s;for(var o=1;o<n+1;o++)i.push(r.path(s).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/n*o).toFixed(3),opacity:+(t.opacity/n).toFixed(3)}));return i.insertBefore(this).translate(t.offsetx,t.offsety)};var En={},Sn=function(e,t,r,i,s,o,u,a,f){return f==null?At(e,t,r,i,s,o,u,a):n.findDotsAtSegment(e,t,r,i,s,o,u,a,Ot(e,t,r,i,s,o,u,a,f))},xn=function(e,t){return function(r,i,s){r=Xt(r);var o,u,a,f,l="",c={},h,p=0;for(var d=0,v=r.length;d<v;d++){a=r[d];if(a[0]=="M")o=+a[1],u=+a[2];else{f=Sn(o,u,a[1],a[2],a[3],a[4],a[5],a[6]);if(p+f>i){if(t&&!c.start){h=Sn(o,u,a[1],a[2],a[3],a[4],a[5],a[6],i-p),l+=["C"+h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y];if(s)return l;c.start=l,l=["M"+h.x,h.y+"C"+h.n.x,h.n.y,h.end.x,h.end.y,a[5],a[6]].join(),p+=f,o=+a[5],u=+a[6];continue}if(!e&&!t)return h=Sn(o,u,a[1],a[2],a[3],a[4],a[5],a[6],i-p),{x:h.x,y:h.y,alpha:h.alpha}}p+=f,o=+a[5],u=+a[6]}l+=a.shift()+a}return c.end=l,h=e?p:t?c:n.findDotsAtSegment(o,u,a[0],a[1],a[2],a[3],a[4],a[5],1),h.alpha&&(h={x:h.x,y:h.y,alpha:h.alpha}),h}},Tn=xn(1),Nn=xn(),Cn=xn(0,1);n.getTotalLength=Tn,n.getPointAtLength=Nn,n.getSubpath=function(e,t,n){if(this.getTotalLength(e)-n<1e-6)return Cn(e,t).end;var r=Cn(e,n,1);return t?Cn(r,t).end:r},vn.getTotalLength=function(){var e=this.getPath();if(!e)return;return this.node.getTotalLength?this.node.getTotalLength():Tn(e)},vn.getPointAtLength=function(e){var t=this.getPath();if(!t)return;return Nn(t,e)},vn.getPath=function(){var e,t=n._getPath[this.type];if(this.type=="text"||this.type=="set")return;return t&&(e=t(this)),e},vn.getSubpath=function(e,t){var r=this.getPath();if(!r)return;return n.getSubpath(r,e,t)};var kn=n.easing_formulas={linear:function(e){return e},"<":function(e){return L(e,1.7)},">":function(e){return L(e,.48)},"<>":function(e){var t=.48-e/1.04,n=T.sqrt(.1734+t*t),r=n-t,i=L(k(r),1/3)*(r<0?-1:1),s=-n-t,o=L(k(s),1/3)*(s<0?-1:1),u=i+o+.5;return(1-u)*3*u*u+u*u*u},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:L(2,-10*e)*T.sin((e-.075)*2*A/.3)+1},bounce:function(e){var t=7.5625,n=2.75,r;return e<1/n?r=t*e*e:e<2/n?(e-=1.5/n,r=t*e*e+.75):e<2.5/n?(e-=2.25/n,r=t*e*e+.9375):(e-=2.625/n,r=t*e*e+.984375),r}};kn.easeIn=kn["ease-in"]=kn["<"],kn.easeOut=kn["ease-out"]=kn[">"],kn.easeInOut=kn["ease-in-out"]=kn["<>"],kn["back-in"]=kn.backIn,kn["back-out"]=kn.backOut;var Ln=[],An=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,16)},On=function(){var e=+(new Date),r=0;for(;r<Ln.length;r++){var i=Ln[r];if(i.el.removed||i.paused)continue;var s=e-i.start,o=i.ms,u=i.easing,f=i.from,l=i.diff,c=i.to,h=i.t,p=i.el,d={},m,g={},b;i.initstatus?(s=(i.initstatus*i.anim.top-i.prev)/(i.percent-i.prev)*o,i.status=i.initstatus,delete i.initstatus,i.stop&&Ln.splice(r--,1)):i.status=(i.prev+(i.percent-i.prev)*(s/o))/i.anim.top;if(s<0)continue;if(s<o){var w=u(s/o);for(var E in f)if(f[a](E)){switch(J[E]){case O:m=+f[E]+w*o*l[E];break;case"colour":m="rgb("+[Mn(U(f[E].r+w*o*l[E].r)),Mn(U(f[E].g+w*o*l[E].g)),Mn(U(f[E].b+w*o*l[E].b))].join(",")+")";break;case"path":m=[];for(var S=0,x=f[E].length;S<x;S++){m[S]=[f[E][S][0]];for(var T=1,N=f[E][S].length;T<N;T++)m[S][T]=+f[E][S][T]+w*o*l[E][S][T];m[S]=m[S].join(y)}m=m.join(y);break;case"transform":if(l[E].real){m=[];for(S=0,x=f[E].length;S<x;S++){m[S]=[f[E][S][0]];for(T=1,N=f[E][S].length;T<N;T++)m[S][T]=f[E][S][T]+w*o*l[E][S][T]}}else{var C=function(e){return+f[E][e]+w*o*l[E][e]};m=[["m",C(0),C(1),C(2),C(3),C(4),C(5)]]}break;case"csv":if(E=="clip-rect"){m=[],S=4;while(S--)m[S]=+f[E][S]+w*o*l[E][S]}break;default:var k=[][v](f[E]);m=[],S=p.paper.customAttributes[E].length;while(S--)m[S]=+k[S]+w*o*l[E][S]}d[E]=m}p.attr(d),function(e,n,r){setTimeout(function(){t("raphael.anim.frame."+e,n,r)})}(p.id,p,i.anim)}else{(function(e,r,i){setTimeout(function(){t("raphael.anim.frame."+r.id,r,i),t("raphael.anim.finish."+r.id,r,i),n.is(e,"function")&&e.call(r)})})(i.callback,p,i.anim),p.attr(c),Ln.splice(r--,1);if(i.repeat>1&&!i.next){for(b in c)c[a](b)&&(g[b]=i.totalOrigin[b]);i.el.attr(g),Pn(i.anim,i.el,i.anim.percents[0],null,i.totalOrigin,i.repeat-1)}i.next&&!i.stop&&Pn(i.anim,i.el,i.next,null,i.totalOrigin,i.repeat)}}n.svg&&p&&p.paper&&p.paper.safari(),Ln.length&&An(On)},Mn=function(e){return e>255?255:e<0?0:e};vn.animateWith=function(e,t,r,i,s,o){var u=this;if(u.removed)return o&&o.call(u),u;var a=r instanceof Dn?r:n.animation(r,i,s,o),f,l;Pn(a,u,a.percents[0],null,u.attr());for(var c=0,h=Ln.length;c<h;c++)if(Ln[c].anim==t&&Ln[c].el==e){Ln[h-1].start=Ln[c].start;break}return u},vn.onAnimation=function(e){return e?t.on("raphael.anim.frame."+this.id,e):t.unbind("raphael.anim.frame."+this.id),this},Dn.prototype.delay=function(e){var t=new Dn(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},Dn.prototype.repeat=function(e){var t=new Dn(this.anim,this.ms);return t.del=this.del,t.times=T.floor(N(e,0))||1,t},n.animation=function(e,t,r,i){if(e instanceof Dn)return e;if(n.is(r,"function")||!r)i=i||r||null,r=null;e=Object(e),t=+t||0;var s={},o,u;for(u in e)e[a](u)&&W(u)!=u&&W(u)+"%"!=u&&(o=!0,s[u]=e[u]);return o?(r&&(s.easing=r),i&&(s.callback=i),new Dn({100:s},t)):new Dn(e,t)},vn.animate=function(e,t,r,i){var s=this;if(s.removed)return i&&i.call(s),s;var o=e instanceof Dn?e:n.animation(e,t,r,i);return Pn(o,s,o.percents[0],null,s.attr()),s},vn.setTime=function(e,t){return e&&t!=null&&this.status(e,C(t,e.ms)/e.ms),this},vn.status=function(e,t){var n=[],r=0,i,s;if(t!=null)return Pn(e,this,-1,C(t,1)),this;i=Ln.length;for(;r<i;r++){s=Ln[r];if(s.el.id==this.id&&(!e||s.anim==e)){if(e)return s.status;n.push({anim:s.anim,status:s.status})}}return e?0:n},vn.pause=function(e){for(var n=0;n<Ln.length;n++)Ln[n].el.id==this.id&&(!e||Ln[n].anim==e)&&t("raphael.anim.pause."+this.id,this,Ln[n].anim)!==!1&&(Ln[n].paused=!0);return this},vn.resume=function(e){for(var n=0;n<Ln.length;n++)if(Ln[n].el.id==this.id&&(!e||Ln[n].anim==e)){var r=Ln[n];t("raphael.anim.resume."+this.id,this,r.anim)!==!1&&(delete r.paused,this.status(r.anim,r.status))}return this},vn.stop=function(e){for(var n=0;n<Ln.length;n++)Ln[n].el.id==this.id&&(!e||Ln[n].anim==e)&&t("raphael.anim.stop."+this.id,this,Ln[n].anim)!==!1&&Ln.splice(n--,1);return this},t.on("raphael.remove",Hn),t.on("raphael.clear",Hn),vn.toString=function(){return"Raphaël’s object"};var Bn=function(e){this.items=[],this.length=0,this.type="set";if(e)for(var t=0,n=e.length;t<n;t++)e[t]&&(e[t].constructor==vn.constructor||e[t].constructor==Bn)&&(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},jn=Bn.prototype;jn.push=function(){var e,t;for(var n=0,r=arguments.length;n<r;n++)e=arguments[n],e&&(e.constructor==vn.constructor||e.constructor==Bn)&&(t=this.items.length,this[t]=this.items[t]=e,this.length++);return this},jn.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},jn.forEach=function(e,t){for(var n=0,r=this.items.length;n<r;n++)if(e.call(t,this.items[n],n)===!1)return this;return this};for(var Fn in vn)vn[a](Fn)&&(jn[Fn]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e][d](n,t)})}}(Fn));return jn.attr=function(e,t){if(e&&n.is(e,_)&&n.is(e[0],"object"))for(var r=0,i=e.length;r<i;r++)this.items[r].attr(e[r]);else for(var s=0,o=this.items.length;s<o;s++)this.items[s].attr(e,t);return this},jn.clear=function(){while(this.length)this.pop()},jn.splice=function(e,t,n){e=e<0?N(this.length+e,0):e,t=N(0,C(this.length-e,t));var r=[],i=[],s=[],o;for(o=2;o<arguments.length;o++)s.push(arguments[o]);for(o=0;o<t;o++)i.push(this[e+o]);for(;o<this.length-e;o++)r.push(this[e+o]);var u=s.length;for(o=0;o<u+r.length;o++)this.items[e+o]=this[e+o]=o<u?s[o]:r[o-u];o=this.items.length=this.length-=t-u;while(this[o])delete this[o++];return new Bn(i)},jn.exclude=function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]==e)return this.splice(t,1),!0},jn.animate=function(e,t,r,i){(n.is(r,"function")||!r)&&(i=r||null);var s=this.items.length,o=s,u,a=this,f;if(!s)return this;i&&(f=function(){!--s&&i.call(a)}),r=n.is(r,M)?r:f;var l=n.animation(e,t,r,f);u=this.items[--o].animate(l);while(o--)this.items[o]&&!this.items[o].removed&&this.items[o].animateWith(u,l,l),this.items[o]&&!this.items[o].removed||s--;return this},jn.insertAfter=function(e){var t=this.items.length;while(t--)this.items[t].insertAfter(e);return this},jn.getBBox=function(){var e=[],t=[],n=[],r=[];for(var i=this.items.length;i--;)if(!this.items[i].removed){var s=this.items[i].getBBox();e.push(s.x),t.push(s.y),n.push(s.x+s.width),r.push(s.y+s.height)}return e=C[d](0,e),t=C[d](0,t),n=N[d](0,n),r=N[d](0,r),{x:e,y:t,x2:n,y2:r,width:n-e,height:r-t}},jn.clone=function(e){e=this.paper.set();for(var t=0,n=this.items.length;t<n;t++)e.push(this.items[t].clone());return e},jn.toString=function(){return"Raphaël‘s set"},jn.glow=function(e){var t=this.paper.set();return this.forEach(function(n,r){var i=n.glow(e);i!=null&&i.forEach(function(e,n){t.push(e)})}),t},jn.isPointInside=function(e,t){var n=!1;return this.forEach(function(r){if(r.isPointInside(e,t))return console.log("runned"),n=!0,!1}),n},n.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},n=e.face["font-family"];for(var r in e.face)e.face[a](r)&&(t.face[r]=e.face[r]);this.fonts[n]?this.fonts[n].push(t):this.fonts[n]=[t];if(!e.svg){t.face["units-per-em"]=X(e.face["units-per-em"],10);for(var i in e.glyphs)if(e.glyphs[a](i)){var s=e.glyphs[i];t.glyphs[i]={w:s.w,k:{},d:s.d&&"M"+s.d.replace(/[mlcxtrv]/g,function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"})+"z"};if(s.k)for(var o in s.k)s[a](o)&&(t.glyphs[i].k[o]=s.k[o])}}return e},h.getFont=function(e,t,r,i){i=i||"normal",r=r||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400;if(!n.fonts)return;var s=n.fonts[e];if(!s){var o=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,g)+"(\\s|$)","i");for(var u in n.fonts)if(n.fonts[a](u)&&o.test(u)){s=n.fonts[u];break}}var f;if(s)for(var l=0,c=s.length;l<c;l++){f=s[l];if(f.face["font-weight"]==t&&(f.face["font-style"]==r||!f.face["font-style"])&&f.face["font-stretch"]==i)break}return f},h.print=function(e,t,r,s,o,u,a,f){u=u||"middle",a=N(C(a||0,1),-1),f=N(C(f||1,3),1);var l=b(r)[w](g),c=0,h=0,p=g,d;n.is(s,"string")&&(s=this.getFont(s));if(s){d=(o||16)/s.face["units-per-em"];var v=s.face.bbox[w](i),m=+v[0],y=v[3]-v[1],E=0,S=+v[1]+(u=="baseline"?y+ +s.face.descent:y/2);for(var x=0,T=l.length;x<T;x++){if(l[x]=="\n")c=0,L=0,h=0,E+=y*f;else{var k=h&&s.glyphs[l[x-1]]||{},L=s.glyphs[l[x]];c+=h?(k.w||s.w)+(k.k&&k.k[l[x]]||0)+s.w*a:0,h=1}L&&L.d&&(p+=n.transformPath(L.d,["t",c*d,E*d,"s",d,d,m,S,"t",(e-m)/d,(t-S)/d]))}}return this.path(p).attr({fill:"#000",stroke:"none"})},h.add=function(e){if(n.is(e,"array")){var t=this.set(),r=0,i=e.length,o;for(;r<i;r++)o=e[r]||{},s[a](o.type)&&t.push(this[o.type]().attr(o))}return t},n.format=function(e,t){var r=n.is(t,_)?[0][v](t):arguments;return e&&n.is(e,M)&&r.length-1&&(e=e.replace(o,function(e,t){return r[++t]==null?g:r[t]})),e||g},n.fullfill=function(){var e=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,n=function(e,n,r){var i=r;return n.replace(t,function(e,t,n,r,s){t=t||r,i&&(t in i&&(i=i[t]),typeof i=="function"&&s&&(i=i()))}),i=(i==null||i==r?e:i)+"",i};return function(t,r){return String(t).replace(e,function(e,t){return n(e,t,r)})}}(),n.ninja=function(){return l.was?f.win.Raphael=l.is:delete Raphael,n},n.st=jn,function(e,t,r){function i(){/in/.test(e.readyState)?setTimeout(i,9):n.eve("raphael.DOMload")}e.readyState==null&&e.addEventListener&&(e.addEventListener(t,r=function(){e.removeEventListener(t,r,!1),e.readyState="complete"},!1),e.readyState="loading"),i()}(document,"DOMContentLoaded"),t.on("raphael.DOMload",function(){r=!0}),function(){if(!n.svg)return;var e="hasOwnProperty",t=String,r=parseFloat,i=parseInt,s=Math,o=s.max,u=s.abs,a=s.pow,f=/[, ]+/,l=n.eve,c="",h=" ",p="http://www.w3.org/1999/xlink",d={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},v={};n.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var m=function(r,i){if(i){typeof r=="string"&&(r=m(r));for(var s in i)i[e](s)&&(s.substring(0,6)=="xlink:"?r.setAttributeNS(p,s.substring(6),t(i[s])):r.setAttribute(s,t(i[s])))}else r=n._g.doc.createElementNS("http://www.w3.org/2000/svg",r),r.style&&(r.style.webkitTapHighlightColor="rgba(0,0,0,0)");return r},g=function(e,i){var f="linear",l=e.id+i,h=.5,p=.5,d=e.node,v=e.paper,g=d.style,y=n._g.doc.getElementById(l);if(!y){i=t(i).replace(n._radial_gradient,function(e,t,n){f="radial";if(t&&n){h=r(t),p=r(n);var i=(p>.5)*2-1;a(h-.5,2)+a(p-.5,2)>.25&&(p=s.sqrt(.25-a(h-.5,2))*i+.5)&&p!=.5&&(p=p.toFixed(5)-1e-5*i)}return c}),i=i.split(/\s*\-\s*/);if(f=="linear"){var b=i.shift();b=-r(b);if(isNaN(b))return null;var w=[0,0,s.cos(n.rad(b)),s.sin(n.rad(b))],E=1/(o(u(w[2]),u(w[3]))||1);w[2]*=E,w[3]*=E,w[2]<0&&(w[0]=-w[2],w[2]=0),w[3]<0&&(w[1]=-w[3],w[3]=0)}var S=n._parseDots(i);if(!S)return null;l=l.replace(/[\(\)\s,\xb0#]/g,"_"),e.gradient&&l!=e.gradient.id&&(v.defs.removeChild(e.gradient),delete e.gradient);if(!e.gradient){y=m(f+"Gradient",{id:l}),e.gradient=y,m(y,f=="radial"?{fx:h,fy:p}:{x1:w[0],y1:w[1],x2:w[2],y2:w[3],gradientTransform:e.matrix.invert()}),v.defs.appendChild(y);for(var x=0,T=S.length;x<T;x++)y.appendChild(m("stop",{offset:S[x].offset?S[x].offset:x?"100%":"0%","stop-color":S[x].color||"#fff"}))}}return m(d,{fill:"url(#"+l+")",opacity:1,"fill-opacity":1}),g.fill=c,g.opacity=1,g.fillOpacity=1,1},y=function(e){var t=e.getBBox(1);m(e.pattern,{patternTransform:e.matrix.invert()+" translate("+t.x+","+t.y+")"})},b=function(r,i,s){if(r.type=="path"){var o=t(i).toLowerCase().split("-"),u=r.paper,a=s?"end":"start",f=r.node,l=r.attrs,h=l["stroke-width"],p=o.length,g="classic",y,b,w,E,S,x=3,T=3,N=5;while(p--)switch(o[p]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":g=o[p];break;case"wide":T=5;break;case"narrow":T=2;break;case"long":x=5;break;case"short":x=2}g=="open"?(x+=2,T+=2,N+=2,w=1,E=s?4:1,S={fill:"none",stroke:l.stroke}):(E=w=x/2,S={fill:l.stroke,stroke:"none"}),r._.arrows?s?(r._.arrows.endPath&&v[r._.arrows.endPath]--,r._.arrows.endMarker&&v[r._.arrows.endMarker]--):(r._.arrows.startPath&&v[r._.arrows.startPath]--,r._.arrows.startMarker&&v[r._.arrows.startMarker]--):r._.arrows={};if(g!="none"){var C="raphael-marker-"+g,k="raphael-marker-"+a+g+x+T;n._g.doc.getElementById(C)?v[C]++:(u.defs.appendChild(m(m("path"),{"stroke-linecap":"round",d:d[g],id:C})),v[C]=1);var L=n._g.doc.getElementById(k),A;L?(v[k]++,A=L.getElementsByTagName("use")[0]):(L=m(m("marker"),{id:k,markerHeight:T,markerWidth:x,orient:"auto",refX:E,refY:T/2}),A=m(m("use"),{"xlink:href":"#"+C,transform:(s?"rotate(180 "+x/2+" "+T/2+") ":c)+"scale("+x/N+","+T/N+")","stroke-width":(1/((x/N+T/N)/2)).toFixed(4)}),L.appendChild(A),u.defs.appendChild(L),v[k]=1),m(A,S);var O=w*(g!="diamond"&&g!="oval");s?(y=r._.arrows.startdx*h||0,b=n.getTotalLength(l.path)-O*h):(y=O*h,b=n.getTotalLength(l.path)-(r._.arrows.enddx*h||0)),S={},S["marker-"+a]="url(#"+k+")";if(b||y)S.d=n.getSubpath(l.path,y,b);m(f,S),r._.arrows[a+"Path"]=C,r._.arrows[a+"Marker"]=k,r._.arrows[a+"dx"]=O,r._.arrows[a+"Type"]=g,r._.arrows[a+"String"]=i}else s?(y=r._.arrows.startdx*h||0,b=n.getTotalLength(l.path)-y):(y=0,b=n.getTotalLength(l.path)-(r._.arrows.enddx*h||0)),r._.arrows[a+"Path"]&&m(f,{d:n.getSubpath(l.path,y,b)}),delete r._.arrows[a+"Path"],delete r._.arrows[a+"Marker"],delete r._.arrows[a+"dx"],delete r._.arrows[a+"Type"],delete r._.arrows[a+"String"];for(S in v)if(v[e](S)&&!v[S]){var M=n._g.doc.getElementById(S);M&&M.parentNode.removeChild(M)}}},w={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},E=function(e,n,r){n=w[t(n).toLowerCase()];if(n){var i=e.attrs["stroke-width"]||"1",s={round:i,square:i,butt:0}[e.attrs["stroke-linecap"]||r["stroke-linecap"]]||0,o=[],u=n.length;while(u--)o[u]=n[u]*i+(u%2?1:-1)*s;m(e.node,{"stroke-dasharray":o.join(",")})}},S=function(r,s){var a=r.node,l=r.attrs,h=a.style.visibility;a.style.visibility="hidden";for(var d in s)if(s[e](d)){if(!n._availableAttrs[e](d))continue;var v=s[d];l[d]=v;switch(d){case"blur":r.blur(v);break;case"href":case"title":var w=m("title"),S=n._g.doc.createTextNode(v);w.appendChild(S),a.appendChild(w);break;case"target":var x=a.parentNode;if(x.tagName.toLowerCase()!="a"){var w=m("a");x.insertBefore(w,a),w.appendChild(a),x=w}d=="target"?x.setAttributeNS(p,"show",v=="blank"?"new":v):x.setAttributeNS(p,d,v);break;case"cursor":a.style.cursor=v;break;case"transform":r.transform(v);break;case"arrow-start":b(r,v);break;case"arrow-end":b(r,v,1);break;case"clip-rect":var N=t(v).split(f);if(N.length==4){r.clip&&r.clip.parentNode.parentNode.removeChild(r.clip.parentNode);var C=m("clipPath"),k=m("rect");C.id=n.createUUID(),m(k,{x:N[0],y:N[1],width:N[2],height:N[3]}),C.appendChild(k),r.paper.defs.appendChild(C),m(a,{"clip-path":"url(#"+C.id+")"}),r.clip=k}if(!v){var L=a.getAttribute("clip-path");if(L){var A=n._g.doc.getElementById(L.replace(/(^url\(#|\)$)/g,c));A&&A.parentNode.removeChild(A),m(a,{"clip-path":c}),delete r.clip}}break;case"path":r.type=="path"&&(m(a,{d:v?l.path=n._pathToAbsolute(v):"M0,0"}),r._.dirty=1,r._.arrows&&("startString"in r._.arrows&&b(r,r._.arrows.startString),"endString"in r._.arrows&&b(r,r._.arrows.endString,1)));break;case"width":a.setAttribute(d,v),r._.dirty=1;if(!l.fx)break;d="x",v=l.x;case"x":l.fx&&(v=-l.x-(l.width||0));case"rx":if(d=="rx"&&r.type=="rect")break;case"cx":a.setAttribute(d,v),r.pattern&&y(r),r._.dirty=1;break;case"height":a.setAttribute(d,v),r._.dirty=1;if(!l.fy)break;d="y",v=l.y;case"y":l.fy&&(v=-l.y-(l.height||0));case"ry":if(d=="ry"&&r.type=="rect")break;case"cy":a.setAttribute(d,v),r.pattern&&y(r),r._.dirty=1;break;case"r":r.type=="rect"?m(a,{rx:v,ry:v}):a.setAttribute(d,v),r._.dirty=1;break;case"src":r.type=="image"&&a.setAttributeNS(p,"href",v);break;case"stroke-width":if(r._.sx!=1||r._.sy!=1)v/=o(u(r._.sx),u(r._.sy))||1;r.paper._vbSize&&(v*=r.paper._vbSize),a.setAttribute(d,v),l["stroke-dasharray"]&&E(r,l["stroke-dasharray"],s),r._.arrows&&("startString"in r._.arrows&&b(r,r._.arrows.startString),"endString"in r._.arrows&&b(r,r._.arrows.endString,1));break;case"stroke-dasharray":E(r,v,s);break;case"fill":var O=t(v).match(n._ISURL);if(O){C=m("pattern");var M=m("image");C.id=n.createUUID(),m(C,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),m(M,{x:0,y:0,"xlink:href":O[1]}),C.appendChild(M),function(e){n._preload(O[1],function(){var t=this.offsetWidth,n=this.offsetHeight;m(e,{width:t,height:n}),m(M,{width:t,height:n}),r.paper&&r.paper.safari&&r.paper.safari()})}(C),r.paper.defs.appendChild(C),m(a,{fill:"url(#"+C.id+")"}),r.pattern=C,r.pattern&&y(r);break}var _=n.getRGB(v);if(!_.error)delete s.gradient,delete l.gradient,!n.is(l.opacity,"undefined")&&n.is(s.opacity,"undefined")&&m(a,{opacity:l.opacity}),!n.is(l["fill-opacity"],"undefined")&&n.is(s["fill-opacity"],"undefined")&&m(a,{"fill-opacity":l["fill-opacity"]});else if((r.type=="circle"||r.type=="ellipse"||t(v).charAt()!="r")&&g(r,v)){if("opacity"in l||"fill-opacity"in l){var D=n._g.doc.getElementById(a.getAttribute("fill").replace(/^url\(#|\)$/g,c));if(D){var P=D.getElementsByTagName("stop");m(P[P.length-1],{"stop-opacity":("opacity"in l?l.opacity:1)*("fill-opacity"in l?l["fill-opacity"]:1)})}}l.gradient=v,l.fill="none";break}_[e]("opacity")&&m(a,{"fill-opacity":_.opacity>1?_.opacity/100:_.opacity});case"stroke":_=n.getRGB(v),a.setAttribute(d,_.hex),d=="stroke"&&_[e]("opacity")&&m(a,{"stroke-opacity":_.opacity>1?_.opacity/100:_.opacity}),d=="stroke"&&r._.arrows&&("startString"in r._.arrows&&b(r,r._.arrows.startString),"endString"in r._.arrows&&b(r,r._.arrows.endString,1));break;case"gradient":(r.type=="circle"||r.type=="ellipse"||t(v).charAt()!="r")&&g(r,v);break;case"opacity":l.gradient&&!l[e]("stroke-opacity")&&m(a,{"stroke-opacity":v>1?v/100:v});case"fill-opacity":if(l.gradient){D=n._g.doc.getElementById(a.getAttribute("fill").replace(/^url\(#|\)$/g,c)),D&&(P=D.getElementsByTagName("stop"),m(P[P.length-1],{"stop-opacity":v}));break};default:d=="font-size"&&(v=i(v,10)+"px");var H=d.replace(/(\-.)/g,function(e){return e.substring(1).toUpperCase()});a.style[H]=v,r._.dirty=1,a.setAttribute(d,v)}}T(r,s),a.style.visibility=h},x=1.2,T=function(r,s){if(r.type!="text"||!(s[e]("text")||s[e]("font")||s[e]("font-size")||s[e]("x")||s[e]("y")))return;var o=r.attrs,u=r.node,a=u.firstChild?i(n._g.doc.defaultView.getComputedStyle(u.firstChild,c).getPropertyValue("font-size"),10):10;if(s[e]("text")){o.text=s.text;while(u.firstChild)u.removeChild(u.firstChild);var f=t(s.text).split("\n"),l=[],h;for(var p=0,d=f.length;p<d;p++)h=m("tspan"),p&&m(h,{dy:a*x,x:o.x}),h.appendChild(n._g.doc.createTextNode(f[p])),u.appendChild(h),l[p]=h}else{l=u.getElementsByTagName("tspan");for(p=0,d=l.length;p<d;p++)p?m(l[p],{dy:a*x,x:o.x}):m(l[0],{dy:0})}m(u,{x:o.x,y:o.y}),r._.dirty=1;var v=r._getBBox(),g=o.y-(v.y+v.height/2);g&&n.is(g,"finite")&&m(l[0],{dy:g})},N=function(e,t){var r=0,i=0;this[0]=this.node=e,e.raphael=!0,this.id=n._oid++,e.raphaelid=this.id,this.matrix=n.matrix(),this.realPath=null,this.paper=t,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!t.bottom&&(t.bottom=this),this.prev=t.top,t.top&&(t.top.next=this),t.top=this,this.next=null},C=n.el;N.prototype=C,C.constructor=N,n._engine.path=function(e,t){var n=m("path");t.canvas&&t.canvas.appendChild(n);var r=new N(n,t);return r.type="path",S(r,{fill:"none",stroke:"#000",path:e}),r},C.rotate=function(e,n,i){if(this.removed)return this;e=t(e).split(f),e.length-1&&(n=r(e[1]),i=r(e[2])),e=r(e[0]),i==null&&(n=i);if(n==null||i==null){var s=this.getBBox(1);n=s.x+s.width/2,i=s.y+s.height/2}return this.transform(this._.transform.concat([["r",e,n,i]])),this},C.scale=function(e,n,i,s){if(this.removed)return this;e=t(e).split(f),e.length-1&&(n=r(e[1]),i=r(e[2]),s=r(e[3])),e=r(e[0]),n==null&&(n=e),s==null&&(i=s);if(i==null||s==null)var o=this.getBBox(1);return i=i==null?o.x+o.width/2:i,s=s==null?o.y+o.height/2:s,this.transform(this._.transform.concat([["s",e,n,i,s]])),this},C.translate=function(e,n){return this.removed?this:(e=t(e).split(f),e.length-1&&(n=r(e[1])),e=r(e[0])||0,n=+n||0,this.transform(this._.transform.concat([["t",e,n]])),this)},C.transform=function(t){var r=this._;if(t==null)return r.transform;n._extractTransform(this,t),this.clip&&m(this.clip,{transform:this.matrix.invert()}),this.pattern&&y(this),this.node&&m(this.node,{transform:this.matrix});if(r.sx!=1||r.sy!=1){var i=this.attrs[e]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":i})}return this},C.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},C.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},C.remove=function(){if(this.removed||!this.node.parentNode)return;var e=this.paper;e.__set__&&e.__set__.exclude(this),l.unbind("raphael.*.*."+this.id),this.gradient&&e.defs.removeChild(this.gradient),n._tear(this,e),this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var t in this)this[t]=typeof this[t]=="function"?n._removedFactory(t):null;this.removed=!0},C._getBBox=function(){if(this.node.style.display=="none"){this.show();var e=!0}var t={};try{t=this.node.getBBox()}catch(n){}finally{t=t||{}}return e&&this.hide(),t},C.attr=function(t,r){if(this.removed)return this;if(t==null){var i={};for(var s in this.attrs)this.attrs[e](s)&&(i[s]=this.attrs[s]);return i.gradient&&i.fill=="none"&&(i.fill=i.gradient)&&delete i.gradient,i.transform=this._.transform,i}if(r==null&&n.is(t,"string")){if(t=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(t=="transform")return this._.transform;var o=t.split(f),u={};for(var a=0,c=o.length;a<c;a++)t=o[a],t in this.attrs?u[t]=this.attrs[t]:n.is(this.paper.customAttributes[t],"function")?u[t]=this.paper.customAttributes[t].def:u[t]=n._availableAttrs[t];return c-1?u:u[o[0]]}if(r==null&&n.is(t,"array")){u={};for(a=0,c=t.length;a<c;a++)u[t[a]]=this.attr(t[a]);return u}if(r!=null){var h={};h[t]=r}else t!=null&&n.is(t,"object")&&(h=t);for(var p in h)l("raphael.attr."+p+"."+this.id,this,h[p]);for(p in this.paper.customAttributes)if(this.paper.customAttributes[e](p)&&h[e](p)&&n.is(this.paper.customAttributes[p],"function")){var d=this.paper.customAttributes[p].apply(this,[].concat(h[p]));this.attrs[p]=h[p];for(var v in d)d[e](v)&&(h[v]=d[v])}return S(this,h),this},C.toFront=function(){if(this.removed)return this;this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var e=this.paper;return e.top!=this&&n._tofront(this,e),this},C.toBack=function(){if(this.removed)return this;var e=this.node.parentNode;e.tagName.toLowerCase()=="a"?e.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):e.firstChild!=this.node&&e.insertBefore(this.node,this.node.parentNode.firstChild),n._toback(this,this.paper);var t=this.paper;return this},C.insertAfter=function(e){if(this.removed)return this;var t=e.node||e[e.length-1].node;return t.nextSibling?t.parentNode.insertBefore(this.node,t.nextSibling):t.parentNode.appendChild(this.node),n._insertafter(this,e,this.paper),this},C.insertBefore=function(e){if(this.removed)return this;var t=e.node||e[0].node;return t.parentNode.insertBefore(this.node,t),n._insertbefore(this,e,this.paper),this},C.blur=function(e){var t=this;if(+e!==0){var r=m("filter"),i=m("feGaussianBlur");t.attrs.blur=e,r.id=n.createUUID(),m(i,{stdDeviation:+e||1.5}),r.appendChild(i),t.paper.defs.appendChild(r),t._blur=r,m(t.node,{filter:"url(#"+r.id+")"})}else t._blur&&(t._blur.parentNode.removeChild(t._blur),delete t._blur,delete t.attrs.blur),t.node.removeAttribute("filter");return t},n._engine.circle=function(e,t,n,r){var i=m("circle");e.canvas&&e.canvas.appendChild(i);var s=new N(i,e);return s.attrs={cx:t,cy:n,r:r,fill:"none",stroke:"#000"},s.type="circle",m(i,s.attrs),s},n._engine.rect=function(e,t,n,r,i,s){var o=m("rect");e.canvas&&e.canvas.appendChild(o);var u=new N(o,e);return u.attrs={x:t,y:n,width:r,height:i,r:s||0,rx:s||0,ry:s||0,fill:"none",stroke:"#000"},u.type="rect",m(o,u.attrs),u},n._engine.ellipse=function(e,t,n,r,i){var s=m("ellipse");e.canvas&&e.canvas.appendChild(s);var o=new N(s,e);return o.attrs={cx:t,cy:n,rx:r,ry:i,fill:"none",stroke:"#000"},o.type="ellipse",m(s,o.attrs),o},n._engine.image=function(e,t,n,r,i,s){var o=m("image");m(o,{x:n,y:r,width:i,height:s,preserveAspectRatio:"none"}),o.setAttributeNS(p,"href",t),e.canvas&&e.canvas.appendChild(o);var u=new N(o,e);return u.attrs={x:n,y:r,width:i,height:s,src:t},u.type="image",u},n._engine.text=function(e,t,r,i){var s=m("text");e.canvas&&e.canvas.appendChild(s);var o=new N(s,e);return o.attrs={x:t,y:r,"text-anchor":"middle",text:i,font:n._availableAttrs.font,stroke:"none",fill:"#000"},o.type="text",S(o,o.attrs),o},n._engine.setSize=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},n._engine.create=function(){var e=n._getContainer.apply(0,arguments),t=e&&e.container,r=e.x,i=e.y,s=e.width,o=e.height;if(!t)throw new Error("SVG container not found.");var u=m("svg"),a="overflow:hidden;",f;return r=r||0,i=i||0,s=s||512,o=o||342,m(u,{height:o,version:1.1,width:s,xmlns:"http://www.w3.org/2000/svg"}),t==1?(u.style.cssText=a+"position:absolute;left:"+r+"px;top:"+i+"px",n._g.doc.body.appendChild(u),f=1):(u.style.cssText=a+"position:relative",t.firstChild?t.insertBefore(u,t.firstChild):t.appendChild(u)),t=new n._Paper,t.width=s,t.height=o,t.canvas=u,t.clear(),t._left=t._top=0,f&&(t.renderfix=function(){}),t.renderfix(),t},n._engine.setViewBox=function(e,t,n,r,i){l("raphael.setViewBox",this,this._viewBox,[e,t,n,r,i]);var s=o(n/this.width,r/this.height),u=this.top,a=i?"meet":"xMinYMin",f,c;e==null?(this._vbSize&&(s=1),delete this._vbSize,f="0 0 "+this.width+h+this.height):(this._vbSize=s,f=e+h+t+h+n+h+r),m(this.canvas,{viewBox:f,preserveAspectRatio:a});while(s&&u)c="stroke-width"in u.attrs?u.attrs["stroke-width"]:1,u.attr({"stroke-width":c}),u._.dirty=1,u._.dirtyT=1,u=u.prev;return this._viewBox=[e,t,n,r,!!i],this},n.prototype.renderfix=function(){var e=this.canvas,t=e.style,n;try{n=e.getScreenCTM()||e.createSVGMatrix()}catch(r){n=e.createSVGMatrix()}var i=-n.e%1,s=-n.f%1;if(i||s)i&&(this._left=(this._left+i)%1,t.left=this._left+"px"),s&&(this._top=(this._top+s)%1,t.top=this._top+"px")},n.prototype.clear=function(){n.eve("raphael.clear",this);var e=this.canvas;while(e.firstChild)e.removeChild(e.firstChild);this.bottom=this.top=null,(this.desc=m("desc")).appendChild(n._g.doc.createTextNode("Created with Raphaël "+n.version)),e.appendChild(this.desc),e.appendChild(this.defs=m("defs"))},n.prototype.remove=function(){l("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]=typeof this[e]=="function"?n._removedFactory(e):null};var k=n.st;for(var L in C)C[e](L)&&!k[e](L)&&(k[L]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e].apply(n,t)})}}(L))}(),function(){if(!n.vml)return;var e="hasOwnProperty",t=String,r=parseFloat,i=Math,s=i.round,o=i.max,u=i.min,a=i.abs,f="fill",l=/[, ]+/,c=n.eve,h=" progid:DXImageTransform.Microsoft",p=" ",d="",v={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},m=/([clmz]),?([^clmz]*)/gi,g=/ progid:\S+Blur\([^\)]+\)/g,y=/-?[^,\s-]+/g,b="position:absolute;left:0;top:0;width:1px;height:1px",w=21600,E={path:1,rect:1,image:1},S={circle:1,ellipse:1},x=function(e){var r=/[ahqstv]/ig,i=n._pathToAbsolute;t(e).match(r)&&(i=n._path2curve),r=/[clmz]/g;if(i==n._pathToAbsolute&&!t(e).match(r)){var o=t(e).replace(m,function(e,t,n){var r=[],i=t.toLowerCase()=="m",o=v[t];return n.replace(y,function(e){i&&r.length==2&&(o+=r+v[t=="m"?"l":"L"],r=[]),r.push(s(e*w))}),o+r});return o}var u=i(e),a,f;o=[];for(var l=0,c=u.length;l<c;l++){a=u[l],f=u[l][0].toLowerCase(),f=="z"&&(f="x");for(var h=1,g=a.length;h<g;h++)f+=s(a[h]*w)+(h!=g-1?",":d);o.push(f)}return o.join(p)},T=function(e,t,r){var i=n.matrix();return i.rotate(-e,.5,.5),{dx:i.x(t,r),dy:i.y(t,r)}},N=function(e,t,n,r,i,s){var o=e._,u=e.matrix,l=o.fillpos,c=e.node,h=c.style,d=1,v="",m,g=w/t,y=w/n;h.visibility="hidden";if(!t||!n)return;c.coordsize=a(g)+p+a(y),h.rotation=s*(t*n<0?-1:1);if(s){var b=T(s,r,i);r=b.dx,i=b.dy}t<0&&(v+="x"),n<0&&(v+=" y")&&(d=-1),h.flip=v,c.coordorigin=r*-g+p+i*-y;if(l||o.fillsize){var E=c.getElementsByTagName(f);E=E&&E[0],c.removeChild(E),l&&(b=T(s,u.x(l[0],l[1]),u.y(l[0],l[1])),E.position=b.dx*d+p+b.dy*d),o.fillsize&&(E.size=o.fillsize[0]*a(t)+p+o.fillsize[1]*a(n)),c.appendChild(E)}h.visibility="visible"};n.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var C=function(e,n,r){var i=t(n).toLowerCase().split("-"),s=r?"end":"start",o=i.length,u="classic",a="medium",f="medium";while(o--)switch(i[o]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":u=i[o];break;case"wide":case"narrow":f=i[o];break;case"long":case"short":a=i[o]}var l=e.node.getElementsByTagName("stroke")[0];l[s+"arrow"]=u,l[s+"arrowlength"]=a,l[s+"arrowwidth"]=f},k=function(i,a){i.attrs=i.attrs||{};var c=i.node,h=i.attrs,v=c.style,m,g=E[i.type]&&(a.x!=h.x||a.y!=h.y||a.width!=h.width||a.height!=h.height||a.cx!=h.cx||a.cy!=h.cy||a.rx!=h.rx||a.ry!=h.ry||a.r!=h.r),y=S[i.type]&&(h.cx!=a.cx||h.cy!=a.cy||h.r!=a.r||h.rx!=a.rx||h.ry!=a.ry),b=i;for(var T in a)a[e](T)&&(h[T]=a[T]);g&&(h.path=n._getPath[i.type](i),i._.dirty=1),a.href&&(c.href=a.href),a.title&&(c.title=a.title),a.target&&(c.target=a.target),a.cursor&&(v.cursor=a.cursor),"blur"in a&&i.blur(a.blur);if(a.path&&i.type=="path"||g)c.path=x(~t(h.path).toLowerCase().indexOf("r")?n._pathToAbsolute(h.path):h.path),i.type=="image"&&(i._.fillpos=[h.x,h.y],i._.fillsize=[h.width,h.height],N(i,1,1,0,0,0));"transform"in a&&i.transform(a.transform);if(y){var k=+h.cx,A=+h.cy,O=+h.rx||+h.r||0,_=+h.ry||+h.r||0;c.path=n.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",s((k-O)*w),s((A-_)*w),s((k+O)*w),s((A+_)*w),s(k*w)),i._.dirty=1}if("clip-rect"in a){var D=t(a["clip-rect"]).split(l);if(D.length==4){D[2]=+D[2]+ +D[0],D[3]=+D[3]+ +D[1];var P=c.clipRect||n._g.doc.createElement("div"),H=P.style;H.clip=n.format("rect({1}px {2}px {3}px {0}px)",D),c.clipRect||(H.position="absolute",H.top=0,H.left=0,H.width=i.paper.width+"px",H.height=i.paper.height+"px",c.parentNode.insertBefore(P,c),P.appendChild(c),c.clipRect=P)}a["clip-rect"]||c.clipRect&&(c.clipRect.style.clip="auto")}if(i.textpath){var B=i.textpath.style;a.font&&(B.font=a.font),a["font-family"]&&(B.fontFamily='"'+a["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,d)+'"'),a["font-size"]&&(B.fontSize=a["font-size"]),a["font-weight"]&&(B.fontWeight=a["font-weight"]),a["font-style"]&&(B.fontStyle=a["font-style"])}"arrow-start"in a&&C(b,a["arrow-start"]),"arrow-end"in a&&C(b,a["arrow-end"],1);if(a.opacity!=null||a["stroke-width"]!=null||a.fill!=null||a.src!=null||a.stroke!=null||a["stroke-width"]!=null||a["stroke-opacity"]!=null||a["fill-opacity"]!=null||a["stroke-dasharray"]!=null||a["stroke-miterlimit"]!=null||a["stroke-linejoin"]!=null||a["stroke-linecap"]!=null){var j=c.getElementsByTagName(f),F=!1;j=j&&j[0],!j&&(F=j=M(f)),i.type=="image"&&a.src&&(j.src=a.src),a.fill&&(j.on=!0);if(j.on==null||a.fill=="none"||a.fill===null)j.on=!1;if(j.on&&a.fill){var I=t(a.fill).match(n._ISURL);if(I){j.parentNode==c&&c.removeChild(j),j.rotate=!0,j.src=I[1],j.type="tile";var q=i.getBBox(1);j.position=q.x+p+q.y,i._.fillpos=[q.x,q.y],n._preload(I[1],function(){i._.fillsize=[this.offsetWidth,this.offsetHeight]})}else j.color=n.getRGB(a.fill).hex,j.src=d,j.type="solid",n.getRGB(a.fill).error&&(b.type in{circle:1,ellipse:1}||t(a.fill).charAt()!="r")&&L(b,a.fill,j)&&(h.fill="none",h.gradient=a.fill,j.rotate=!1)}if("fill-opacity"in a||"opacity"in a){var R=((+h["fill-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+n.getRGB(a.fill).o+1||2)-1);R=u(o(R,0),1),j.opacity=R,j.src&&(j.color="none")}c.appendChild(j);var U=c.getElementsByTagName("stroke")&&c.getElementsByTagName("stroke")[0],z=!1;!U&&(z=U=M("stroke"));if(a.stroke&&a.stroke!="none"||a["stroke-width"]||a["stroke-opacity"]!=null||a["stroke-dasharray"]||a["stroke-miterlimit"]||a["stroke-linejoin"]||a["stroke-linecap"])U.on=!0;(a.stroke=="none"||a.stroke===null||U.on==null||a.stroke==0||a["stroke-width"]==0)&&(U.on=!1);var W=n.getRGB(a.stroke);U.on&&a.stroke&&(U.color=W.hex),R=((+h["stroke-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+W.o+1||2)-1);var X=(r(a["stroke-width"])||1)*.75;R=u(o(R,0),1),a["stroke-width"]==null&&(X=h["stroke-width"]),a["stroke-width"]&&(U.weight=X),X&&X<1&&(R*=X)&&(U.weight=1),U.opacity=R,a["stroke-linejoin"]&&(U.joinstyle=a["stroke-linejoin"]||"miter"),U.miterlimit=a["stroke-miterlimit"]||8,a["stroke-linecap"]&&(U.endcap=a["stroke-linecap"]=="butt"?"flat":a["stroke-linecap"]=="square"?"square":"round");if(a["stroke-dasharray"]){var V={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};U.dashstyle=V[e](a["stroke-dasharray"])?V[a["stroke-dasharray"]]:d}z&&c.appendChild(U)}if(b.type=="text"){b.paper.canvas.style.display=d;var $=b.paper.span,J=100,K=h.font&&h.font.match(/\d+(?:\.\d*)?(?=px)/);v=$.style,h.font&&(v.font=h.font),h["font-family"]&&(v.fontFamily=h["font-family"]),h["font-weight"]&&(v.fontWeight=h["font-weight"]),h["font-style"]&&(v.fontStyle=h["font-style"]),K=r(h["font-size"]||K&&K[0])||10,v.fontSize=K*J+"px",b.textpath.string&&($.innerHTML=t(b.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var Q=$.getBoundingClientRect();b.W=h.w=(Q.right-Q.left)/J,b.H=h.h=(Q.bottom-Q.top)/J,b.X=h.x,b.Y=h.y+b.H/2,("x"in a||"y"in a)&&(b.path.v=n.format("m{0},{1}l{2},{1}",s(h.x*w),s(h.y*w),s(h.x*w)+1));var G=["x","y","text","font","font-family","font-weight","font-style","font-size"];for(var Y=0,Z=G.length;Y<Z;Y++)if(G[Y]in a){b._.dirty=1;break}switch(h["text-anchor"]){case"start":b.textpath.style["v-text-align"]="left",b.bbx=b.W/2;break;case"end":b.textpath.style["v-text-align"]="right",b.bbx=-b.W/2;break;default:b.textpath.style["v-text-align"]="center",b.bbx=0}b.textpath.style["v-text-kern"]=!0}},L=function(e,s,o){e.attrs=e.attrs||{};var u=e.attrs,a=Math.pow,f,l,c="linear",h=".5 .5";e.attrs.gradient=s,s=t(s).replace(n._radial_gradient,function(e,t,n){return c="radial",t&&n&&(t=r(t),n=r(n),a(t-.5,2)+a(n-.5,2)>.25&&(n=i.sqrt(.25-a(t-.5,2))*((n>.5)*2-1)+.5),h=t+p+n),d}),s=s.split(/\s*\-\s*/);if(c=="linear"){var v=s.shift();v=-r(v);if(isNaN(v))return null}var m=n._parseDots(s);if(!m)return null;e=e.shape||e.node;if(m.length){e.removeChild(o),o.on=!0,o.method="none",o.color=m[0].color,o.color2=m[m.length-1].color;var g=[];for(var y=0,b=m.length;y<b;y++)m[y].offset&&g.push(m[y].offset+p+m[y].color);o.colors=g.length?g.join():"0% "+o.color,c=="radial"?(o.type="gradientTitle",o.focus="100%",o.focussize="0 0",o.focusposition=h,o.angle=0):(o.type="gradient",o.angle=(270-v)%360),e.appendChild(o)}return 1},A=function(e,t){this[0]=this.node=e,e.raphael=!0,this.id=n._oid++,e.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=t,this.matrix=n.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!t.bottom&&(t.bottom=this),this.prev=t.top,t.top&&(t.top.next=this),t.top=this,this.next=null},O=n.el;A.prototype=O,O.constructor=A,O.transform=function(e){if(e==null)return this._.transform;var r=this.paper._viewBoxShift,i=r?"s"+[r.scale,r.scale]+"-1-1t"+[r.dx,r.dy]:d,s;r&&(s=e=t(e).replace(/\.{3}|\u2026/g,this._.transform||d)),n._extractTransform(this,i+e);var o=this.matrix.clone(),u=this.skew,a=this.node,f,l=~t(this.attrs.fill).indexOf("-"),c=!t(this.attrs.fill).indexOf("url(");o.translate(1,1);if(c||l||this.type=="image"){u.matrix="1 0 0 1",u.offset="0 0",f=o.split();if(l&&f.noRotation||!f.isSimple){a.style.filter=o.toFilter();var h=this.getBBox(),v=this.getBBox(1),m=h.x-v.x,g=h.y-v.y;a.coordorigin=m*-w+p+g*-w,N(this,1,1,m,g,0)}else a.style.filter=d,N(this,f.scalex,f.scaley,f.dx,f.dy,f.rotate)}else a.style.filter=d,u.matrix=t(o),u.offset=o.offset();return s&&(this._.transform=s),this},O.rotate=function(e,n,i){if(this.removed)return this;if(e==null)return;e=t(e).split(l),e.length-1&&(n=r(e[1]),i=r(e[2])),e=r(e[0]),i==null&&(n=i);if(n==null||i==null){var s=this.getBBox(1);n=s.x+s.width/2,i=s.y+s.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",e,n,i]])),this},O.translate=function(e,n){return this.removed?this:(e=t(e).split(l),e.length-1&&(n=r(e[1])),e=r(e[0])||0,n=+n||0,this._.bbox&&(this._.bbox.x+=e,this._.bbox.y+=n),this.transform(this._.transform.concat([["t",e,n]])),this)},O.scale=function(e,n,i,s){if(this.removed)return this;e=t(e).split(l),e.length-1&&(n=r(e[1]),i=r(e[2]),s=r(e[3]),isNaN(i)&&(i=null),isNaN(s)&&(s=null)),e=r(e[0]),n==null&&(n=e),s==null&&(i=s);if(i==null||s==null)var o=this.getBBox(1);return i=i==null?o.x+o.width/2:i,s=s==null?o.y+o.height/2:s,this.transform(this._.transform.concat([["s",e,n,i,s]])),this._.dirtyT=1,this},O.hide=function(){return!this.removed&&(this.node.style.display="none"),this},O.show=function(){return!this.removed&&(this.node.style.display=d),this},O._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},O.remove=function(){if(this.removed||!this.node.parentNode)return;this.paper.__set__&&this.paper.__set__.exclude(this),n.eve.unbind("raphael.*.*."+this.id),n._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var e in this)this[e]=typeof this[e]=="function"?n._removedFactory(e):null;this.removed=!0},O.attr=function(t,r){if(this.removed)return this;if(t==null){var i={};for(var s in this.attrs)this.attrs[e](s)&&(i[s]=this.attrs[s]);return i.gradient&&i.fill=="none"&&(i.fill=i.gradient)&&delete i.gradient,i.transform=this._.transform,i}if(r==null&&n.is(t,"string")){if(t==f&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;var o=t.split(l),u={};for(var a=0,h=o.length;a<h;a++)t=o[a],t in this.attrs?u[t]=this.attrs[t]:n.is(this.paper.customAttributes[t],"function")?u[t]=this.paper.customAttributes[t].def:u[t]=n._availableAttrs[t];return h-1?u:u[o[0]]}if(this.attrs&&r==null&&n.is(t,"array")){u={};for(a=0,h=t.length;a<h;a++)u[t[a]]=this.attr(t[a]);return u}var p;r!=null&&(p={},p[t]=r),r==null&&n.is(t,"object")&&(p=t);for(var d in p)c("raphael.attr."+d+"."+this.id,this,p[d]);if(p){for(d in this.paper.customAttributes)if(this.paper.customAttributes[e](d)&&p[e](d)&&n.is(this.paper.customAttributes[d],"function")){var v=this.paper.customAttributes[d].apply(this,[].concat(p[d]));this.attrs[d]=p[d];for(var m in v)v[e](m)&&(p[m]=v[m])}p.text&&this.type=="text"&&(this.textpath.string=p.text),k(this,p)}return this},O.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&n._tofront(this,this.paper),this},O.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),n._toback(this,this.paper)),this)},O.insertAfter=function(e){return this.removed?this:(e.constructor==n.st.constructor&&(e=e[e.length-1]),e.node.nextSibling?e.node.parentNode.insertBefore(this.node,e.node.nextSibling):e.node.parentNode.appendChild(this.node),n._insertafter(this,e,this.paper),this)},O.insertBefore=function(e){return this.removed?this:(e.constructor==n.st.constructor&&(e=e[0]),e.node.parentNode.insertBefore(this.node,e.node),n._insertbefore(this,e,this.paper),this)},O.blur=function(e){var t=this.node.runtimeStyle,r=t.filter;return r=r.replace(g,d),+e!==0?(this.attrs.blur=e,t.filter=r+p+h+".Blur(pixelradius="+(+e||1.5)+")",t.margin=n.format("-{0}px 0 0 -{0}px",s(+e||1.5))):(t.filter=r,t.margin=0,delete this.attrs.blur),this},n._engine.path=function(e,t){var n=M("shape");n.style.cssText=b,n.coordsize=w+p+w,n.coordorigin=t.coordorigin;var r=new A(n,t),i={fill:"none",stroke:"#000"};e&&(i.path=e),r.type="path",r.path=[],r.Path=d,k(r,i),t.canvas.appendChild(n);var s=M("skew");return s.on=!0,n.appendChild(s),r.skew=s,r.transform(d),r},n._engine.rect=function(e,t,r,i,s,o){var u=n._rectPath(t,r,i,s,o),a=e.path(u),f=a.attrs;return a.X=f.x=t,a.Y=f.y=r,a.W=f.width=i,a.H=f.height=s,f.r=o,f.path=u,a.type="rect",a},n._engine.ellipse=function(e,t,n,r,i){var s=e.path(),o=s.attrs;return s.X=t-r,s.Y=n-i,s.W=r*2,s.H=i*2,s.type="ellipse",k(s,{cx:t,cy:n,rx:r,ry:i}),s},n._engine.circle=function(e,t,n,r){var i=e.path(),s=i.attrs;return i.X=t-r,i.Y=n-r,i.W=i.H=r*2,i.type="circle",k(i,{cx:t,cy:n,r:r}),i},n._engine.image=function(e,t,r,i,s,o){var u=n._rectPath(r,i,s,o),a=e.path(u).attr({stroke:"none"}),l=a.attrs,c=a.node,h=c.getElementsByTagName(f)[0];return l.src=t,a.X=l.x=r,a.Y=l.y=i,a.W=l.width=s,a.H=l.height=o,l.path=u,a.type="image",h.parentNode==c&&c.removeChild(h),h.rotate=!0,h.src=t,h.type="tile",a._.fillpos=[r,i],a._.fillsize=[s,o],c.appendChild(h),N(a,1,1,0,0,0),a},n._engine.text=function(e,r,i,o){var u=M("shape"),a=M("path"),f=M("textpath");r=r||0,i=i||0,o=o||"",a.v=n.format("m{0},{1}l{2},{1}",s(r*w),s(i*w),s(r*w)+1),a.textpathok=!0,f.string=t(o),f.on=!0,u.style.cssText=b,u.coordsize=w+p+w,u.coordorigin="0 0";var l=new A(u,e),c={fill:"#000",stroke:"none",font:n._availableAttrs.font,text:o};l.shape=u,l.path=a,l.textpath=f,l.type="text",l.attrs.text=t(o),l.attrs.x=r,l.attrs.y=i,l.attrs.w=1,l.attrs.h=1,k(l,c),u.appendChild(f),u.appendChild(a),e.canvas.appendChild(u);var h=M("skew");return h.on=!0,u.appendChild(h),l.skew=h,l.transform(d),l},n._engine.setSize=function(e,t){var r=this.canvas.style;return this.width=e,this.height=t,e==+e&&(e+="px"),t==+t&&(t+="px"),r.width=e,r.height=t,r.clip="rect(0 "+e+" "+t+" 0)",this._viewBox&&n._engine.setViewBox.apply(this,this._viewBox),this},n._engine.setViewBox=function(e,t,r,i,s){n.eve("raphael.setViewBox",this,this._viewBox,[e,t,r,i,s]);var u=this.width,a=this.height,f=1/o(r/u,i/a),l,c;return s&&(l=a/i,c=u/r,r*l<u&&(e-=(u-r*l)/2/l),i*c<a&&(t-=(a-i*c)/2/c)),this._viewBox=[e,t,r,i,!!s],this._viewBoxShift={dx:-e,dy:-t,scale:f},this.forEach(function(e){e.transform("...")}),this};var M;n._engine.initWin=function(e){var t=e.document;t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!t.namespaces.rvml&&t.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),M=function(e){return t.createElement("<rvml:"+e+' class="rvml">')}}catch(n){M=function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},n._engine.initWin(n._g.win),n._engine.create=function(){var e=n._getContainer.apply(0,arguments),t=e.container,r=e.height,i,s=e.width,o=e.x,u=e.y;if(!t)throw new Error("VML container not found.");var a=new n._Paper,f=a.canvas=n._g.doc.createElement("div"),l=f.style;return o=o||0,u=u||0,s=s||512,r=r||342,a.width=s,a.height=r,s==+s&&(s+="px"),r==+r&&(r+="px"),a.coordsize=w*1e3+p+w*1e3,a.coordorigin="0 0",a.span=n._g.doc.createElement("span"),a.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",f.appendChild(a.span),l.cssText=n.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",s,r),t==1?(n._g.doc.body.appendChild(f),l.left=o+"px",l.top=u+"px",l.position="absolute"):t.firstChild?t.insertBefore(f,t.firstChild):t.appendChild(f),a.renderfix=function(){},a},n.prototype.clear=function(){n.eve("raphael.clear",this),this.canvas.innerHTML=d,this.span=n._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},n.prototype.remove=function(){n.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]=typeof this[e]=="function"?n._removedFactory(e):null;return!0};var _=n.st;for(var D in O)O[e](D)&&!_[e](D)&&(_[D]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e].apply(n,t)})}}(D))}(),l.was?f.win.Raphael=n:Raphael=n,n}),define("baseView",[],function(){var e=Backbone.View.extend({});return e.prototype.wrapString=function(e,t,n,r){n=n||"\n",t=t||75,r=r||!1;if(!e)return e;var i=".{1,"+t+"}(\\s|$)"+(r?"|.{"+t+"}|.+$":"|\\S+?(\\s|$)");return e.match(RegExp(i,"g")).join(n)},e.prototype.toggleForm=function(){this.$pointForm.toggleClass("hide"),this.$pointData.toggleClass("hide"),this.$toggle.toggleClass("hide-data"),this.$toggle.toggleClass("show-data")},e.prototype.base64ToBinary=function(e){var t=";base64,",n=e.indexOf(t)+t.length,r=e.substring(n),s=window.atob(r),o=s.length,u=new Uint8Array(new ArrayBuffer(o));for(i=0;i<o;++i)u[i]=s.charCodeAt(i);return u},e}),define("baseModel",[],function(){var e=Backbone.Model.extend({sync:function(){return!1}});return _.extend(this.Backbone.Events),e.prototype.update=function(){this.trigger("update")},e.prototype.toggle=function(){this.trigger("toggle")},e.prototype.delete=function(){this.trigger("delete")},e}),define("cursor",["baseModel"],function(e){var t=e.extend({constructor:function(t,n){var r=[{lockH:!1,lockV:!1}];e.apply(this,r)}});return t}),define("cursorView",["baseView","cursor"],function(e,t){var n=e.extend({el:".main",classname:"CursorView",events:{keypress:"togglelock",'click a[href="#lock-cursor-h"]':"toggleHlock",'click a[href="#lock-cursor-v"]':"toggleVlock"}});return n.prototype.initialize=function(e){this.app=e,this.cursor=new t,this.app.Cursor=this.cursor,this.$hLock=this.$('a[href="#lock-cursor-h"]'),this.$vLock=this.$('a[href="#lock-cursor-v"]')},n.prototype.togglelock=function(e){e.keyCode==TimescaleApp.KEY_MINUS&&this.toggleHlock(),e.keyCode==TimescaleApp.KEY_EQUAL&&this.toggleVlock()},n.prototype.toggleHlock=function(){this.$vLock.parent().hasClass("active")&&this.toggleVlock(),this.$hLock.parent().toggleClass("active"),this.cursor.set({lockH:!this.cursor.get("lockH")})},n.prototype.toggleVlock=function(){this.$hLock.parent().hasClass("active")&&this.toggleHlock(),this.$vLock.parent().toggleClass("active"),this.cursor.set({lockV:!this.cursor.get("lockV")})},n}),define("transectView",["baseView"],function(e){var t=e.extend({tagName:"li",classname:"TransectView",events:{"click .toggle":"toggleTransectForm","click .transect-data":"toggleTransectForm","keypress :input":"updateTransect","keyup :input":"updateTransect",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return t.prototype.template=new EJS({url:"../../../transect_maker/ejs/transect.ejs"}),t.prototype.initialize=function(e,t){this.app=e,this.transect=t,this.listenTo(this.transect,"update",this.render.bind(this)),this.listenTo(this.transect,"change:edit",this.toggleEditStatus.bind(this)),this.listenTo(this.transect,"destroy",this.delete.bind(this)),this.listenTo(this.transect.get("wellLeft"),"dragEnd",this.wellsMoved.bind(this)),this.listenTo(this.transect.get("wellRight"),"dragEnd",this.wellsMoved.bind(this)),this.listenTo(this.app.TransectWellsCollection,"add",this.checkAndDelete.bind(this)),this.render()},t.prototype.render=function(){this.$el.html(this.template.render(this.transect.toJSON())),this.$transectForm=this.$(".transect-form"),this.$transectData=this.$(".transect-data"),this.$destroy=this.$(".destroy"),this.$toggle=this.$(".toggle"),this.$update=this.$(".update"),this.$name=this.$("input[name*=transect-name]")[0],this.$description=this.$("textarea[name*=transect-description]")[0]},t.prototype.toggleTransectForm=function(){this.render(),this.transect.set({edit:!this.transect.get("edit")})},t.prototype.toggleEditStatus=function(){this.transect.get("edit")?(this.$transectForm.removeClass("hide"),this.$transectData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$transectForm.addClass("hide"),this.$transectData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},t.prototype.onMouseOver=function(){this.$el.addClass("hover"),this.transect.get("wellLeft").set({hover:!0}),this.transect.get("wellRight").set({hover:!0})},t.prototype.onMouseOut=function(){this.$el.removeClass("hover"),this.transect.get("wellLeft").set({hover:!1}),this.transect.get("wellRight").set({hover:!1})},t.prototype.updateTransect=function(e){(e.keyCode==TimescaleApp.ENTER||e.keyCode==TimescaleApp.ESC)&&this.toggleTransectForm();var t=this.$name.value,n=this.$description.value.split("\n").join(" ");this.transect.set({name:t,description:n})},t.prototype.delete=function(){this.element!==undefined&&this.element.remove(),this.$el.remove(),this.remove()},t.prototype.checkAndDelete=function(e){var t=e.get("x");this.transect.isXInsideTransect(t)&&this.transect.destroy()},t.prototype.wellsMoved=function(){this.transect.update()},t}),define("baseCollection",[],function(){var e=Backbone.Collection.extend({});return e}),define("settings",["baseModel"],function(e){var t=e.extend({classname:"Settings",constructor:function(t,n){var r=[{fontFamily:t?t.fontFamily:"Arial, Helvetica, sans-serif",fontVariant:t?t.fontVariant:"normal",fontWeight:t?t.fontWeight:"normal",fontStretch:t?t.fontStretch:"normal",fontSize:t?t.fontSize:12,backgroundColor:t&&t.backgroundColor?t.backgroundColor:"#DDDDDD",strokeWidth:t?t.strokeWidth:3,strokeColor:t?t.strokeColor:"#000000"}];e.apply(this,r)}});return t}),define("transect",["baseModel","settings"],function(e,t){var n=e.extend({classname:"Transect",constructor:function(n,r,i,s){this.app=s;var o=[{name:n.name||_.uniqueId("Transect-"),id:_.uniqueId("transect-"),description:n.description||null,wellLeft:r,wellRight:i,settings:new t,width:500,status:"on"}];e.apply(this,o)}});return n.prototype.isXInsideTransect=function(e){return this.get("wellLeft").get("x")<e&&e<this.get("wellRight").get("x")?!0:!1},n.prototype.getAbsoluteX=function(e){var t=this.get("wellLeft").get("x")+(this.get("wellRight").get("x")-this.get("wellLeft").get("x"))*e;return t},n.prototype.getRelativeX=function(e){if(this.get("wellLeft").get("x")<e&&e<this.get("wellRight").get("x")){var t=(e-this.get("wellLeft").get("x"))/(this.get("wellRight").get("x")-this.get("wellLeft").get("x"));return Math.round(t*1e3)/1e3}return null},n.prototype.getPolyKPointsArray=function(){return[this.get("wellLeft").get("x")-2,0,this.get("wellRight").get("x")+2,0,this.get("wellRight").get("x")+2,this.app.height,this.get("wellLeft").get("x")-2,this.app.height]},n});var transectApp=transectApp||{};define("transects",["baseCollection","transect"],function(e,t){var n=e.extend({classname:"Transects",model:t});return n.prototype.comparator=function(e){return e.get("wellLeft").get("x")},n.prototype.getTransectForX=function(e){var t=null;return this.each(function(n){n.isXInsideTransect(e)&&(t=n)}),t},n.prototype.getTransectInNeighborhoodForX=function(e,t){this.sort();if(!t)return null;var n=this.indexOf(t),r=this.at(n-1),i=this.at(n+1);return r&&r.isXInsideTransect(e)?r:i&&i.isXInsideTransect(e)?i:t.isXInsideTransect(e)?t:null},n}),define("transectsView",["baseView","transectView","transects"],function(e,t,n){var r=e.extend({el:"#transects-list",classname:"TransectsView"});return r.prototype.template=new EJS({url:"/commons/ejs/data_tbl.ejs"}),r.prototype.initialize=function(e){this.app=e,this.transects=this.app.TransectsCollection,this.render(),this.listenTo(this.transects,"add",this.addTransect.bind(this)),this.listenTo(this.transects,"reset",this.resetTransect.bind(this))},r.prototype.render=function(){this.$el.html(this.template.render({name:"Transect"})),this.$transectsTable=this.$(".data-list"),this.transects.each(this.addTransect.bind(this))},r.prototype.addTransect=function(e){var n=new t(this.app,e);this.$transectsTable.append(n.el)},r.prototype.resetTransect=function(){this.$transectsTable.html(""),this.transects.each(this.addTransect,this),this.app.PointsCollection.updatePoints(),this.app.TransectTextsCollection.updateTransectTexts()},r}),define("imageOb",["baseModel"],function(e){var t=e.extend({classname:"ImageOb",constructor:function(t,n){var r=[{x:t&&"x"in t?t.x:0,y:t&&"y"in t?t.y:0,width:t&&"width"in t?t.width:null,height:t&&"height"in t?t.height:null,origWidth:t&&"origWidth"in t?t.origWidth:null,origHeight:t&&"origHeight"in t?t.origHeight:null,angle:t&&"angle"in t?t.angle:0,preserveAspectRatio:t&&"preserveAspectRatio"in t?t.preserveAspectRatio:!0,visible:t&&"visible"in t?t.visible:!0,data:t&&"data"in t?t.data:null}];e.apply(this,r)}});return t}),define("imageView",["baseView","imageOb"],function(e,t){var n=e.extend({el:"#bg-image-settings-list",classname:"ImageObView",events:{'change input[name="width"]':"updateImageWidth",'change input[name="height"]':"updateImageHeight",'change input[name="preserve-aspect-ratio"]':"updateImage",'change input[name="image-visible"]':"updateImage",'change input[name="angle"]':"updateImage","dragover #image-box":"imageDragover","drop #image-box":"imageDrop"}});return n.prototype.template=new EJS({url:"/transect_maker/ejs/transect_image_settings.ejs"}),n.prototype.initialize=function(e){this.app=e,this.image=this.app.ImageOb,this.listenTo(this.image,"change:data",this.renderData.bind(this)),this.listenTo(this.image,"change:width",this.renderImage.bind(this)),this.listenTo(this.image,"change:height",this.renderImage.bind(this)),this.listenTo(this.image,"change:angle",this.renderImage.bind(this)),this.listenTo(this.image,"change:preserveAspectRatio",this.renderImage.bind(this)),this.render()},n.prototype.render=function(){this.$el.html(this.template.render(this.image.toJSON())),this.$width=this.$('input[name="width"]')[0],this.$height=this.$('input[name="height"]')[0],this.$preserveAspectRatio=this.$('input[name="preserve-aspect-ratio"]')[0],this.$visible=this.$('input[name="image-visible"]')[0],this.$angle=this.$('input[name="angle"]')[0],this.renderData()},n.prototype.renderData=function(){if(this.image.get("data")===null)return;this.element&&this.element.remove(),this.element=this.app.Paper.image(this.image.get("data")),this.renderImage()},n.prototype.renderImage=function(){this.element===undefined&&(this.element=this.app.Paper.image(this.image.get("data"))),this.element.toBack(),this.app.BgRect&&this.app.BgRect.toBack(),this.app.imageElement=this.element,this.element.attr({x:this.image.get("x"),y:this.image.get("y"),width:this.image.get("width"),height:this.image.get("height"),opacity:this.image.get("visible")?1:0}),(this.image.get("origHeight")==null||this.image.get("origWidth")==null)&&this.image.set({origWidth:this.image.get("width"),origHeight:this.image.get("height")}),this.rotate(this.image.get("angle")),this.updateHtmlElements(),this.resizePaper()},n.prototype.updateHtmlElements=function(){if(this.image.get("data")===null)return;this.$width.value=this.image.get("width"),this.$height.value=this.image.get("height"),this.$angle.value=this.image.get("angle")},n.prototype.rotate=function(e){if(this.image.get("data")===null)return;var t="t0,0r"+e;this.element.transform(t)},n.prototype.resizePaper=function(){if(this.image.get("data")===null)return;var e=this.element.getBBox(),t="t"+ -e.x+","+ -e.y+"r"+this.image.get("angle");this.element.transform(t);var n=e.height+50;this.app.refCol&&this.app.refCol.Paper&&(n=Math.max(this.app.refCol.Paper.height,n),this.app.refCol.Paper.setSize(this.app.refCol.Paper.width,n)),this.app.type!=="transect"?this.app.Paper.setSize(e.width+50,n):(this.app.width=e.width+50,this.app.height=n)},n.prototype.updateImageWidth=function(){if(this.image.get("data")===null)return;if(this.image.get("preserveAspectRatio")){var e=parseInt(this.$width.value)*this.image.get("origHeight")/this.image.get("origWidth");this.$height.value=e}this.updateImage()},n.prototype.updateImageHeight=function(){if(this.image.get("data")===null)return;if(this.image.get("preserveAspectRatio")){var e=parseInt(this.$height.value)*this.image.get("origWidth")/this.image.get("origHeight");this.$width.value=e}this.updateImage()},n.prototype.updateImage=function(){if(this.image.get("data")===null)return;this.image.set({width:parseInt(this.$width.value),height:parseInt(this.$height.value),angle:parseFloat(this.$angle.value),preserveAspectRatio:this.$preserveAspectRatio.checked,visible:this.$visible.checked})},n.prototype.imageDragover=function(e){var e=e.originalEvent;e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},n.prototype.imageDrop=function(e){var e=e.originalEvent;e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files[0];if(t.type==="image/png"||t.type==="image/jpg"||t.type==="image/jpeg"||t.type==="image/gif"){var n=new FileReader;n.onload=this.readImage.bind(this),n.readAsDataURL(t)}},n.prototype.readImage=function(e){var t=this,n=new Image;$(n).load(function(){t.app.ImageOb.set({data:e.target.result,width:n.width,height:n.height})}),n.src=e.target.result},n}),define("markerView",["baseView"],function(e){var t=e.extend({tagName:"li",classname:"MarkerView",events:{"click .toggle":"toggleMarkerForm","click .marker-data":"toggleMarkerForm","click .destroy":"destroy","keypress :input":"updateMarker","keyup :input":"updateMarker",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return t.prototype.template=new EJS({url:"/commons/ejs/marker.ejs"}),t.prototype.initialize=function(e,t,n){this.app=e,this.markersView=n,this.marker=t,this.render(),this.listenTo(this.marker,"change:edit",this.editMarker.bind(this)),this.listenTo(this.marker,"change:hover",this.setHoverStatus.bind(this)),this.listenTo(this.marker,"update",this.renderMarker.bind(this)),this.listenTo(this.marker,"change:y",this.renderMarker.bind(this)),this.listenTo(this.marker,"destroy",this.delete.bind(this))},t.prototype.render=function(){this.$el.html(this.template.render(this.marker.toJSON())),this.$toggle=this.$(".toggle"),this.$markerForm=this.$(".marker-form"),this.$markerData=this.$(".marker-data"),this.$markerName=this.$('input[name="marker-name"]')[0],this.$markerAge=this.$('input[name="marker-age"]')[0],this.editMarker(),this.renderMarker()},t.prototype.renderMarker=function(){this.element===undefined&&(this.element=this.app.Paper.path(),this.element.attr({"stroke-width":2,stroke:"#900000"}),this.element.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this)),this.element.drag(this.dragMove.bind(this),this.dragStart.bind(this),this.dragEnd.bind(this)),this.element.toFront(),this.app.MarkersSet.push(this.element)),this.element.attr({path:this.getPath()}),this.app.span||this.resizePaper(),this.renderTooltip()},t.prototype.renderTooltip=function(){var e=this.marker.get("age")===null?"-":this.marker.get("age");$(this.element.node).qtip({content:{text:this.marker.get("name")+"【"+e+" myr】"},position:{my:"bottom left",target:"mouse",adjust:{x:10,y:-10}}})},t.prototype.getPath=function(){var e=0,t=this.app.width||this.app.Paper.width,n=this.marker.get("y");if(this.app.span){var r=ViewboxToPaper(this.app,e,n);e=r.x,n=r.y,t=ViewboxToPaper(this.app,t,0).x}return"M"+e+","+this.marker.get("y")+"H"+t},t.prototype.dragStart=function(e,t,n){this.element.toFront();var r=this.app.MarkersCollection,i=r.indexOf(this.marker);this.prevMarker=r.at(i-1),this.nextMarker=r.at(i+1)},t.prototype.dragMove=function(e,t,n,r,i){var s=i.offsetX,o=i.offsetY;if(this.app.span){var u=ViewboxToPaper(this.app,i.offsetX,i.offsetY);s=u.x,o=u.y}if(this.prevMarker&&this.nextMarker&&(this.prevMarker.get("y")+2>o||o>this.nextMarker.get("y")-2))return;if(!this.prevMarker&&this.nextMarker&&o>this.nextMarker.get("y")-2)return;if(this.prevMarker&&!this.nextMarker&&this.prevMarker.get("y")+2>o)return;this.marker.set({y:o})},t.prototype.dragEnd=function(e){this.marker.dragEnd()},t.prototype.onMouseOver=function(){this.markersView.undelegateEvents(),this.$el.addClass("hover"),this.hover()},t.prototype.onMouseOut=function(){this.markersView.delegateEvents(),this.$el.removeClass("hover"),this.unhover()},t.prototype.hover=function(){this.element.attr({"stroke-width":5})},t.prototype.unhover=function(){this.element.attr({"stroke-width":2})},t.prototype.setHoverStatus=function(){this.marker.get("hover")?this.$el.addClass("hover"):(this.element.attr({"stroke-width":2}),this.$el.removeClass("hover"))},t.prototype.toggleMarkerForm=function(){this.render(),this.marker.set({edit:!this.marker.get("edit")})},t.prototype.editMarker=function(){this.marker.get("edit")?(this.$markerForm.removeClass("hide"),this.$markerData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$markerForm.addClass("hide"),this.$markerData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},t.prototype.updateMarker=function(e){e.keyCode==13&&this.toggleMarkerForm();var t=this.$markerName.value,n=parseFloat(this.$markerAge.value)||0;this.marker.set({name:t,age:n}),this.marker.update()},t.prototype.delete=function(){this.element!==undefined&&this.element.remove(),this.$el.remove(),this.remove()},t.prototype.destroy=function(){var e=this.app.ZonesCollection.findWhere({topMarker:this.marker}),t=this.app.ZonesCollection.findWhere({baseMarker:this.marker});this.marker.destroy(),e&&e.destroy(),t&&t.destroy()},t.prototype.resizePaper=function(){var e=Math.max(this.app.Paper.height,this.marker.get("y")+100);this.app.Paper.setSize(this.app.Paper.width,e),this.app.ruler&&this.app.ruler.resize()},t}),define("marker",["baseModel"],function(e){var t=e.extend({classname:"Marker",constructor:function(t,n){var r=[{edit:!1,name:t.name||_.uniqueId("Time Line "),y:t.y,age:t.age!==undefined?t.age:null,hover:!1}];e.apply(this,r)}});return t.prototype.dragEnd=function(){this.trigger("dragEnd")},t}),define("zone",["baseModel"],function(e){var t=e.extend({classname:"Zone",constructor:function(t,n,r,i){this.app=i;var s=[{edit:!1,name:t.name||_.uniqueId("Zone "),description:t.description||null,topMarker:n,baseMarker:r,toggle:!1}];e.apply(this,s)}});return t.prototype.isYInsideZone=function(e){return this.get("topMarker").get("y")<=e&&e<this.get("baseMarker").get("y")?!0:!1},t.prototype.getRelativeY=function(e){if(this.get("topMarker").get("y")<=e&&e<this.get("baseMarker").get("y")){var t=(e-this.get("topMarker").get("y"))/(this.get("baseMarker").get("y")-this.get("topMarker").get("y"));return Math.round(t*1e3)/1e3}return null},t.prototype.getAbsoluteY=function(e){var t=this.get("topMarker").get("y")+(this.get("baseMarker").get("y")-this.get("topMarker").get("y"))*e;return t},t.prototype.getAbsoluteAge=function(e){if(this.get("topMarker").get("y")<=e&&e<this.get("baseMarker").get("y")&&this.get("topMarker").get("age")!=null&&this.get("baseMarker").get("age")!=null){var t=(e-this.get("topMarker").get("y"))/(this.get("baseMarker").get("y")-this.get("topMarker").get("y")),n=t*(this.get("baseMarker").get("age")-this.get("topMarker").get("age"))+this.get("topMarker").get("age");return Math.round(n*100)/100}return null},t.prototype.getPolyKPointsArray=function(){return[0,this.get("topMarker").get("y"),0,this.get("baseMarker").get("y"),this.app.width,this.get("baseMarker").get("y"),this.app.width,this.get("topMarker").get("y")]},t}),define("markersView",["baseView","markerView","marker","zone"],function(e,t,n,r){var i=e.extend({el:"#markers-list",classname:"MarkersView"});return i.prototype.template=new EJS({url:"/commons/ejs/data_tbl.ejs"}),i.prototype.initialize=function(e){this.app=e,this.zones=this.app.ZonesCollection,this.markers=this.app.MarkersCollection,this.enMarkers=!1,this.listenTo(this.markers,"add",this.render.bind(this)),this.listenTo(this.markers,"remove",this.render.bind(this)),this.listenToActionEvents(),this.render()},i.prototype.listenToActionEvents=function(){$("#canvas").bind("dblclick",this.createMarker.bind(this))},i.prototype.render=function(){this.$el.html(this.template.render({name:"Markers"})),this.$markersTable=this.$(".data-list"),this.renderMarkers()},i.prototype.renderMarkers=function(){this.markers.each(this.addMarker.bind(this))},i.prototype.addMarker=function(e){var n=new t(this.app,e,this);this.$markersTable.append(n.el),this.updateZones()},i.prototype.toggleMarkers=function(e){$("a[href='#add-marker']").parent().hasClass("active")?($("a[href='#add-marker']").parent().removeClass("active"),this.enMarkers=!1):($("a[href='#add-marker']").parent().addClass("active"),this.enMarkers=!0)},i.prototype.createMarker=function(e){if(this.enMarkers){var t=e.offsetX,r=e.offsetY;this.app.span&&(r=ViewboxToPaper(this.app,t,r).y),this.markers.add(new n({y:r}))}},i.prototype.updateZones=function(){var e=this,t=[];this.markers.sort(),this.markers.each(function(n,i,s){if(i>0){var o=e.zones.findWhere({topMarker:s[i-1],baseMarker:n})||new r({name:"New Zone "+i},s[i-1],n,e.app);e.zones.add(o),i<e.markers.length-1&&(o=e.zones.findWhere({topMarker:s[i-1],baseMarker:s[i+1]}),o&&t.push(o))}}),_.invoke(t,"destroy")},i}),define("transectWellView",["baseView"],function(e){var t=e.extend({tagName:"li",classname:"TransectWellView",events:{"click .toggle":"toggleWellForm","click .well-data":"toggleWellForm","click .destroy":"destroy","keypress :input":"updateWell","keyup :input":"updateWell",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return t.prototype.template=new EJS({url:"../../../transect_maker/ejs/transect_well.ejs"}),t.prototype.initialize=function(e,t,n){this.app=e,this.transectWell=t,this.transectWellsView=n,this.render(),this.listenTo(this.transectWell,"change:edit",this.editTransectWell.bind(this)),this.listenTo(this.transectWell,"change:hover",this.setHoverStatus.bind(this)),this.listenTo(this.transectWell,"change:x",this.renderWell.bind(this)),this.listenTo(this.transectWell,"update",this.renderWell.bind(this)),this.listenTo(this.transectWell,"destroy",this.delete.bind(this))},t.prototype.render=function(){this.$el.html(this.template.render(this.transectWell.toJSON())),this.$toggle=this.$(".toggle"),this.$wellForm=this.$(".well-form"),this.$wellData=this.$(".well-data"),this.$wellName=this.$('input[name="well-name"]')[0],this.$wellLat=this.$('input[name="well-lat"]')[0],this.$wellLon=this.$('input[name="well-lon"]')[0],this.$wellDescription=this.$('textarea[name="well-description"]')[0],this.editTransectWell(),this.renderWell()},t.prototype.renderWell=function(){this.element===undefined&&(this.element=this.app.Paper.path(),this.element.attr({"stroke-width":2,stroke:"#900000"}),this.app.WellsSet.push(this.element),this.element.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this)),this.element.drag(this.dragMove.bind(this),this.dragStart.bind(this),this.dragEnd.bind(this))),this.element.attr({path:this.getPath()}),this.app.type!=="transect"&&this.resizePaper(),this.renderTooltip()},t.prototype.resizePaper=function(){var e=Math.max(this.app.Paper.width,this.transectWell.get("x")+100),t=this.app.Paper.height;this.app.Paper.setSize(e,t)},t.prototype.renderTooltip=function(){$(this.element.node).qtip({content:{text:this.transectWell.get("name")},position:{my:"left bottom",at:"left middle",target:"mouse",adjust:{x:10,y:-10}}})},t.prototype.getPath=function(){return"M"+this.transectWell.get("x")+",0"+"V"+this.app.height},t.prototype.dragStart=function(e,t,n){this.element.toFront();var r=this.app.TransectWellsCollection,i=r.indexOf(this.transectWell);this.prevWell=r.at(i-1),this.nextWell=r.at(i+1)},t.prototype.dragMove=function(e,t,n,r,i){var s=i.offsetX,o=i.offsetY,u=ViewboxToPaper(this.app,s,o);s=u.x,o=u.y;if(this.prevWell&&this.nextWell&&(this.prevWell.get("x")+2>s||s>this.nextWell.get("x")-2))return;if(!this.prevWell&&this.nextWell&&s>this.nextWell.get("x")-2)return;if(this.prevWell&&!this.nextWell&&this.prevWell.get("x")+2>s)return;this.transectWell.set({x:s})},t.prototype.dragEnd=function(e){this.transectWell.dragEnd()},t.prototype.onMouseOver=function(){this.transectWellsView.undelegateEvents(),this.transectWell.set({hover:!0})},t.prototype.onMouseOut=function(){this.transectWellsView.delegateEvents(),this.transectWell.set({hover:!1})},t.prototype.setHoverStatus=function(){this.transectWell.get("hover")?(this.element.attr({"stroke-width":5}),this.$el.addClass("hover")):(this.element.attr({"stroke-width":2}),this.$el.removeClass("hover"))},t.prototype.toggleWellForm=function(){this.render(),this.transectWell.set({edit:!this.transectWell.get("edit")})},t.prototype.editTransectWell=function(){this.transectWell.get("edit")?(this.$wellForm.removeClass("hide"),this.$wellData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$wellForm.addClass("hide"),this.$wellData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},t.prototype.updateWell=function(e){(e.keyCode==TimescaleApp.ENTER||e.keyCode==TimescaleApp.ESC)&&this.toggleWellForm();var t=this.$wellName.value,n=parseFloat(this.$wellLat.value),r=parseFloat(this.$wellLon.value),i=this.$wellDescription.value.split("\n").join(" ");this.transectWell.set({name:t,lat:n,lon:r,description:i}),this.well.update()},t.prototype.delete=function(){this.element!==undefined&&this.element.remove(),this.$el.remove(),this.remove()},t.prototype.destroy=function(){var e=this.app.TransectsCollection.findWhere({wellLeft:this.transectWell}),t=this.app.TransectsCollection.findWhere({wellRight:this.transectWell});this.transectWell.destroy(),e&&e.destroy(),t&&t.destroy()},t}),define("transectWell",["baseModel","settings"],function(e,t){var n=e.extend({classname:"TransectWell",constructor:function(n,r){var i=[{edit:!1,name:n.name||_.uniqueId("Well "),id:n.id||_.uniqueId("well-"),x:n.x,lat:n.lat||null,lon:n.lon||null,settings:new t,width:100,hover:!1,description:n.description||null}];e.apply(this,i)}});return n.prototype.dragEnd=function(){this.trigger("dragEnd")},n}),define("transectWellsView",["baseView","transectWellView","transectWell","transect"],function(e,t,n,r){var i=e.extend({el:"#wells-list",classname:"TransectWellsView"});return i.prototype.template=new EJS({url:"../../../commons/ejs/data_tbl.ejs"}),i.prototype.initialize=function(e){this.app=e,this.transects=this.app.TransectsCollection,this.transectWells=this.app.TransectWellsCollection,this.enWells=!1,this.render(),this.listenToActionEvents(),this.listenTo(this.transectWells,"add",this.addWell.bind(this))},i.prototype.render=function(){this.$el.html(this.template.render({name:"Reference Wells"})),this.$wellsTable=this.$(".data-list"),this.renderWells()},i.prototype.listenToActionEvents=function(){$("#canvas").bind("dblclick",this.createWell.bind(this))},i.prototype.renderWells=function(){this.transectWells.each(this.addWell.bind(this))},i.prototype.addWell=function(e){var n=new t(this.app,e,this);this.$wellsTable.append(n.el),this.updateTransects()},i.prototype.toggleWells=function(e){$("a[href='#add-well']").parent().hasClass("active")?($("a[href='#add-well']").parent().removeClass("active"),this.enWells=!1):($("a[href='#add-well']").parent().addClass("active"),this.enWells=!0)},i.prototype.createWell=function(e){if(this.enWells){var t=e.offsetX,r=e.offsetY;this.app.type==="transect"&&(t=ViewboxToPaper(this.app,t,r).x),this.transectWells.add(new n({x:t}))}},i.prototype.wellAdded=function(){this.render()},i.prototype.updateTransects=function(){var e=this,t=[];this.transectWells.sort(),this.transectWells.each(function(t,n,i){if(n>0){var s=e.transects.findWhere({wellLeft:i[n-1],wellRight:t})||new r({name:"Transect "+n},i[n-1],t,e.app);e.transects.add(s)}})},i}),define("point",["baseModel"],function(e){var t=e.extend({classname:"Point",constructor:function(t,n){var r=[{edit:!1,name:t.name||_.uniqueId("X"),x:t.x?parseInt(t.x):0,y:t.y?parseInt(t.y):0,age:0,relativeX:null,relativeY:null,transect:null,zone:null,app:n}];e.apply(this,r)}});return t.prototype.initialize=function(e,t){this.updateTransectAndZone()},t.prototype.updateTransectAndZone=function(){var e=this.get("app").ZonesCollection.getZoneForY(this.get("y")),t=this.get("app").TransectsCollection.getTransectForX(this.get("x"));e===null&&(e=this.get("app").ZonesCollection.getZoneForY(this.get("y")-1),e===null?(e=this.get("app").ZonesCollection.getZoneForY(this.get("y")+1),e!==null&&this.set({y:this.get("y")+1})):this.set({y:this.get("y")-1})),t===null&&(t=this.get("app").TransectsCollection.getTransectForX(this.get("x")+1),t===null?(t=this.get("app").TransectsCollection.getTransectForX(this.get("x")-1),t!==null&&this.set({x:this.get("x")-1})):this.set({x:this.get("x")+1})),e!==null&&t!==null&&(this.set({transect:t,zone:e}),this.updateRelativeCoordinates())},t.prototype.updateRelativeCoordinates=function(){this.set({relativeX:this.get("transect").getRelativeX(this.get("x")),relativeY:this.get("zone").getRelativeY(this.get("y")),age:this.get("zone").getAbsoluteAge(this.get("y"))})},t.prototype.toJSON=function(){var e=_.clone(this.attributes);return delete e.transect,delete e.zone,delete e.app,e},t.prototype.toStatusJSON=function(){var e=_.clone(this.attributes);return e},t}),define("polyK",[],function(){var e={};e.IsSimple=function(t){var n=t.length>>1;if(n<4)return!0;var r=new e._P,i=new e._P,s=new e._P,o=new e._P,u=new e._P;for(var a=0;a<n;a++){r.x=t[2*a],r.y=t[2*a+1],a==n-1?(i.x=t[0],i.y=t[1]):(i.x=t[2*a+2],i.y=t[2*a+3]);for(var f=0;f<n;f++){if(Math.abs(a-f)<2)continue;if(f==n-1&&a==0)continue;if(a==n-1&&f==0)continue;s.x=t[2*f],s.y=t[2*f+1],f==n-1?(o.x=t[0],o.y=t[1]):(o.x=t[2*f+2],o.y=t[2*f+3]);if(e._GetLineIntersection(r,i,s,o,u)!=null)return!1}}return!0},e.IsConvex=function(t){if(t.length<6)return!0;var n=t.length-4;for(var r=0;r<n;r+=2)if(!e._convex(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]))return!1;return e._convex(t[n],t[n+1],t[n+2],t[n+3],t[0],t[1])?e._convex(t[n+2],t[n+3],t[0],t[1],t[2],t[3])?!0:!1:!1},e.GetArea=function(e){if(e.length<6)return 0;var t=e.length-2,n=0;for(var r=0;r<t;r+=2)n+=(e[r+2]-e[r])*(e[r+1]+e[r+3]);return n+=(e[0]-e[t])*(e[t+1]+e[1]),-n*.5},e.GetAABB=function(e){var t=Infinity,n=Infinity,r=-t,i=-n;for(var s=0;s<e.length;s+=2)t=Math.min(t,e[s]),r=Math.max(r,e[s]),n=Math.min(n,e[s+1]),i=Math.max(i,e[s+1]);return{x:t,y:n,width:r-t,height:i-n}},e.Reverse=function(e){var t=[];for(var n=e.length-2;n>=0;n-=2)t.push(e[n],e[n+1]);return t},e.Triangulate=function(t){var n=t.length>>1;if(n<3)return[];var r=[],i=[];for(var s=0;s<n;s++)i.push(s);var s=0,o=n;while(o>3){var u=i[(s+0)%o],a=i[(s+1)%o],f=i[(s+2)%o],l=t[2*u],c=t[2*u+1],h=t[2*a],p=t[2*a+1],d=t[2*f],v=t[2*f+1],m=!1;if(e._convex(l,c,h,p,d,v)){m=!0;for(var g=0;g<o;g++){var y=i[g];if(y==u||y==a||y==f)continue;if(e._PointInTriangle(t[2*y],t[2*y+1],l,c,h,p,d,v)){m=!1;break}}}if(m)r.push(u,a,f),i.splice((s+1)%o,1),o--,s=0;else if(s++>3*o)break}return r.push(i[0],i[1],i[2]),r},e.ContainsPoint=function(e,t,n){var r=e.length>>1,i,s,o=e[2*r-2]-t,u=e[2*r-1]-n,a=0;for(var f=0;f<r;f++){i=o,s=u,o=e[2*f]-t,u=e[2*f+1]-n;if(s<0&&u<0)continue;if(s>0&&u>0)continue;if(i<0&&o<0)continue;var l=i+(o-i)*-s/(u-s);if(l==0)return!0;l>0&&a++}return(a&1)==1},e.Slice=function(t,n,r,i,s){if(e.ContainsPoint(t,n,r)||e.ContainsPoint(t,i,s))return[t.slice(0)];var o=new e._P(n,r),u=new e._P(i,s),a=[],f=[];for(var l=0;l<t.length;l+=2)f.push(new e._P(t[l],t[l+1]));for(var l=0;l<f.length;l++){var c=new e._P(0,0);c=e._GetLineIntersection(o,u,f[l],f[(l+1)%f.length],c),c&&(c.flag=!0,a.push(c),f.splice(l+1,0,c),l++)}if(a.length==0)return[t.slice(0)];var h=function(t,n){return e._P.dist(o,t)-e._P.dist(o,n)};a.sort(h);var p=[],d=0;while(a.length>0){var v=f.length,m=a[0],g=a[1],y=f.indexOf(m),b=f.indexOf(g),w=!1;e._firstWithFlag(f,y)==b?w=!0:(m=a[1],g=a[0],y=f.indexOf(m),b=f.indexOf(g),e._firstWithFlag(f,y)==b&&(w=!0));if(w){d--;var E=e._getPoints(f,y,b);p.push(E),f=e._getPoints(f,b,y),m.flag=g.flag=!1,a.splice(0,2),a.length==0&&p.push(f)}else d++,a.reverse();if(d>1)break}var S=[];for(var l=0;l<p.length;l++){var x=p[l],T=[];for(var N=0;N<x.length;N++)T.push(x[N].x,x[N].y);S.push(T)}return S},e.Raycast=function(t,n,r,i,s,o){var u=t.length-2,a=e._tp,f=a[0],l=a[1],c=a[2],h=a[3],p=a[4];f.x=n,f.y=r,l.x=n+i,l.y=r+s,o==null&&(o={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),o.dist=Infinity;for(var d=0;d<u;d+=2){c.x=t[d],c.y=t[d+1],h.x=t[d+2],h.y=t[d+3];var v=e._RayLineIntersection(f,l,c,h,p);v&&e._updateISC(i,s,f,c,h,p,d/2,o)}c.x=h.x,c.y=h.y,h.x=t[0],h.y=t[1];var v=e._RayLineIntersection(f,l,c,h,p);return v&&e._updateISC(i,s,f,c,h,p,t.length/2,o),o.dist!=Infinity?o:null},e.ClosestEdge=function(t,n,r,i){var s=t.length-2,o=e._tp,u=o[0],a=o[2],f=o[3],l=o[4];u.x=n,u.y=r,i==null&&(i={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),i.dist=Infinity;for(var c=0;c<s;c+=2)a.x=t[c],a.y=t[c+1],f.x=t[c+2],f.y=t[c+3],e._pointLineDist(u,a,f,c>>1,i);a.x=f.x,a.y=f.y,f.x=t[0],f.y=t[1],e._pointLineDist(u,a,f,s>>1,i);var h=1/i.dist;return i.norm.x=(n-i.point.x)*h,i.norm.y=(r-i.point.y)*h,i},e._pointLineDist=function(e,t,n,r,i){var s=e.x,o=e.y,u=t.x,a=t.y,f=n.x,l=n.y,c=s-u,h=o-a,p=f-u,d=l-a,v=c*p+h*d,m=p*p+d*d,g=v/m,y,b;g<0||u==f&&a==l?(y=u,b=a):g>1?(y=f,b=l):(y=u+g*p,b=a+g*d);var w=s-y,E=o-b,S=Math.sqrt(w*w+E*E);S<i.dist&&(i.dist=S,i.edge=r,i.point.x=y,i.point.y=b)},e._updateISC=function(t,n,r,i,s,o,u,a){var f=e._P.dist(r,o);if(f<a.dist){var l=1/e._P.dist(i,s),c=-(s.y-i.y)*l,h=(s.x-i.x)*l,p=2*(t*c+n*h);a.dist=f,a.norm.x=c,a.norm.y=h,a.refl.x=-p*c+t,a.refl.y=-p*h+n,a.edge=u}},e._getPoints=function(e,t,n){var r=e.length,i=[];n<t&&(n+=r);for(var s=t;s<=n;s++)i.push(e[s%r]);return i},e._firstWithFlag=function(e,t){var n=e.length;for(;;){t=(t+1)%n;if(e[t].flag)return t}},e._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&w+E<1},e._RayLineIntersection=function(t,n,r,i,s){var o=t.x-n.x,u=r.x-i.x,a=t.y-n.y,f=r.y-i.y,l=o*f-a*u;if(l==0)return null;var c=t.x*n.y-t.y*n.x,h=r.x*i.y-r.y*i.x,p=s,d=1/l;return p.x=(c*u-o*h)*d,p.y=(c*f-a*h)*d,e._InRect(p,r,i)?a>0&&p.y>t.y||a<0&&p.y<t.y?null:o>0&&p.x>t.x||o<0&&p.x<t.x?null:p:null},e._GetLineIntersection=function(t,n,r,i,s){var o=t.x-n.x,u=r.x-i.x,a=t.y-n.y,f=r.y-i.y,l=o*f-a*u;if(l==0)return null;var c=t.x*n.y-t.y*n.x,h=r.x*i.y-r.y*i.x,p=s;return p.x=(c*u-o*h)/l,p.y=(c*f-a*h)/l,e._InRect(p,t,n)&&e._InRect(p,r,i)?p:null},e._InRect=function(e,t,n){return t.x==n.x?e.y>=Math.min(t.y,n.y)&&e.y<=Math.max(t.y,n.y):t.y==n.y?e.x>=Math.min(t.x,n.x)&&e.x<=Math.max(t.x,n.x):e.x>=Math.min(t.x,n.x)&&e.x<=Math.max(t.x,n.x)&&e.y>=Math.min(t.y,n.y)&&e.y<=Math.max(t.y,n.y)?!0:!1},e._convex=function(e,t,n,r,i,s){return(t-r)*(i-n)+(n-e)*(s-r)>=0},e._P=function(e,t){this.x=e,this.y=t,this.flag=!1},e._P.prototype.toString=function(){return"Point ["+this.x+", "+this.y+"]"},e._P.dist=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},e._tp=[];for(var t=0;t<10;t++)e._tp.push(new e._P(0,0));return e}),define("transectTextView",["baseView","point","polyK"],function(e,t,n){var r=e.extend({tagName:"li",classname:"TransectTextView",events:{"click .toggle":"toggleTextForm","click .text-data":"toggleTextForm","click .destroy":"destroy","keypress :input":"updateText","keyup :input":"updateText",'change select[name="text-font-family"]':"updateText",'change input[name="text-font-size"]':"updateText",'change input[name="text-font-color"]':"updateText",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return r.prototype.template=new EJS({url:"/transect_maker/ejs/transect_text.ejs"}),r.prototype.initialize=function(e,t,n){this.app=e,this.transectTextsView=n,this.transectText=t,this.render(),this.listenTo(this.transectText,"update",this.render.bind(this)),this.listenTo(this.transectText,"change:x",this.renderTransectText.bind(this)),this.listenTo(this.transectText,"change:y",this.renderTransectText.bind(this)),this.listenTo(this.transectText,"change:edit",this.editTransectText.bind(this)),this.listenTo(this.transectText,"change:text",this.renderTransectText.bind(this)),this.listenTo(this.transectText,"change:age",this.updateTscBBox.bind(this)),this.listenTo(this.transectText,"destroy",this.delete.bind(this)),this.listenTo(this.transectText.get("settings"),"change",this.renderTransectText.bind(this)),this.listenTo(this.transectText.get("zone"),"destroy",this.updateTextTransectAndZone.bind(this)),this.listenTo(this.transectText.get("transect"),"destroy",this.updateTextTransectAndZone.bind(this))},r.prototype.updateTextTransectAndZone=function(e){this.transectText.updateTransectAndZone(),this.transectText.update()},r.prototype.render=function(){return this.$el.html(this.template.render(this.transectText.toJSON())),this.$toggle=this.$(".toggle"),this.$textForm=this.$(".text-form"),this.$textData=this.$(".text-data"),this.$textText=this.$("textarea[name*=text-name]")[0],this.$textFontSize=this.$("input[name*=text-font-size]")[0],this.$textFontColor=this.$("input[name*=text-font-color]")[0],this.editTransectText(),this.renderTransectText(),this},r.prototype.renderTransectText=function(){this.set=this.app.Paper.set();if(this.element===undefined||this.boundingBox===undefined)this.backgroundBox=this.app.Paper.rect(),this.element=this.app.Paper.text(),this.boundingBox=this.app.Paper.rect(),this.set.push(this.backgroundBox),this.set.push(this.element),this.set.push(this.boundingBox),this.app.TextsSet.push(this.set),this.boundingBox.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this)),this.boundingBox.drag(this.dragMove.bind(this),this.dragStart.bind(this),this.dragEnd.bind(this));this.element.attr({text:this.transectText.get("text"),x:this.transectText.get("x"),y:this.transectText.get("y"),"font-size":this.transectText.get("settings").get("fontSize"),"font-family":this.transectText.get("settings").get("fontFamily"),fill:this.transectText.get("settings").get("fill"),"fill-opacity":1}),this.backgroundBox.attr({fill:this.isWithinBounds()?"#fff":"#ff0000","fill-opacity":1,r:"2px"}),this.backgroundBox.attr({width:this.element.getBBox().width,height:this.element.getBBox().height,x:this.element.getBBox().x,y:this.element.getBBox().y}),this.boundingBox.attr({fill:"#f1f1f1",r:"2px","fill-opacity":0,opacity:0,width:this.element.getBBox().width,height:this.element.getBBox().height,x:this.element.getBBox().x,y:this.element.getBBox().y}),this.updateTscBBox(),this.renderTooltip()},r.prototype.toFront=function(){this.backgroundBox.toFront(),this.element.toFront(),this.boundingBox.toFront()},r.prototype.updateTscBBox=function(){var e=this.transectText.get("transect"),t=this.transectText.get("zone"),n=this.element.getBBox(),r=n.x,i=n.y+n.height,s=n.x2,o=n.y2-n.height,r=Math.round(e.getRelativeX(r)*1e3)/10,s=Math.round(e.getRelativeX(s)*1e3)/10,i=Math.round(t.getAbsoluteAge(i)*100)/100,o=Math.round(t.getAbsoluteAge(o)*100)/100;this.transectText.set({bBox:{x1:r,x2:s,y1:i,y2:o}})},r.prototype.renderTooltip=function(){var e=this.transectText.get("text")+"<br/>";e+=this.transectText.get("zone").get("name")+"<br/>",e+=this.transectText.get("transect").get("name")+"<br/>",e+="Font Family: "+this.transectText.get("settings").get("fontFamily")+"<br/>",e+="Font Size: "+this.transectText.get("settings").get("fontSize")+"<br/>",$(this.boundingBox.node).qtip({content:{text:e},position:{my:"top left",target:"mouse",adjust:{x:10,y:10}}})},r.prototype.dragStart=function(e,t,n){this.toFront()},r.prototype.dragMove=function(e,t,n,r,i){var s=ViewboxToPaper(this.app,i.offsetX,i.offsetY),o=s.x,u=s.y,a=this.app.TransectsCollection.getTransectForX(o),f=this.app.ZonesCollection.getZoneForY(u);a!==null&&f!==null&&(this.transectText.set({x:o,y:u}),this.transectText.updateTransectAndZone())},r.prototype.dragEnd=function(e){},r.prototype.onMouseOver=function(){this.transectTextsView.undelegateEvents(),this.backgroundBox.attr({fill:"#fdcc59"}),this.$el.addClass("hover")},r.prototype.onMouseOut=function(){this.transectTextsView.delegateEvents(),this.backgroundBox.attr({fill:this.isWithinBounds()?"#fff":"#ff0000"}),this.$el.removeClass("hover")},r.prototype.toggleTextForm=function(){this.render(),this.transectText.set({edit:!this.transectText.get("edit")})},r.prototype.editTransectText=function(){this.transectText.get("edit")?(this.$textForm.removeClass("hide"),this.$textData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$textForm.addClass("hide"),this.$textData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},r.prototype.updateText=function(e){e.keyCode==TimescaleApp.ESC&&this.toggleTextForm();var t=this.$textText.value;this.transectText.set({text:t});var n=this.$("select[name='text-font-family'] option:selected").val();this.transectText.get("settings").set({fontSize:this.$textFontSize.value,fill:this.$textFontColor.value,fontFamily:n})},r.prototype.isWithinBounds=function(){var e=this.transectText.get("transect").getPolyKPointsArray(),t=this.transectText.get("zone").getPolyKPointsArray(),r=this.element.getBBox();return n.ContainsPoint(e,r.x,r.y)&&n.ContainsPoint(e,r.x2,r.y2)&&n.ContainsPoint(t,r.x,r.y)&&n.ContainsPoint(t,r.x2,r.y2)?!0:!1},r.prototype.delete=function(){this.backgroundBox!==undefined&&this.backgroundBox.remove(),this.element!==undefined&&this.element.remove(),this.boundingBox!==undefined&&this.boundingBox.remove(),this.set!==undefined&&this.set.remove(),this.$el.remove(),this.remove()},r.prototype.destroy=function(){this.transectText.destroy()},r}),define("transectText",["baseModel","settings"],function(e,t){var n=e.extend({classname:"TransectText",constructor:function(n,r){var i=[{edit:!1,text:n.text||_.uniqueId("Text "),x:n.x?parseInt(n.x):0,y:n.y?parseInt(n.y):0,age:0,transect:null,zone:null,settings:new t,bBox:null,app:r}];e.apply(this,i)}});return n.prototype.initialize=function(){this.get("settings").set({fill:"#000"}),this.updateTransectAndZone()},n.prototype.updateTransectAndZone=function(){var e=this.get("app").ZonesCollection.getZoneForY(this.get("y")),t=this.get("app").TransectsCollection.getTransectForX(this.get("x"));e!==null&&t!==null&&(this.set({transect:t,zone:e}),this.updateRelativeCoordinates())},n.prototype.updateRelativeCoordinates=function(e){this.set({relativeX:this.get("transect").getRelativeX(this.get("x")),relativeY:this.get("zone").getRelativeY(this.get("y")),age:this.get("zone").getAbsoluteAge(this.get("y"))})},n.prototype.toJSON=function(){var e=_.clone(this.attributes);return delete e.transect,delete e.zone,delete e.app,e},n}),define("transectTextsView",["baseView","transectTextView","transectText"],function(e,t,n){var r=e.extend({el:"#texts-list",classname:"TransectTextsView"});return r.prototype.template=new EJS({url:"../../../commons/ejs/data_tbl.ejs"}),r.prototype.initialize=function(e){this.app=e,this.transectTexts=this.app.TransectTextsCollection,this.enTransectTexts=!1,this.render(),this.listenToActionEvents(),this.listenTo(this.transectTexts,"add",this.addTransectText.bind(this))},r.prototype.render=function(){this.$el.html(this.template.render({name:"Transect Texts"})),this.$textsList=this.$(".data-list"),this.renderTransectTexts()},r.prototype.renderTransectTexts=function(){this.set==undefined&&(this.set=this.app.Paper.set()),this.transectTexts.each(this.addTransectText.bind(this))},r.prototype.listenToActionEvents=function(){$("#canvas").bind("dblclick",this.createTransectText.bind(this))},r.prototype.addTransectText=function(e){var n=new t(this.app,e,this);this.$textsList.append(n.el),this.set.push(n.element)},r.prototype.createTransectText=function(e){if(this.enTransectTexts){var t=ViewboxToPaper(this.app,e.offsetX,e.offsetY),r=t.x,i=t.y,s=this.transectTexts.findWhere({x:r,y:i})||new n({x:r,y:i},this.app);if(s.get("transect")===null||s.get("zone")===null){s.destroy();return}this.transectTexts.add(s)}},r.prototype.toggleTransectTexts=function(){$("a[href='#add-transect-text']").parent().hasClass("active")?($("a[href='#add-transect-text']").parent().removeClass("active"),this.enTransectTexts=!1):($("a[href='#add-transect-text']").parent().addClass("active"),this.enTransectTexts=!0)},r}),define("zoneView",["baseView"],function(e){var t=e.extend({tagName:"li",classname:"ZoneView",events:{"click .toggle":"toggleZoneForm","click .zone-data":"toggleZoneForm","keypress :input":"updateZone","keyup :input":"updateZone",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return t.prototype.template=new EJS({url:"/commons/ejs/zone.ejs"}),t.prototype.initialize=function(e){this.zone=e,this.listenTo(this.zone,"update",this.render.bind(this)),this.listenTo(this.zone,"change:edit",this.toggleEditStatus.bind(this)),this.listenTo(this.zone.get("topMarker"),"dragEnd",this.markersMoved.bind(this)),this.listenTo(this.zone.get("baseMarker"),"dragEnd",this.markersMoved.bind(this)),this.listenTo(this.zone,"destroy",this.delete.bind(this)),this.render()},t.prototype.render=function(){this.$el.html(this.template.render(this.zone.toJSON())),this.$toggle=this.$(".toggle"),this.$zoneForm=this.$(".zone-form"),this.$zoneData=this.$(".zone-data"),this.$zoneName=this.$('input[name="zone-name"]')[0],this.$zoneDescription=this.$('textarea[name="zone-description"]')[0]},t.prototype.toggleZoneForm=function(){this.render(),this.zone.set({edit:!this.zone.get("edit")})},t.prototype.toggleEditStatus=function(){this.zone.get("edit")?(this.$zoneForm.removeClass("hide"),this.$zoneData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$zoneForm.addClass("hide"),this.$zoneData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},t.prototype.onMouseOver=function(){this.$el.addClass("hover"),this.zone.get("topMarker").set({hover:!0}),this.zone.get("baseMarker").set({hover:!0})},t.prototype.onMouseOut=function(){this.$el.removeClass("hover"),this.zone.get("topMarker").set({hover:!1}),this.zone.get("baseMarker").set({hover:!1})},t.prototype.updateZone=function(e){(e.keyCode==TimescaleApp.ENTER||e.keyCode==TimescaleApp.ESC)&&this.toggleZoneForm();var t=this.$zoneName.value,n=this.$zoneDescription.value.split("\n").join(" ");this.zone.set({name:t,description:n})},t.prototype.delete=function(){this.element!==undefined&&this.element.remove(),this.$el.remove(),this.remove()},t.prototype.destroy=function(){this.zone.destroy()},t.prototype.toggleZone=function(){this.zone.set({toggle:!this.zone.get("toggle")})},t.prototype.markersMoved=function(){this.zone.update()},t}),define("zonesView",["baseView","zoneView","zone"],function(e,t,n){var r=e.extend({el:"#zones-list",classname:"ZonesView"});return r.prototype.template=new EJS({url:"../../../commons/ejs/data_tbl.ejs"}),r.prototype.initialize=function(e){this.app=e,this.zones=this.app.ZonesCollection,this.render(),this.listenTo(this.zones,"add",this.render.bind(this))},r.prototype.render=function(){this.$el.html(this.template.render({name:"Zones"})),this.$zonesTable=this.$(".data-list"),this.zones.each(this.addZone.bind(this))},r.prototype.addZone=function(e){var n=new t(e);this.$zonesTable.append(n.el)},r}),define("pointView",["baseView"],function(e){var t=e.extend({tagName:"li",classname:"PointView",events:{'change input[name="relative-y"]':"updatePoint",'change input[name="relative-x"]':"updatePoint","click .point-data":"togglePointForm","click .arrow":"togglePointForm",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return t.prototype.template=new EJS({url:"/transect_maker/ejs/point.ejs"}),t.prototype.statusBoxTemplate=new EJS({url:"/transect_maker/ejs/status_box.ejs"}),t.prototype.initialize=function(e,t){this.app=e,this.point=t,this.render(),this.listenTo(this.point,"destroy",this.removeElement.bind(this)),this.listenTo(this.point,"change:age",this.render.bind(this)),this.listenTo(this.point,"update",this.render.bind(this)),this.listenTo(this.point,"change:edit",this.toggleEditStatus.bind(this)),this.listenTo(this.point,"change:x",this.renderPoint.bind(this)),this.listenTo(this.point,"change:y",this.renderPoint.bind(this)),this.listenTo(this.point.get("zone"),"destroy",this.updatePointTransetAndZone.bind(this)),this.listenTo(this.point.get("transect"),"destroy",this.updatePointTransetAndZone.bind(this)),this.listenTo(this.point.get("zone"),"update",this.updatePointTransetAndZone.bind(this)),this.listenTo(this.point.get("transect"),"update",this.updatePointTransetAndZone.bind(this))},t.prototype.render=function(){this.$el.html(this.template.render(this.point.toJSON())),this.$toggle=this.$(".toggle"),this.$pointForm=this.$(".point-form"),this.$pointData=this.$(".point-data"),this.$pointName=this.$('input[name="point-name"]'),this.$pointAge=this.$('input[name="point-age"]'),this.$pointRelativeX=this.$('input[name="relative-x"]'),this.$pointRelativeY=this.$('input[name="relative-y"]'),this.renderPoint()},t.prototype.renderPoint=function(){this.element===undefined&&(this.element=this.app.Paper.circle(this.point.get("x"),this.point.get("y"),4),this.app.PointsSet.push(this.element),this.element.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this)),this.element.click(this.onClick.bind(this)),this.element.drag(this.onDragMove.bind(this),this.onDragStart.bind(this),this.onDragEnd.bind(this)),this.element.attr({fill:"#000000"})),this.updateElement(),this.renderTooltip()},t.prototype.renderTooltip=function(){var e=this.point.get("name")+"<br/>";this.point.get("zone")&&(e+=this.point.get("zone").get("name")+"<br/>"),this.point.get("transect")&&(e+=this.point.get("transect").get("name")),$(this.element.node).qtip({content:{text:e},position:{my:"bottom left",target:"mouse",adjust:{x:10,y:-10}}})},t.prototype.updateElement=function(){this.element.attr({cx:this.point.get("x"),cy:this.point.get("y")}),this.updateStatusBox()},t.prototype.updateStatusBox=function(){this.app.StatusBox.html(this.statusBoxTemplate.render(this.point.toStatusJSON()))},t.prototype.setFinishedMode=function(){this.element.attr({r:4,fill:"#000000",stroke:"#000000"}),this.$el.removeClass("hover")},t.prototype.setEditMode=function(){this.element.attr({r:8,fill:"#FF0033",stroke:"#FF0033"}),this.$el.addClass("hover")},t.prototype.hover=function(){this.element.attr({r:10})},t.prototype.unhover=function(){this.element.attr({r:5})},t.prototype.onMouseOver=function(){this.app.supressDoubleClick=!0,this.updateStatusBox(),this.setEditMode()},t.prototype.onMouseOut=function(){this.app.supressDoubleClick=!1,this.setFinishedMode()},t.prototype.onClick=function(){this.app.CurrentPolygon!==null&&this.app.CurrentPolygon.get("draw")&&this.app.CurrentPolygon.get("points").add(this.point)},t.prototype.onDblClick=function(e){},t.prototype.removeElement=function(){this.element.remove()},t.prototype.onDragStart=function(e,t,n){},t.prototype.onDragMove=function(e,t,n,r,i){var s=i.offsetX,o=i.offsetY,u=ViewboxToPaper(this.app,s,o);s=u.x,o=u.y,this.app.Cursor.get("lockH")&&(o=this.point.get("y")),this.app.Cursor.get("lockV")&&(s=this.point.get("x")),this.point.set({x:s,y:o})},t.prototype.onDragEnd=function(e){var t=ViewboxToPaper(this.app,e.offsetX,e.offsetY),n=this.app.TransectsCollection.getTransectForX(t.x),r=this.app.ZonesCollection.getZoneForY(t.y),i=this.point.get("x"),s=this.point.get("y");if(n===null){n=this.point.get("transect");var o=n.get("wellRight").get("x");i>o&&(i=o-1);var o=n.get("wellLeft").get("x");i<o&&(i=o+1)}if(r===null){r=this.point.get("zone");var u=r.get("baseMarker").get("y");s>u&&(s=u-1);var u=r.get("topMarker").get("y");s<u&&(s=u+1)}this.point.set({x:i,y:s}),this.point.updateTransectAndZone()},t.prototype.togglePointForm=function(){this.render(),this.point.set({edit:!this.point.get("edit")})},t.prototype.toggleEditStatus=function(){this.point.get("edit")?(this.$pointForm.removeClass("hide"),this.$pointData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data"),this.setEditMode()):(this.$pointForm.addClass("hide"),this.$toggle.removeClass("show-data"),this.$pointData.removeClass("hide"),this.$toggle.addClass("hide-data"),this.setFinishedMode())},t.prototype.updatePointTransetAndZone=function(e){this.point.updateTransectAndZone(),this.point.update()},t.prototype.updatePoint=function(e){(e.keyCode==TimescaleApp.ENTER||e.keyCode==TimescaleApp.ESC)&&this.togglePointForm();var t=this.$pointRelativeX.val()*1/100,n=(100-this.$pointRelativeY.val()*1)/100;if(this.point.get("transect")&&this.point.get("zone")){var r=this.point.get("transect").getAbsoluteX(t),i=this.point.get("zone").getAbsoluteY(n);this.point.set({x:r,y:i}),this.point.updateTransectAndZone()}},t}),define("lineView",["baseView"],function(e){var t=e.extend({tagName:"li",classname:"LineView",events:{"click .line-name":"toggleLineForm","click .line-data":"toggleLineForm","keypress :input":"updateLine","keyup :input":"updateLine",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return t.prototype.template=new EJS({url:"../../../transect_maker/ejs/line.ejs"}),t.prototype.initialize=function(e,t){this.app=e,this.line=t,this.listenTo(this.line,"destroy",this.removeElement.bind(this)),this.listenTo(this.line,"change:edit",this.toggleEditStatus.bind(this)),this.listenTo(this.line,"change:name",this.renderLine.bind(this)),this.listenTo(this.line.get("point1"),"change",this.renderLine.bind(this)),this.listenTo(this.line.get("point2"),"change",this.renderLine.bind(this)),this.listenTo(this.line,"change:pattern",this.render.bind(this)),this.render()},t.prototype.render=function(){this.$el.html(this.template.render(this.line.toJSON())),this.$toggle=this.$(".toggle"),this.$lineForm=this.$(".line-form"),this.$lineData=this.$(".line-data"),this.$lineName=this.$('input[name="line-name"]')[0],this.$linePattern=this.$("select.line-pattern"),this.$linePattern.change(this.updateLine.bind(this)),this.renderLine()},t.prototype.renderLine=function(){this.element===undefined&&(this.element=this.app.Paper.path(),this.app.LinesSet.push(this.element));var e="M"+this.line.get("point1").get("x")+","+this.line.get("point1").get("y");e+=this.line.getPath(),this.element.attr({path:e}),this.element.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this)),this.setFinishedMode()},t.prototype.renderTooltip=function(){var e=this.line.get("name");$(this.element.node).qtip({content:{text:e},position:{my:"bottom left",target:"mouse"}})},t.prototype.onMouseOut=function(){this.setFinishedMode()},t.prototype.onMouseOver=function(){this.setEditMode()},t.prototype.removeElement=function(){this.remove(),this.element.remove()},t.prototype.toggleLineForm=function(){this.render(),this.line.set({edit:!this.line.get("edit")})},t.prototype.toggleEditStatus=function(){this.line.get("edit")?(this.$lineForm.removeClass("hide"),this.$lineData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$lineForm.addClass("hide"),this.$lineData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},t.prototype.setFinishedMode=function(){this.element.attr({"stroke-width":2,stroke:transectApp.lineMouseOut,fill:"none"}),this.$el.removeClass("hover")},t.prototype.setEditMode=function(){this.element.attr({"stroke-width":6,stroke:transectApp.lineMouseOver,fill:"none"}),this.$el.addClass("hover")},t.prototype.updateLine=function(e){var t=this.$("select.line-pattern option:selected").val();this.line.set({pattern:t})},t}),define("points",["baseCollection","point"],function(e,t){var n=e.extend({classname:"Points",model:t});return n.prototype.updatePoints=function(){return this.each(function(e){e.updateTransectAndZone()}),!0},n.prototype.add=function(t){if(t===undefined)return;var n=this.any(function(e){return e.get("x")==t.x&&e.get("y")==t.y});n||e.prototype.add.call(this,t)},n.prototype.getPolyKPointsArray=function(){var e=[];return this.each(function(t){e.push(t.get("x")),e.push(t.get("y"))}),e},n}),define("lines",["baseCollection","line"],function(e,t){var n=e.extend({classname:"Lines",model:t});return n.prototype.findLineForPoints=function(e){var t=transectApp.PointsCollection.findWhere({x:e.x1,y:e.y1}),n=transectApp.PointsCollection.findWhere({x:e.x2,y:e.y2});return this.findWhere({point1:t,point2:n})},n}),define("polygon",["baseModel","points","lines","polyK"],function(e,t,n,r){var i=e.extend({classname:"Polygon",constructor:function(r,i){var s=[{id:_.uniqueId("polygon_"),hover:!1,edit:!1,draw:!1,toFront:!1,name:r&&r.name?r.name:_.uniqueId("Polygon "),patternName:r?r.patternName:null,points:new t,lines:new n,description:r!==undefined&&r.description?r.description:null}];e.apply(this,s)}});return i.prototype.getPolyKPointsArray=function(){var e=[];return this.get("points").each(function(t){e.push(t.get("x")),e.push(t.get("y"))}),e},i.prototype.isSimple=function(){var e=this.getPolyKPointsArray();return r.IsSimple(e)},i.prototype.toJSON=function(){var e=_.clone(this.attributes);return delete e.lines,e},i}),define("polygons",["baseCollection","polygon"],function(e,t){var n=e.extend({classname:"Polygons",model:t,comparator:function(e){var t=e.get("points"),n=Infinity;return t.each(function(e){e.get("y")<=n&&(n=e.get("y"))}),n}});return n}),define("line",["baseModel","transects","polygons","polyK"],function(e,t,n,r){var i=e.extend({classname:"Line",constructor:function(r,i,s){var o=[{edit:!1,name:r.name||_.uniqueId("Line "),pattern:"default",point1:i,point2:s,transects:new t,polygons:new n}];e.apply(this,o)}});return i.prototype.jaggedDistance=10,i.prototype.waveHeight=5,i.prototype.getPatternPoints=function(){var e=numeric.linspace(this.point1.get("x"),this.point2.get("x"),steps),t=numeric.linspace(this.point1.get("y"),this.point2.get("y"),steps)},i.prototype.getPolyKPointsArray=function(){var e=[];return e.push(this.get("point1").get("x")),e.push(this.get("point1").get("y")),e.push(this.get("point2").get("x")),e.push(this.get("point2").get("y")),e},i.prototype.slope=function(){var e=(this.get("point1").get("y")-this.get("point2").get("y"))/(this.get("point1").get("x")-this.get("point2").get("x"));return e},i.prototype.coincides=function(e){var t=e.getPolyKPointsArray(),n=this.getPolyKPointsArray(),i=[],s=3;return i.push(this.pointAtADistanceFromXY(n[0],n[1],s)),i.push(this.pointAtADistanceFromXY(n[0],n[1],-s)),i.push(this.pointAtADistanceFromXY(n[2],n[3],-s)),i.push(this.pointAtADistanceFromXY(n[2],n[3],s)),i=_.flatten(i),r.ContainsPoint(i,t[0],t[1])&&r.ContainsPoint(i,t[2],t[3])?!0:!1},i.prototype.getPath=function(){return this.getPathFromPattern(this.get("pattern"))},i.prototype.getPathFromPattern=function(e){switch(e){case"default":return this.getStraightPath();case"jagged":return this.getJaggedPath();case"wavy":return this.getWavyPath();case"lapping":return this.getJaggedPath()}},i.prototype.getStraightPath=function(){var e=",L"+this.get("point2").get("x")+","+this.get("point2").get("y");return e},i.prototype.getJaggedPath=function(){var e=this.get("point1").get("y")-this.get("point2").get("y"),t=this.get("point1").get("x")-this.get("point2").get("x"),n=e/t,r=Math.round(Math.abs(this.get("point1").get("y")-this.get("point2").get("y"))/10),i=numeric.linspace(this.get("point1").get("x"),this.get("point2").get("x"),r),s=numeric.linspace(this.get("point1").get("y"),this.get("point2").get("y"),r),o="";if(i.length==0)return this.getStraightPath();for(var u=0;u<i.length;u++)u!=0&&(e>0&&n>0||e<0&&n<0?(o+=",L"+(i[u-1]+this.jaggedDistance)+","+s[u-1],o+=",L"+(i[u]-this.jaggedDistance)+","+s[u],u<i.length-1?o+=",L"+(i[u]+this.jaggedDistance)+","+s[u]:o+=",L"+i[u]+","+s[u]):(o+=",L"+(i[u-1]-this.jaggedDistance)+","+s[u-1],o+=",L"+(i[u]+this.jaggedDistance)+","+s[u],u<i.length-1?o+=",L"+(i[u]-this.jaggedDistance)+","+s[u]:o+=",L"+i[u]+","+s[u]));return o},i.prototype.getWavyPath=function(){var e=Math.round(Math.abs(this.get("point1").get("y")-this.get("point2").get("y"))/3),t=Math.round(Math.abs(this.get("point1").get("x")-this.get("point2").get("x"))/3),n=Math.max(t,e),r=numeric.linspace(this.get("point1").get("x"),this.get("point2").get("x"),n),i=numeric.linspace(this.get("point1").get("y"),this.get("point2").get("y"),n),s="";if(n==0)return this.getStraightPath();for(var o=0;o<n;o++){var u=r.length>0?r[o]:this.get("point1").get("x"),a=i.length>0?i[o]:this.get("point1").get("y");o!=0&&(o%2==1?(o%4==3?plPoint=this.pointAtADistanceFromXY(u,a,-this.waveHeight):plPoint=this.pointAtADistanceFromXY(u,a,this.waveHeight),s+=",S"+plPoint[0]+","+plPoint[1]):s+=","+u+","+a)}return s+=",L"+this.get("point2").get("x")+","+this.get("point2").get("y"),s},i.prototype.pointAtADistanceFromXY=function(e,t,n){var r=(this.get("point1").get("x")-this.get("point2").get("x"))/(this.get("point2").get("y")-this.get("point1").get("y")),i,s;return r===Infinity||r===-Infinity?(i=e,s=t+n):(i=e+n/Math.sqrt(1+r*r),s=t+r*(i-e)),[i,s]},i}),define("polygonView",["baseView","pointView","lineView","point","points","line","lines","polyK"],function(e,t,n,r,i,s,o,u){var a=e.extend({tagName:"li",classname:"PolygonView",events:{"click .toggle":"togglePolygonForm","click .toggle-polygon":"togglePolygonForm","click .polygon-data":"togglePolygonForm","click a.polygon-list-tool":"showList","click .destroy":"destroy","click .to-front":"toFront","keyup :input":"updatePolygon","click label.polygon-line-data":"showPolygonLinesList","click label.polygon-point-data":"showPolygonPointsList","click label.polygon-pattern-data":"showPolygonPatternsList",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return a.prototype.template=new EJS({url:"/transect_maker/ejs/polygon.ejs"}),a.prototype.initialize=function(e,t){this.app=e,this.polygon=t,this.pointsSet=this.app.Paper.set(),this.linesSet=this.app.Paper.set(),this.render(),this.listenToActionEvents(),this.listenTo(this.polygon,"change:edit",this.toggleEditStatus.bind(this)),this.listenTo(this.polygon,"change:draw",this.setRenderMode.bind(this)),this.listenTo(this.polygon,"update",this.updatePolygonView.bind(this)),this.listenTo(this.polygon,"change:patternName",this.updatePolygonView.bind(this)),this.listenTo(this.polygon.get("points"),"change",this.renderPolygonElement.bind(this)),this.listenTo(this.polygon.get("lines"),"change",this.renderPolygonElement.bind(this)),this.listenTo(this.polygon.get("points"),"add",this.addPointToPolygon.bind(this)),this.listenTo(this.polygon.get("points"),"reset",this.resetPolygonPoints.bind(this)),this.listenTo(this.polygon.get("lines"),"add",this.addLineToPolygon.bind(this)),this.listenTo(this.polygon.get("lines"),"reset",this.resetPolygonLines.bind(this)),this.listenTo(this.polygon.get("lines"),"remove",this.updatePolygonLines.bind(this)),this.listenTo(this.polygon,"destroy",this.delete.bind(this))},a.prototype.updatePolygonLines=function(){},a.prototype.updatePolygonView=function(e){this.$polygonData.html(this.polygon.get("name")+" → "+this.polygon.get("patternName")),this.renderPolygonElement(),this.setPolygonFill(),this.toggleEditStatus()},a.prototype.render=function(){this.$el.html(this.template.render(this.polygon.toJSON())),this.$togglePolygon=this.$(".toggle-polygon"),this.$polygonForm=this.$(".polygon-form"),this.$polygonData=this.$(".polygon-data"),this.$polygonName=this.$('input[name="polygon-name"]')[0],this.$polygonDescription=this.$('textarea[name="polygon-description"]')[0],this.$linesList=this.$(".lines-list"),this.$pointsList=this.$(".points-list"),this.$patternsList=this.$(".patterns-list"),this.$polygonPattern=this.$("select.polygon-pattern"),this.$patternImage=this.$(".patterns-image"),this.$polygonPattern.change(this.updatePolygonPattern.bind(this)),this.renderPoints()},a.prototype.renderPoints=function(){this.polygon.get("points").each(this.addPoint.bind(this))},a.prototype.showPolygonLinesList=function(){this.$linesList.hasClass("hide")?this.$linesList.removeClass("hide"):this.$linesList.addClass("hide")},a.prototype.showPolygonPointsList=function(){this.$pointsList.hasClass("hide")?this.$pointsList.removeClass("hide"):this.$pointsList.addClass("hide")},a.prototype.showPolygonPatternsList=function(){this.$patternsList.hasClass("hide")?this.$patternsList.removeClass("hide"):this.$patternsList.addClass("hide")},a.prototype.updatePolygonPattern=function(){var e=this.$("select.polygon-pattern option:selected").val();this.polygon.set({patternName:e})},a.prototype.listenToActionEvents=function(){$("#canvas").bind("dblclick",this.addPoint.bind(this))},a.prototype.addPointToPolygon=function(e){var n=new t(this.app,e);this.$pointsList.append(n.el),this.pointsSet.push(n.element),this.polygon.get("points").length>1&&this.resetLines(),this.app.PointsCollection.add(e),this.updatePaperDimensions(e)},a.prototype.isSimple=function(e){var t=this.polygon.getPolyKPointsArray();return u.IsSimple(t)},a.prototype.updatePaperDimensions=function(e){},a.prototype.resetLines=function(){var e=[],t=this.polygon.get("points").at(this.polygon.get("points").length-2),n=this.polygon.get("points").first(),r=this.app.LinesCollection.findWhere({point1:t,point2:n})||this.app.LinesCollection.findWhere({point1:n,point2:t});r!==undefined&&r.get("polygons").length<2&&r.destroy(),t=this.polygon.get("points").at(this.polygon.get("points").length-2),n=this.polygon.get("points").last();var i=this.app.LinesCollection.findWhere({point1:t,point2:n})||this.app.LinesCollection.findWhere({point1:n,point2:t})||new s({},t,n);i.get("polygons").add(this.polygon),t=this.polygon.get("points").last(),n=this.polygon.get("points").first();var o=this.app.LinesCollection.findWhere({point1:t,point2:n})||this.app.LinesCollection.findWhere({point1:n,point2:t})||new s({},t,n);o.get("polygons").add(this.polygon),this.polygon.get("lines").add([i,o]),this.renderPolygonElement(),this.setRenderFill(),this.bringToFront()},a.prototype.bringToFront=function(){this.app.PolygonsSet.toFront(),this.element.toFront(),this.app.MarkersSet.toFront(),this.app.WellsSet.toFront(),this.app.LinesSet.toFront(),this.app.TextsSet.toFront(),this.app.PointsSet.toFront()},a.prototype.addLineToPolygon=function(e){this.app.LinesCollection.add(e);var t=new n(this.app,e);this.linesSet.push(t.element),this.$linesList.append(t.el)},a.prototype.resetPolygonLines=function(){this.polygon.get("lines").each(this.addLineToPolygon,this)},a.prototype.resetPolygonPoints=function(){this.polygon.get("points").each(this.addPointToPolygon,this)},a.prototype.addPoint=function(e){if(this.app.supressDoubleClick)return;if(!this.polygon.get("draw"))return;var t=e.offsetX,n=e.offsetY,i=ViewboxToPaper(this.app,t,n);t=i.x,n=i.y,this.polygon.get("points").length>0&&this.app.Cursor.get("lockH")&&(n=this.polygon.get("points").last().get("y")),this.polygon.get("points").length>0&&this.app.Cursor.get("lockV")&&(t=this.polygon.get("points").last().get("x"));var s=this.app.PointsCollection.findWhere({x:t,y:n})||new r({x:t,y:n},this.app);if(s.get("transect")===null||s.get("zone")===null){s.destroy();return}this.polygon.get("points").add(s)},a.prototype.setRenderFill=function(){if(this.element===undefined)return;this.element.attr({opacity:.5,stroke:0,fill:transectApp.renderFill})},a.prototype.setRenderErrorFill=function(){if(this.element===undefined)return;this.element.attr({opacity:.5,stroke:0,fill:"#FF0000"})},a.prototype.setPolygonFill=function(){if(this.element===undefined)return;var e=this.polygon.get("patternName"),t=e&&tscApp.PATTERNS[e]?"url('/pattern_manager/patterns/"+tscApp.PATTERNS[e]+"')":transectApp.polygonFill;this.element.attr({opacity:.5,stroke:0,fill:t});var n=t+" no-repeat";this.$patternImage.css("background",n)},a.prototype.toggleEditStatus=function(){if(this.element===undefined)return;this.polygon.get("edit")?(this.$polygonForm.removeClass("hide"),this.$polygonData.addClass("hide"),this.$togglePolygon.removeClass("hide-data"),this.$togglePolygon.addClass("show-data")):(this.$polygonForm.addClass("hide"),this.$polygonData.removeClass("hide"),this.$togglePolygon.removeClass("show-data"),this.$togglePolygon.addClass("hide-data"))},a.prototype.getConvexHull=function(){var e=[],t=this.polygon.get("points").toArray();t.sort(sortPointX),t.sort(sortPointY);var n=chainHull_2D(t,t.length,e);_.invoke(this.polygon.get("points").toArray(),"destroy"),this.polygon.get("points").reset(e)},a.prototype.getPath=function(){var e="M",t=this;return this.polygon.get("points").each(function(n,r,i){if(r==0)e+=n.get("x")+","+n.get("y");else{var o=t.polygon.get("lines").findWhere({point1:i[r-1],point2:n});if(o!==undefined)e+=o.getPath();else{o=t.polygon.get("lines").findWhere({point1:n,point2:i[r-1]});if(o!==undefined){var u=new s({},i[r-1],n);e+=u.getPathFromPattern(o.get("pattern")),u.destroy()}}if(r>0&&r===i.length-1){o=t.polygon.get("lines").findWhere({point1:n,point2:i[0]});if(o!==undefined)e+=o.getPath();else{o=t.polygon.get("lines").findWhere({point1:i[0],point2:n});if(o!==undefined){var u=new s({},n,i[0]);e+=u.getStraightPath(),u.destroy()}}}}}),e},a.prototype.renderPolygonElement=function(){this.element===undefined&&(this.element=this.app.Paper.path(),this.element.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this)),this.app.PolygonsSet.push(this.element)),this.element.attr({path:this.getPath()}),this.renderTooltip(),this.setRenderMode(),this.bringToFront()},a.prototype.renderTooltip=function(){$(this.element.node).qtip({content:{text:this.polygon.get("name")+"【"+this.polygon.get("patternName")+"】<br>"+(this.polygon.get("description")||"No description yet!")},position:{my:"bottom left",target:"mouse",adjust:{x:10,y:-10}},show:{solo:!0}})},a.prototype.hover=function(){this.glow!==undefined&&this.glow.remove(),this.glow=this.element.glow({color:transectApp.glowColor,width:40,opacity:1}),this.glow.show()},a.prototype.unhover=function(){this.polygon.isSimple()?this.setPolygonFill():this.setRenderErrorFill(),this.glow!==undefined&&this.glow.hide()},a.prototype.onMouseOver=function(){if(!this.element)return;this.hover(),this.$el.addClass("hover")},a.prototype.onMouseOut=function(){if(!this.element)return;this.unhover(),this.$el.removeClass("hover")},a.prototype.moveToBottom=function(){this.element.toBack(),this.app.transectImageElement!==undefined&&this.app.transectImageElement.toBack()},a.prototype.togglePolygonForm=function(){this.polygon.set({edit:!this.polygon.get("edit")})},a.prototype.showList=function(e){this.$(".polygon-settings").removeClass("active");var t="."+e.target.getAttribute("href").slice(1)+"-tab";this.$(t).addClass("active")},a.prototype.delete=function(){this.element!==undefined&&this.element.remove(),this.linesSet!==undefined&&this.linesSet.remove(),this.pointsSet!==undefined&&this.pointsSet.remove(),this.glow!==undefined&&this.glow.remove(),this.$el.remove(),this.remove()},a.prototype.destroy=function(){this.polygon.destroy()},a.prototype.updatePolygon=function(e){(e.keyCode==TimescaleApp.ENTER||e.keyCode==TimescaleApp.ESC)&&this.togglePolygonForm(),this.polygon.set({name:this.$polygonName.value,description:this.$polygonDescription.value.split("\n").join(" ")}),this.polygon.update()},a.prototype.setRenderMode=function(){this.polygon.get("draw")?(this.setRenderFill(),this.$el.addClass("highlight")):(this.polygon.isSimple()?this.setPolygonFill():this.setRenderErrorFill(),this.$el.removeClass("highlight"))},a.prototype.toFront=function(){this.element&&this.bringToFront()},a}),define("polygonsView",["baseView","polygonView","polygon"],function(e,t,n){var r=e.extend({el:"#polygons-list",classname:"PolygonsView"});return r.prototype.template=new EJS({url:"/commons/ejs/data_tbl.ejs"}),r.prototype.initialize=function(e){this.app=e,CurrentPolygon=null,this.polygonsCollection=this.app.PolygonsCollection,this.enPolygons=!1,this.render(),this.listenToActionEvents(),this.listenTo(this.polygonsCollection,"add",this.addPolygon.bind(this))},r.prototype.render=function(){this.$el.html(this.template.render({name:"Polygons"})),this.$polygonsList=this.$(".data-list"),this.renderPolygons()},r.prototype.renderPolygons=function(){this.polygonsCollection.each(this.addPolygon.bind(this))},r.prototype.listenToActionEvents=function(){$('a[href="#new-polygon"]').click(this.createPolygon.bind(this))},r.prototype.addPolygon=function(e){var n=new t(this.app,e);this.$polygonsList.append(n.el)},r.prototype.togglePolygons=function(){$("a[href='#add-polygon']").parent().hasClass("hide")?($("a[href='#add-polygon']").parent().removeClass("hide"),$("a[href='#new-polygon']").parent().addClass("hide"),this.enPolygons=!1):($("a[href='#add-polygon']").parent().addClass("hide"),$("a[href='#new-polygon']").parent().removeClass("hide"),this.enPolygons=!0,this.createPolygon())},r.prototype.createPolygon=function(){if(!this.enPolygons)return;this.checkAndDeleteCurrentPolygon(),this.disableAllPolygons(),this.app.CurrentPolygon=new n,this.polygonsCollection.add(this.app.CurrentPolygon),this.disableAllPolygons(),this.app.CurrentPolygon.set({draw:!0})},r.prototype.checkAndDeleteCurrentPolygon=function(){this.app.CurrentPolygon&&(this.app.CurrentPolygon.set({draw:!1}),this.app.CurrentPolygon.get("points").length<3&&this.app.CurrentPolygon.destroy())},r.prototype.disableAllPolygons=function(){this.polygonsCollection.each(function(e){e.set("draw",!1)})},r}),define("dataImportView",["baseView"],function(e){var t=e.extend({el:".container",classname:"DataImportView"});return t.prototype.initialize=function(){this.$dataStatus=this.$(".data-status")},t}),define("dataExportView",["baseView"],function(e){var t=e.extend({el:"#export-panel",classname:"DataExportView",events:{"click a.show-data":"showData"}});return t.prototype.template=new EJS({url:"/transect_maker/ejs/data_export_panel.ejs"}),t.prototype.transectWellDataTemplate=new EJS({url:"/transect_maker/ejs/wells_data.ejs"}),t.prototype.transectDataLayout=new EJS({url:"/transect_maker/ejs/transect_data_layout.ejs"}),t.prototype.initialize=function(e){this.app=e,this.markers=this.app.TransectMarkersCollection,this.polygons=this.app.PolygonsCollection,this.render(),this.$canvas=$("#canvas")},t.prototype.render=function(){this.exporter=this.app.exporter,this.transects=this.app.TransectsCollection,this.$el.html(this.template.render({transects:this.transects.toJSON()})),this.$transectData=this.$(".transect-data"),this.$showData=this.$(".show-data"),this.$dataTable=this.$(".data-table"),this.$dataRaw=this.$(".data-raw"),this.$dataJSON=this.$(".data-json"),this.$mapData=this.$(".map-data"),this.$textData=this.$("textarea[name*=transect-data-text]")[0],this.$textJSON=this.$("textarea[name*=transect-data-json]")[0],this.$textMap=this.$("textarea[name*=transect-map-data]")[0],this.$showTable=this.$('a[href="#show-table"]'),this.$showRaw=this.$('a[href="#show-raw"]'),this.$showJSON=this.$('a[href="#show-json"]'),this.$showMap=this.$('a[href="#show-map-data"]'),this.exporter.export(),this.renderWellsData(),this.renderTransectsData(),this.renderDataInText(),this.renderMapData()},t.prototype.isAgeSet=function(){for(var e=0;e<this.markers.length;e++){var t=this.markers.at(e);if(t.get("age")==null)return!1}return!0},t.prototype.renderWellsData=function(){var e=this.exporter.wellsData;for(var t in e)this.$("#"+t).html(this.transectWellDataTemplate.render(e[t]))},t.prototype.renderTransectsData=function(){var e=this.exporter.transectsData;for(var t in e)this.$("#"+t).html(this.transectDataLayout.render(e[t]))},t.prototype.renderDataInText=function(){this.$textData.value=this.exporter.getText()},t.prototype.renderDataInJSON=function(){this.$textJSON.value=this.exporter.getJSON()},t.prototype.renderMapData=function(){this.$textMap.value=this.exporter.getMapData()},t.prototype.toggleExportView=function(e){$("a[href='#export-data']").parent().hasClass("active")?($("a[href='#export-data']").parent().removeClass("active"),$(".display-panel").addClass("hide"),this.$canvas.removeClass("hide")):(this.render(),$(".maker-tools").parent().removeClass("active"),$("a[href='#export-data']").parent().addClass("active"),$(".display-panel").addClass("hide"),this.$el.removeClass("hide"))},t.prototype.showData=function(e){this.$transectData.addClass("hide"),this.$showData.removeClass("alert"),$(e.target).addClass("alert");var t=$(e.target).attr("href");t==="#show-table"?this.$dataTable.removeClass("hide"):t==="#show-raw"?this.$dataRaw.removeClass("hide"):t==="#show-map-data"&&this.$mapData.removeClass("hide")},t}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("jszip",[],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JSZip=e()}}(function(){return function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!u&&l)return l(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var h=n[o]={exports:{}};t[o][0].call(h.exports,function(e){var n=t[o][1][e];return i(n?n:e)},h,h.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,s,o,u,a,f="",l=0;l<e.length;)t=e.charCodeAt(l++),n=e.charCodeAt(l++),i=e.charCodeAt(l++),s=t>>2,o=(3&t)<<4|n>>4,u=(15&n)<<2|i>>6,a=63&i,isNaN(n)?u=a=64:isNaN(i)&&(a=64),f=f+r.charAt(s)+r.charAt(o)+r.charAt(u)+r.charAt(a);return f},n.decode=function(e){var t,n,i,s,o,u,a,f="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)s=r.indexOf(e.charAt(l++)),o=r.indexOf(e.charAt(l++)),u=r.indexOf(e.charAt(l++)),a=r.indexOf(e.charAt(l++)),t=s<<2|o>>4,n=(15&o)<<4|u>>2,i=(3&u)<<6|a,f+=String.fromCharCode(t),64!=u&&(f+=String.fromCharCode(n)),64!=a&&(f+=String.fromCharCode(i));return f}},{}],2:[function(e,t){function n(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}n.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=n},{}],3:[function(e,t,n){n.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},n.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){var n=e("./utils"),r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var i="string"!==n.getTypeOf(e);"undefined"==typeof t&&(t=0);var s=0,o=0,u=0;t=-1^t;for(var a=0,f=e.length;f>a;a++)u=i?e[a]:e.charCodeAt(a),o=255&(t^u),s=r[o],t=t>>>8^s;return-1^t}},{"./utils":21}],5:[function(e,t){function n(){this.data=null,this.length=0,this.index=0}var r=e("./utils");n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=n},{"./utils":21}],6:[function(e,t,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!1,n.date=null,n.compression=null,n.comment=null},{}],7:[function(e,t,n){var r=e("./utils");n.string2binary=function(e){return r.string2binary(e)},n.string2Uint8Array=function(e){return r.transformTo("uint8array",e)},n.uint8Array2String=function(e){return r.transformTo("string",e)},n.string2Blob=function(e){var t=r.transformTo("arraybuffer",e);return r.arrayBuffer2Blob(t)},n.arrayBuffer2Blob=function(e){return r.arrayBuffer2Blob(e)},n.transformTo=function(e,t){return r.transformTo(e,t)},n.getTypeOf=function(e){return r.getTypeOf(e)},n.checkSupport=function(e){return r.checkSupport(e)},n.MAX_VALUE_16BITS=r.MAX_VALUE_16BITS,n.MAX_VALUE_32BITS=r.MAX_VALUE_32BITS,n.pretty=function(e){return r.pretty(e)},n.findCompression=function(e){return r.findCompression(e)},n.isRegExp=function(e){return r.isRegExp(e)}},{"./utils":21}],8:[function(e,t,n){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako");n.uncompressInputType=r?"uint8array":"array",n.compressInputType=r?"uint8array":"array",n.magic="\b\0",n.compress=function(e){return i.deflateRaw(e)},n.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t){function n(e,t){return this instanceof n?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void (this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new n(e,t)}var r=e("./base64");n.prototype=e("./object"),n.prototype.load=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.utils=e("./deprecatedPublicUtils"),n.base64={encode:function(e){return r.encode(e)},decode:function(e){return r.decode(e)}},n.compressions=e("./compressions"),t.exports=n},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){var n=e("./base64"),r=e("./zipEntries");t.exports=function(e,t){var i,s,o,u;for(t=t||{},t.base64&&(e=n.decode(e)),s=new r(e,t),i=s.files,o=0;o<i.length;o++)u=i[o],this.file(u.fileName,u.decompressed,{binary:!0,optimizedBinaryString:!0,date:u.date,dir:u.dir,comment:u.fileComment.length?u.fileComment:null,createFolders:t.createFolders});return s.zipComment.length&&(this.comment=s.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,t){(function(e){t.exports=function(t,n){return new e(t,n)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,t){function n(e){this.data=e,this.length=this.data.length,this.index=0}var r=e("./uint8ArrayReader");n.prototype=new r,n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=n},{"./uint8ArrayReader":18}],13:[function(e,t){var n=e("./support"),r=e("./utils"),i=e("./crc32"),s=e("./signature"),o=e("./defaults"),u=e("./base64"),a=e("./compressions"),f=e("./compressedObject"),l=e("./nodeBuffer"),c=e("./utf8"),h=e("./stringWriter"),p=e("./uint8ArrayWriter"),d=function(e){if(e._data instanceof f&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===r.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},v=function(e){var t=d(e),i=r.getTypeOf(t);return"string"===i?!e.options.binary&&n.nodebuffer?l(t,"utf-8"):e.asBinary():t},m=function(e){var t=d(this);return null===t||"undefined"==typeof t?"":(this.options.base64&&(t=u.decode(t)),t=e&&this.options.binary?C.utf8decode(t):r.transformTo("string",t),e||this.options.binary||(t=r.transformTo("string",C.utf8encode(t))),t)},g=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this._data=t,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};g.prototype={asText:function(){return m.call(this,!0)},asBinary:function(){return m.call(this,!1)},asNodeBuffer:function(){var e=v(this);return r.transformTo("nodebuffer",e)},asUint8Array:function(){var e=v(this);return r.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var y=function(e,t){var n,r="";for(n=0;t>n;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},b=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof n[t]&&(n[t]=arguments[e][t]);return n},w=function(e){return e=e||{},e.base64!==!0||null!==e.binary&&void 0!==e.binary||(e.binary=!0),e=b(e,o),e.date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},E=function(e,t,n){var i,s=r.getTypeOf(t);if(n=w(n),n.createFolders&&(i=S(e))&&x.call(this,i,!0),n.dir||null===t||"undefined"==typeof t)n.base64=!1,n.binary=!1,t=null;else if("string"===s)n.binary&&!n.base64&&n.optimizedBinaryString!==!0&&(t=r.string2binary(t));else{if(n.base64=!1,n.binary=!0,!(s||t instanceof f))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===s&&(t=r.transformTo("uint8array",t))}var o=new g(e,t,n);return this.files[e]=o,o},S=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},x=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t="undefined"!=typeof t?t:!1,this.files[e]||E.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},T=function(e,t){var n,s=new f;return e._data instanceof f?(s.uncompressedSize=e._data.uncompressedSize,s.crc32=e._data.crc32,0===s.uncompressedSize||e.dir?(t=a.STORE,s.compressedContent="",s.crc32=0):e._data.compressionMethod===t.magic?s.compressedContent=e._data.getCompressedContent():(n=e._data.getContent(),s.compressedContent=t.compress(r.transformTo(t.compressInputType,n)))):(n=v(e),(!n||0===n.length||e.dir)&&(t=a.STORE,n=""),s.uncompressedSize=n.length,s.crc32=i(n),s.compressedContent=t.compress(r.transformTo(t.compressInputType,n))),s.compressedSize=s.compressedContent.length,s.compressionMethod=t.magic,s},N=function(e,t,n,o){var u,a,f,l,h=(n.compressedContent,r.transformTo("string",c.utf8encode(t.name))),p=t.comment||"",d=r.transformTo("string",c.utf8encode(p)),v=h.length!==t.name.length,m=d.length!==p.length,g=t.options,b="",w="",E="";f=t._initialMetadata.dir!==t.dir?t.dir:g.dir,l=t._initialMetadata.date!==t.date?t.date:g.date,u=l.getHours(),u<<=6,u|=l.getMinutes(),u<<=5,u|=l.getSeconds()/2,a=l.getFullYear()-1980,a<<=4,a|=l.getMonth()+1,a<<=5,a|=l.getDate(),v&&(w=y(1,1)+y(i(h),4)+h,b+="up"+y(w.length,2)+w),m&&(E=y(1,1)+y(this.crc32(d),4)+d,b+="uc"+y(E.length,2)+E);var S="";S+="\n\0",S+=v||m?"\0\b":"\0\0",S+=n.compressionMethod,S+=y(u,2),S+=y(a,2),S+=y(n.crc32,4),S+=y(n.compressedSize,4),S+=y(n.uncompressedSize,4),S+=y(h.length,2),S+=y(b.length,2);var x=s.LOCAL_FILE_HEADER+S+h+b,T=s.CENTRAL_FILE_HEADER+"\0"+S+y(d.length,2)+"\0\0\0\0"+(f===!0?"\0\0\0":"\0\0\0\0")+y(o,4)+h+b+d;return{fileRecord:x,dirRecord:T,compressedObject:n}},C={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,n,r,i,s=[];for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],i=new g(r.name,r._data,b(r.options)),n=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(n,i)&&s.push(i));return s},file:function(e,t,n){if(1===arguments.length){if(r.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}return this.filter(function(t,n){return!n.dir&&t===e})[0]||null}return e=this.root+e,E.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(r.isRegExp(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=x.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){e=b(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),r.checkSupport(e.type);var t,n,i=[],o=0,f=0,l=r.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var c in this.files)if(this.files.hasOwnProperty(c)){var d=this.files[c],v=d.options.compression||e.compression.toUpperCase(),m=a[v];if(!m)throw new Error(v+" is not a valid compression method !");var g=T.call(this,d,m),w=N.call(this,c,d,g,o);o+=w.fileRecord.length+g.compressedSize,f+=w.dirRecord.length,i.push(w)}var E="";E=s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+y(i.length,2)+y(i.length,2)+y(f,4)+y(o,4)+y(l.length,2)+l;var S=e.type.toLowerCase();for(t="uint8array"===S||"arraybuffer"===S||"blob"===S||"nodebuffer"===S?new p(o+f+E.length):new h(o+f+E.length),n=0;n<i.length;n++)t.append(i[n].fileRecord),t.append(i[n].compressedObject.compressedContent);for(n=0;n<i.length;n++)t.append(i[n].dirRecord);t.append(E);var x=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return r.transformTo(e.type.toLowerCase(),x);case"blob":return r.arrayBuffer2Blob(r.transformTo("arraybuffer",x));case"base64":return e.base64?u.encode(x):x;default:return x}},crc32:function(e,t){return i(e,t)},utf8encode:function(e){return r.transformTo("string",c.utf8encode(e))},utf8decode:function(e){return c.utf8decode(e)}};t.exports=C},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t){function n(e,t){this.data=e,t||(this.data=i.string2binary(this.data)),this.length=this.data.length,this.index=0}var r=e("./dataReader"),i=e("./utils");n.prototype=new r,n.prototype.byteAt=function(e){return this.data.charCodeAt(e)},n.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=n},{"./dataReader":5,"./utils":21}],16:[function(e,t){var n=e("./utils"),r=function(){this.data=[]};r.prototype={append:function(e){e=n.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=r},{"./utils":21}],17:[function(e,t,n){(function(e){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof e,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=0===(new Blob([t],{type:"application/zip"})).size}catch(r){try{var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,s=new i;s.append(t),n.blob=0===s.getBlob("application/zip").size}catch(r){n.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,t){function n(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var r=e("./dataReader");n.prototype=new r,n.prototype.byteAt=function(e){return this.data[e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===r&&this.data[s+3]===i)return s;return-1},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=n},{"./dataReader":5}],19:[function(e,t){var n=e("./utils"),r=function(e){this.data=new Uint8Array(e),this.index=0};r.prototype={append:function(e){0!==e.length&&(e=n.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=r},{"./utils":21}],20:[function(e,t,n){for(var r=e("./utils"),i=e("./support"),s=e("./nodeBuffer"),o=new Array(256),u=0;256>u;u++)o[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;o[254]=o[254]=1;var a=function(e){var t,n,r,s,o,u=e.length,a=0;for(s=0;u>s;s++)n=e.charCodeAt(s),55296===(64512&n)&&u>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),a+=128>n?1:2048>n?2:65536>n?3:4;for(t=i.uint8array?new Uint8Array(a):new Array(a),o=0,s=0;a>o;s++)n=e.charCodeAt(s),55296===(64512&n)&&u>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),128>n?t[o++]=n:2048>n?(t[o++]=192|n>>>6,t[o++]=128|63&n):65536>n?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},f=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+o[e[n]]>t?n:t},l=function(e){var t,n,i,s,u=e.length,a=new Array(2*u);for(n=0,t=0;u>t;)if(i=e[t++],128>i)a[n++]=i;else if(s=o[i],s>4)a[n++]=65533,t+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&u>t;)i=i<<6|63&e[t++],s--;s>1?a[n++]=65533:65536>i?a[n++]=i:(i-=65536,a[n++]=55296|i>>10&1023,a[n++]=56320|1023&i)}return a.length!==n&&(a.subarray?a=a.subarray(0,n):a.length=n),r.applyFromCharCode(a)};n.utf8encode=function(e){return i.nodebuffer?s(e,"utf-8"):a(e)},n.utf8decode=function(e){if(i.nodebuffer)return r.transformTo("nodebuffer",e).toString("utf-8");e=r.transformTo(i.uint8array?"uint8array":"array",e);for(var t=[],n=0,s=e.length,o=65536;s>n;){var u=f(e,Math.min(n+o,s));t.push(i.uint8array?l(e.subarray(n,u)):l(e.slice(n,u))),n=u}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,n){function r(e){return e}function i(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function s(e){var t=65536,r=[],i=e.length,s=n.getTypeOf(e),o=0,u=!0;try{switch(s){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,f(0))}}catch(a){u=!1}if(!u){for(var l="",h=0;h<e.length;h++)l+=String.fromCharCode(e[h]);return l}for(;i>o&&t>1;)try{r.push("array"===s||"nodebuffer"===s?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,i))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,i)))),o+=t}catch(a){t=Math.floor(t/2)}return r.join("")}function o(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}var u=e("./support"),a=e("./compressions"),f=e("./nodeBuffer");n.string2binary=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n));return t},n.arrayBuffer2Blob=function(e){n.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(t){try{var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new r;return i.append(e),i.getBlob("application/zip")}catch(t){throw new Error("Bug : can't construct the Blob.")}}},n.applyFromCharCode=s;var l={};l.string={string:r,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,f(e.length))}},l.array={string:s,array:r,arraybuffer:function(e){return(new Uint8Array(e)).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return f(e)}},l.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return f(new Uint8Array(e))}},l.uint8array={string:s,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:r,nodebuffer:function(e){return f(e)}},l.nodebuffer={string:s,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:r},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var r=n.getTypeOf(t),i=l[r][e](t);return i},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":u.nodebuffer&&f.test(e)?"nodebuffer":u.uint8array&&e instanceof Uint8Array?"uint8array":u.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){var t=u[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)t=e.charCodeAt(n),r+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return r},n.findCompression=function(e){for(var t in a)if(a.hasOwnProperty(t)&&a[t].magic===e)return a[t];return null},n.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){function n(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var r=e("./stringReader"),i=e("./nodeBufferReader"),s=e("./uint8ArrayReader"),o=e("./utils"),u=e("./signature"),a=e("./zipEntry"),f=e("./support"),l=e("./object");n.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=l.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44,i=0;r>i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(u.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===u.CENTRAL_FILE_HEADER;)e=new a({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(u.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(u.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===e)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);this.reader="string"!==t||f.uint8array?"nodebuffer"===t?new i(e):new s(o.transformTo("uint8array",e)):new r(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=n},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){function n(e,t){this.options=e,this.loadOptions=t}var r=e("./stringReader"),i=e("./utils"),s=e("./compressedObject"),o=e("./object");n.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},prepareCompressedContent:function(e,t,n){return function(){var r=e.index;e.setIndex(t);var i=e.readData(n);return e.setIndex(r),i}},prepareContent:function(e,t,n,r,s){return function(){var e=i.transformTo(r.uncompressInputType,this.getCompressedContent()),t=r.uncompress(e);if(t.length!==s)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(n),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(t=i.findCompression(this.compressionMethod),null===t)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new s,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=i.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=16&this.externalFileAttributes?!0:!1},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),n=e.readInt(2),r=e.readString(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new r(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new r(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=n},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){var n=e("./lib/utils/common").assign,r=e("./lib/deflate"),i=e("./lib/inflate"),s=e("./lib/zlib/constants"),o={};n(o,r,i,s),t.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,n){function r(e,t){var n=new y(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function i(e,t){return t=t||{},t.raw=!0,r(e,t)}function s(e,t){return t=t||{},t.gzip=!0,r(e,t)}var o=e("./zlib/deflate.js"),u=e("./utils/common"),a=e("./utils/strings"),f=e("./zlib/messages"),l=e("./zlib/zstream"),c=0,h=4,p=0,d=1,v=-1,m=0,g=8,y=function(e){this.options=u.assign({level:v,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:m,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==p)throw new Error(f[n]);t.header&&o.deflateSetHeader(this.strm,t.header)};y.prototype.push=function(e,t){var n,r,i=this.strm,s=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:t===!0?h:c,i.input="string"==typeof e?a.string2buf(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new u.Buf8(s),i.next_out=0,i.avail_out=s),n=o.deflate(i,r),n!==d&&n!==p)return this.onEnd(n),this.ended=!0,!1;(0===i.avail_out||0===i.avail_in&&r===h)&&this.onData("string"===this.options.to?a.buf2binstring(u.shrinkBuf(i.output,i.next_out)):u.shrinkBuf(i.output,i.next_out))}while((i.avail_in>0||0===i.avail_out)&&n!==d);return r===h?(n=o.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===p):!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===p&&(this.result="string"===this.options.to?this.chunks.join(""):u.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=y,n.deflate=r,n.deflateRaw=i,n.gzip=s},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,n){function r(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function i(e,t){return t=t||{},t.raw=!0,r(e,t)}var s=e("./zlib/inflate.js"),o=e("./utils/common"),u=e("./utils/strings"),a=e("./zlib/constants"),f=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),h=function(e){this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=s.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(f[n]);this.header=new c,s.inflateGetHeader(this.strm,this.header)};h.prototype.push=function(e,t){var n,r,i,f,l,c=this.strm,h=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:t===!0?a.Z_FINISH:a.Z_NO_FLUSH,c.input="string"==typeof e?u.binstring2buf(e):e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new o.Buf8(h),c.next_out=0,c.avail_out=h),n=s.inflate(c,a.Z_NO_FLUSH),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;c.next_out&&(0===c.avail_out||n===a.Z_STREAM_END||0===c.avail_in&&r===a.Z_FINISH)&&("string"===this.options.to?(i=u.utf8border(c.output,c.next_out),f=c.next_out-i,l=u.buf2string(c.output,i),c.next_out=f,c.avail_out=h-f,f&&o.arraySet(c.output,c.output,i,f,0),this.onData(l)):this.onData(o.shrinkBuf(c.output,c.next_out)))}while(c.avail_in>0&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(r=a.Z_FINISH),r===a.Z_FINISH?(n=s.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):!0},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=h,n.inflate=r,n.inflateRaw=i,n.ungzip=r},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,n){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+r),i);for(var s=0;r>s;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,o;for(r=0,t=0,n=e.length;n>t;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;n>t;t++)s=e[t],o.set(s,i),i+=s.length;return o}},s={arraySet:function(e,t,n,r,i){for(var s=0;r>s;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],28:[function(e,t,n){function r(e,t){if(65537>t&&(e.subarray&&o||!e.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;t>r;r++)n+=String.fromCharCode(e[r]);return n}var i=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(u){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(u){o=!1}for(var a=new i.Buf8(256),f=0;256>f;f++)a[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;a[254]=a[254]=1,n.string2buf=function(e){var t,n,r,s,o,u=e.length,a=0;for(s=0;u>s;s++)n=e.charCodeAt(s),55296===(64512&n)&&u>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),a+=128>n?1:2048>n?2:65536>n?3:4;for(t=new i.Buf8(a),o=0,s=0;a>o;s++)n=e.charCodeAt(s),55296===(64512&n)&&u>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),128>n?t[o++]=n:2048>n?(t[o++]=192|n>>>6,t[o++]=128|63&n):65536>n?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},n.buf2binstring=function(e){return r(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;r>n;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,s,o,u=t||e.length,f=new Array(2*u);for(i=0,n=0;u>n;)if(s=e[n++],128>s)f[i++]=s;else if(o=a[s],o>4)f[i++]=65533,n+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&u>n;)s=s<<6|63&e[n++],o--;o>1?f[i++]=65533:65536>s?f[i++]=s:(s-=65536,f[i++]=55296|s>>10&1023,f[i++]=56320|1023&s)}return r(f,i)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+a[e[n]]>t?n:t}},{"./common":27}],29:[function(e,t){function n(e,t,n,r){for(var i=65535&e|0,s=e>>>16&65535|0,o=0;0!==n;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0}t.exports=n},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){function n(){for(var e,t=[],n=0;256>n;n++){e=n;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,r){var s=i,o=r+n;e=-1^e;for(var u=r;o>u;u++)e=e>>>8^s[255&(e^t[u])];return-1^e}var i=n();t.exports=r},{}],32:[function(e,t,n){function r(e,t){return e.msg=_[t],t}function i(e){return(e<<1)-(e>4?9:0)}function s(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(L.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function u(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function a(e,t){e.pending_buf[e.pending++]=t}function f(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function l(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,L.arraySet(t,e.input,e.next_in,i,n),1===e.state.wrap?e.adler=O(e.adler,t,i,n):2===e.state.wrap&&(e.adler=M(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function c(e,t){var n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,u=e.nice_match,a=e.strstart>e.w_size-ft?e.strstart-(e.w_size-ft):0,f=e.window,l=e.w_mask,c=e.prev,h=e.strstart+at,p=f[s+o-1],d=f[s+o];e.prev_length>=e.good_match&&(i>>=2),u>e.lookahead&&(u=e.lookahead);do if(n=t,f[n+o]===d&&f[n+o-1]===p&&f[n]===f[s]&&f[++n]===f[s+1]){s+=2,n++;do;while(f[++s]===f[++n]&&f[++s]===f[++n]&&f[++s]===f[++n]&&f[++s]===f[++n]&&f[++s]===f[++n]&&f[++s]===f[++n]&&f[++s]===f[++n]&&f[++s]===f[++n]&&h>s);if(r=at-(h-s),s=h-at,r>o){if(e.match_start=t,o=r,r>=u)break;p=f[s+o-1],d=f[s+o]}}while((t=c[t&l])>a&&0!==--i);return o<=e.lookahead?o:e.lookahead}function h(e){var t,n,r,i,s,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-ft)){L.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,n=e.hash_size,t=n;do r=e.head[--t],e.head[t]=r>=o?r-o:0;while(--n);n=o,t=n;do r=e.prev[--t],e.prev[t]=r>=o?r-o:0;while(--n);i+=o}if(0===e.strm.avail_in)break;if(n=l(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=ut)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+ut-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<ut)););}while(e.lookahead<ft&&0!==e.strm.avail_in)}function p(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(h(e),0===e.lookahead&&t===D)return yt;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,u(e,!1),0===e.strm.avail_out))return yt;if(e.strstart-e.block_start>=e.w_size-ft&&(u(e,!1),0===e.strm.avail_out))return yt}return e.insert=0,t===B?(u(e,!0),0===e.strm.avail_out?wt:Et):e.strstart>e.block_start&&(u(e,!1),0===e.strm.avail_out)?yt:yt}function d(e,t){for(var n,r;;){if(e.lookahead<ft){if(h(e),e.lookahead<ft&&t===D)return yt;if(0===e.lookahead)break}if(n=0,e.lookahead>=ut&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ut-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ft&&(e.match_length=c(e,n)),e.match_length>=ut)if(r=A._tr_tally(e,e.strstart-e.match_start,e.match_length-ut),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ut){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ut-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(u(e,!1),0===e.strm.avail_out))return yt}return e.insert=e.strstart<ut-1?e.strstart:ut-1,t===B?(u(e,!0),0===e.strm.avail_out?wt:Et):e.last_lit&&(u(e,!1),0===e.strm.avail_out)?yt:bt}function v(e,t){for(var n,r,i;;){if(e.lookahead<ft){if(h(e),e.lookahead<ft&&t===D)return yt;if(0===e.lookahead)break}if(n=0,e.lookahead>=ut&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ut-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ut-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ft&&(e.match_length=c(e,n),e.match_length<=5&&(e.strategy===W||e.match_length===ut&&e.strstart-e.match_start>4096)&&(e.match_length=ut-1)),e.prev_length>=ut&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-ut,r=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ut),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ut-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=ut-1,e.strstart++,r&&(u(e,!1),0===e.strm.avail_out))return yt}else if(e.match_available){if(r=A._tr_tally(e,0,e.window[e.strstart-1]),r&&u(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return yt}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ut-1?e.strstart:ut-1,t===B?(u(e,!0),0===e.strm.avail_out?wt:Et):e.last_lit&&(u(e,!1),0===e.strm.avail_out)?yt:bt}function m(e,t){for(var n,r,i,s,o=e.window;;){if(e.lookahead<=at){if(h(e),e.lookahead<=at&&t===D)return yt;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ut&&e.strstart>0&&(i=e.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=e.strstart+at;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&s>i);e.match_length=at-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ut?(n=A._tr_tally(e,1,e.match_length-ut),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(u(e,!1),0===e.strm.avail_out))return yt}return e.insert=0,t===B?(u(e,!0),0===e.strm.avail_out?wt:Et):e.last_lit&&(u(e,!1),0===e.strm.avail_out)?yt:bt}function g(e,t){for(var n;;){if(0===e.lookahead&&(h(e),0===e.lookahead)){if(t===D)return yt;break}if(e.match_length=0,n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(u(e,!1),0===e.strm.avail_out))return yt}return e.insert=0,t===B?(u(e,!0),0===e.strm.avail_out?wt:Et):e.last_lit&&(u(e,!1),0===e.strm.avail_out)?yt:bt}function y(e){e.window_size=2*e.w_size,s(e.head),e.max_lazy_match=k[e.level].max_lazy,e.good_match=k[e.level].good_length,e.nice_match=k[e.level].nice_length,e.max_chain_length=k[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ut-1,e.match_available=0,e.ins_h=0}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new L.Buf16(2*st),this.dyn_dtree=new L.Buf16(2*(2*rt+1)),this.bl_tree=new L.Buf16(2*(2*it+1)),s(this.dyn_ltree),s(this.dyn_dtree),s(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new L.Buf16(ot+1),this.heap=new L.Buf16(2*nt+1),s(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new L.Buf16(2*nt+1),s(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=K,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ct:mt,e.adler=2===t.wrap?0:1,t.last_flush=D,A._tr_init(t),F):r(e,q)}function E(e){var t=w(e);return t===F&&y(e.state),t}function S(e,t){return e&&e.state?2!==e.state.wrap?q:(e.state.gzhead=t,F):q}function x(e,t,n,i,s,o){if(!e)return q;var u=1;if(t===z&&(t=6),0>i?(u=0,i=-i):i>15&&(u=2,i-=16),1>s||s>G||n!==Q||8>i||i>15||0>t||t>9||0>o||o>$)return r(e,q);8===i&&(i=9);var a=new b;return e.state=a,a.strm=e,a.wrap=u,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+ut-1)/ut),a.window=new L.Buf8(2*a.w_size),a.head=new L.Buf16(a.hash_size),a.prev=new L.Buf16(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new L.Buf8(a.pending_buf_size),a.d_buf=a.lit_bufsize>>1,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=o,a.method=n,E(e)}function T(e,t){return x(e,t,Q,Y,Z,J)}function N(e,t){var n,u,l,c;if(!e||!e.state||t>j||0>t)return e?r(e,q):q;if(u=e.state,!e.output||!e.input&&0!==e.avail_in||u.status===gt&&t!==B)return r(e,0===e.avail_out?U:q);if(u.strm=e,n=u.last_flush,u.last_flush=t,u.status===ct)if(2===u.wrap)e.adler=0,a(u,31),a(u,139),a(u,8),u.gzhead?(a(u,(u.gzhead.text?1:0)+(u.gzhead.hcrc?2:0)+(u.gzhead.extra?4:0)+(u.gzhead.name?8:0)+(u.gzhead.comment?16:0)),a(u,255&u.gzhead.time),a(u,u.gzhead.time>>8&255),a(u,u.gzhead.time>>16&255),a(u,u.gzhead.time>>24&255),a(u,9===u.level?2:u.strategy>=X||u.level<2?4:0),a(u,255&u.gzhead.os),u.gzhead.extra&&u.gzhead.extra.length&&(a(u,255&u.gzhead.extra.length),a(u,u.gzhead.extra.length>>8&255)),u.gzhead.hcrc&&(e.adler=M(e.adler,u.pending_buf,u.pending,0)),u.gzindex=0,u.status=ht):(a(u,0),a(u,0),a(u,0),a(u,0),a(u,0),a(u,9===u.level?2:u.strategy>=X||u.level<2?4:0),a(u,St),u.status=mt);else{var h=Q+(u.w_bits-8<<4)<<8,p=-1;p=u.strategy>=X||u.level<2?0:u.level<6?1:6===u.level?2:3,h|=p<<6,0!==u.strstart&&(h|=lt),h+=31-h%31,u.status=mt,f(u,h),0!==u.strstart&&(f(u,e.adler>>>16),f(u,65535&e.adler)),e.adler=1}if(u.status===ht)if(u.gzhead.extra){for(l=u.pending;u.gzindex<(65535&u.gzhead.extra.length)&&(u.pending!==u.pending_buf_size||(u.gzhead.hcrc&&u.pending>l&&(e.adler=M(e.adler,u.pending_buf,u.pending-l,l)),o(e),l=u.pending,u.pending!==u.pending_buf_size));)a(u,255&u.gzhead.extra[u.gzindex]),u.gzindex++;u.gzhead.hcrc&&u.pending>l&&(e.adler=M(e.adler,u.pending_buf,u.pending-l,l)),u.gzindex===u.gzhead.extra.length&&(u.gzindex=0,u.status=pt)}else u.status=pt;if(u.status===pt)if(u.gzhead.name){l=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>l&&(e.adler=M(e.adler,u.pending_buf,u.pending-l,l)),o(e),l=u.pending,u.pending===u.pending_buf_size)){c=1;break}c=u.gzindex<u.gzhead.name.length?255&u.gzhead.name.charCodeAt(u.gzindex++):0,a(u,c)}while(0!==c);u.gzhead.hcrc&&u.pending>l&&(e.adler=M(e.adler,u.pending_buf,u.pending-l,l)),0===c&&(u.gzindex=0,u.status=dt)}else u.status=dt;if(u.status===dt)if(u.gzhead.comment){l=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>l&&(e.adler=M(e.adler,u.pending_buf,u.pending-l,l)),o(e),l=u.pending,u.pending===u.pending_buf_size)){c=1;break}c=u.gzindex<u.gzhead.comment.length?255&u.gzhead.comment.charCodeAt(u.gzindex++):0,a(u,c)}while(0!==c);u.gzhead.hcrc&&u.pending>l&&(e.adler=M(e.adler,u.pending_buf,u.pending-l,l)),0===c&&(u.status=vt)}else u.status=vt;if(u.status===vt&&(u.gzhead.hcrc?(u.pending+2>u.pending_buf_size&&o(e),u.pending+2<=u.pending_buf_size&&(a(u,255&e.adler),a(u,e.adler>>8&255),e.adler=0,u.status=mt)):u.status=mt),0!==u.pending){if(o(e),0===e.avail_out)return u.last_flush=-1,F}else if(0===e.avail_in&&i(t)<=i(n)&&t!==B)return r(e,U);if(u.status===gt&&0!==e.avail_in)return r(e,U);if(0!==e.avail_in||0!==u.lookahead||t!==D&&u.status!==gt){var d=u.strategy===X?g(u,t):u.strategy===V?m(u,t):k[u.level].func(u,t);if((d===wt||d===Et)&&(u.status=gt),d===yt||d===wt)return 0===e.avail_out&&(u.last_flush=-1),F;if(d===bt&&(t===P?A._tr_align(u):t!==j&&(A._tr_stored_block(u,0,0,!1),t===H&&(s(u.head),0===u.lookahead&&(u.strstart=0,u.block_start=0,u.insert=0))),o(e),0===e.avail_out))return u.last_flush=-1,F}return t!==B?F:u.wrap<=0?I:(2===u.wrap?(a(u,255&e.adler),a(u,e.adler>>8&255),a(u,e.adler>>16&255),a(u,e.adler>>24&255),a(u,255&e.total_in),a(u,e.total_in>>8&255),a(u,e.total_in>>16&255),a(u,e.total_in>>24&255)):(f(u,e.adler>>>16),f(u,65535&e.adler)),o(e),u.wrap>0&&(u.wrap=-u.wrap),0!==u.pending?F:I)}function C(e){var t;return e&&e.state?(t=e.state.status,t!==ct&&t!==ht&&t!==pt&&t!==dt&&t!==vt&&t!==mt&&t!==gt?r(e,q):(e.state=null,t===mt?r(e,R):F)):q}var k,L=e("../utils/common"),A=e("./trees"),O=e("./adler32"),M=e("./crc32"),_=e("./messages"),D=0,P=1,H=3,B=4,j=5,F=0,I=1,q=-2,R=-3,U=-5,z=-1,W=1,X=2,V=3,$=4,J=0,K=2,Q=8,G=9,Y=15,Z=8,et=29,tt=256,nt=tt+1+et,rt=30,it=19,st=2*nt+1,ot=15,ut=3,at=258,ft=at+ut+1,lt=32,ct=42,ht=69,pt=73,dt=91,vt=103,mt=113,gt=666,yt=1,bt=2,wt=3,Et=4,St=3,xt=function(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i};k=[new xt(0,0,0,0,p),new xt(4,4,8,4,d),new xt(4,5,16,8,d),new xt(4,6,32,32,d),new xt(4,4,16,16,v),new xt(8,16,32,32,v),new xt(8,16,128,128,v),new xt(8,32,128,256,v),new xt(32,128,258,1024,v),new xt(32,258,258,4096,v)],n.deflateInit=T,n.deflateInit2=x,n.deflateReset=E,n.deflateResetKeep=w,n.deflateSetHeader=S,n.deflate=N,n.deflateEnd=C,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},{}],34:[function(e,t){var n=30,r=12;t.exports=function(e,t){var i,s,o,u,a,f,l,h,p,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;i=e.state,s=e.next_in,A=e.input,o=s+(e.avail_in-5),u=e.next_out,O=e.output,a=u-(t-e.avail_out),f=u+(e.avail_out-257),l=i.dmax,h=i.wsize,p=i.whave,v=i.wnext,m=i.window,g=i.hold,y=i.bits,b=i.lencode,w=i.distcode,E=(1<<i.lenbits)-1,S=(1<<i.distbits)-1;e:do{15>y&&(g+=A[s++]<<y,y+=8,g+=A[s++]<<y,y+=8),x=b[g&E];t:for(;;){if(T=x>>>24,g>>>=T,y-=T,T=x>>>16&255,0===T)O[u++]=65535&x;else{if(!(16&T)){if(0===(64&T)){x=b[(65535&x)+(g&(1<<T)-1)];continue t}if(32&T){i.mode=r;break e}e.msg="invalid literal/length code",i.mode=n;break e}N=65535&x,T&=15,T&&(T>y&&(g+=A[s++]<<y,y+=8),N+=g&(1<<T)-1,g>>>=T,y-=T),15>y&&(g+=A[s++]<<y,y+=8,g+=A[s++]<<y,y+=8),x=w[g&S];n:for(;;){if(T=x>>>24,g>>>=T,y-=T,T=x>>>16&255,!(16&T)){if(0===(64&T)){x=w[(65535&x)+(g&(1<<T)-1)];continue n}e.msg="invalid distance code",i.mode=n;break e}if(C=65535&x,T&=15,T>y&&(g+=A[s++]<<y,y+=8,T>y&&(g+=A[s++]<<y,y+=8)),C+=g&(1<<T)-1,C>l){e.msg="invalid distance too far back",i.mode=n;break e}if(g>>>=T,y-=T,T=u-a,C>T){if(T=C-T,T>p&&i.sane){e.msg="invalid distance too far back",i.mode=n;break e}if(k=0,L=m,0===v){if(k+=h-T,N>T){N-=T;do O[u++]=m[k++];while(--T);k=u-C,L=O}}else if(T>v){if(k+=h+v-T,T-=v,N>T){N-=T;do O[u++]=m[k++];while(--T);if(k=0,N>v){T=v,N-=T;do O[u++]=m[k++];while(--T);k=u-C,L=O}}}else if(k+=v-T,N>T){N-=T;do O[u++]=m[k++];while(--T);k=u-C,L=O}for(;N>2;)O[u++]=L[k++],O[u++]=L[k++],O[u++]=L[k++],N-=3;N&&(O[u++]=L[k++],N>1&&(O[u++]=L[k++]))}else{k=u-C;do O[u++]=O[k++],O[u++]=O[k++],O[u++]=O[k++],N-=3;while(N>2);N&&(O[u++]=O[k++],N>1&&(O[u++]=O[k++]))}break}}break}}while(o>s&&f>u);N=y>>3,s-=N,y-=N<<3,g&=(1<<y)-1,e.next_in=s,e.next_out=u,e.avail_in=o>s?5+(o-s):5-(s-o),e.avail_out=f>u?257+(f-u):257-(u-f),i.hold=g,i.bits=y}},{}],35:[function(e,t,n){function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new g.Buf16(320),this.work=new g.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=B,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new g.Buf32(dt),t.distcode=t.distdyn=new g.Buf32(vt),t.sane=1,t.back=-1,L):M}function o(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,s(e)):M}function u(e,t){var n,r;return e&&e.state?(r=e.state,0>t?(n=0,t=-t):(n=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?M:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,o(e))):M}function a(e,t){var n,r;return e?(r=new i,e.state=r,r.window=null,n=u(e,t),n!==L&&(e.state=null),n):M}function f(e){return a(e,gt)}function l(e){if(yt){var t;for(v=new g.Buf32(512),m=new g.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(E(x,e.lens,0,288,v,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;E(T,e.lens,0,32,m,0,e.work,{bits:5}),yt=!1}e.lencode=v,e.lenbits=9,e.distcode=m,e.distbits=5}function c(e,t,n,r){var i,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new g.Buf8(s.wsize)),r>=s.wsize?(g.arraySet(s.window,t,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),g.arraySet(s.window,t,n-r,i,s.wnext),r-=i,r?(g.arraySet(s.window,t,n-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function h(e,t){var n,i,s,o,u,a,f,h,p,d,v,m,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct=0,kt=new g.Buf8(4),Lt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return M;n=e.state,n.mode===$&&(n.mode=J),u=e.next_out,s=e.output,f=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,h=n.hold,p=n.bits,d=a,v=f,xt=L;e:for(;;)switch(n.mode){case B:if(0===n.wrap){n.mode=J;break}for(;16>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(2&n.wrap&&35615===h){n.check=0,kt[0]=255&h,kt[1]=h>>>8&255,n.check=b(n.check,kt,2,0),h=0,p=0,n.mode=j;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=ct;break}if((15&h)!==H){e.msg="unknown compression method",n.mode=ct;break}if(h>>>=4,p-=4,St=(15&h)+8,0===n.wbits)n.wbits=St;else if(St>n.wbits){e.msg="invalid window size",n.mode=ct;break}n.dmax=1<<St,e.adler=n.check=1,n.mode=512&h?X:$,h=0,p=0;break;case j:for(;16>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(n.flags=h,(255&n.flags)!==H){e.msg="unknown compression method",n.mode=ct;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=ct;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=b(n.check,kt,2,0)),h=0,p=0,n.mode=F;case F:for(;32>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}n.head&&(n.head.time=h),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,kt[2]=h>>>16&255,kt[3]=h>>>24&255,n.check=b(n.check,kt,4,0)),h=0,p=0,n.mode=I;case I:for(;16>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=b(n.check,kt,2,0)),h=0,p=0,n.mode=q;case q:if(1024&n.flags){for(;16>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=b(n.check,kt,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=R;case R:if(1024&n.flags&&(m=n.length,m>a&&(m=a),m&&(n.head&&(St=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),g.arraySet(n.head.extra,i,o,m,St)),512&n.flags&&(n.check=b(n.check,i,m,o)),a-=m,o+=m,n.length-=m),n.length))break e;n.length=0,n.mode=U;case U:if(2048&n.flags){if(0===a)break e;m=0;do St=i[o+m++],n.head&&St&&n.length<65536&&(n.head.name+=String.fromCharCode(St));while(St&&a>m);if(512&n.flags&&(n.check=b(n.check,i,m,o)),a-=m,o+=m,St)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=z;case z:if(4096&n.flags){if(0===a)break e;m=0;do St=i[o+m++],n.head&&St&&n.length<65536&&(n.head.comment+=String.fromCharCode(St));while(St&&a>m);if(512&n.flags&&(n.check=b(n.check,i,m,o)),a-=m,o+=m,St)break e}else n.head&&(n.head.comment=null);n.mode=W;case W:if(512&n.flags){for(;16>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ct;break}h=0,p=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=$;break;case X:for(;32>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}e.adler=n.check=r(h),h=0,p=0,n.mode=V;case V:if(0===n.havedict)return e.next_out=u,e.avail_out=f,e.next_in=o,e.avail_in=a,n.hold=h,n.bits=p,O;e.adler=n.check=1,n.mode=$;case $:if(t===C||t===k)break e;case J:if(n.last){h>>>=7&p,p-=7&p,n.mode=at;break}for(;3>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=K;break;case 1:if(l(n),n.mode=tt,t===k){h>>>=2,p-=2;break e}break;case 2:n.mode=Y;break;case 3:e.msg="invalid block type",n.mode=ct}h>>>=2,p-=2;break;case K:for(h>>>=7&p,p-=7&p;32>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if((65535&h)!==(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ct;break}if(n.length=65535&h,h=0,p=0,n.mode=Q,t===k)break e;case Q:n.mode=G;case G:if(m=n.length){if(m>a&&(m=a),m>f&&(m=f),0===m)break e;g.arraySet(s,i,o,m,u),a-=m,o+=m,f-=m,u+=m,n.length-=m;break}n.mode=$;break;case Y:for(;14>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(n.nlen=(31&h)+257,h>>>=5,p-=5,n.ndist=(31&h)+1,h>>>=5,p-=5,n.ncode=(15&h)+4,h>>>=4,p-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ct;break}n.have=0,n.mode=Z;case Z:for(;n.have<n.ncode;){for(;3>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}n.lens[Lt[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[Lt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Tt={bits:n.lenbits},xt=E(S,n.lens,0,19,n.lencode,0,n.work,Tt),n.lenbits=Tt.bits,xt){e.msg="invalid code lengths set",n.mode=ct;break}n.have=0,n.mode=et;case et:for(;n.have<n.nlen+n.ndist;){for(;Ct=n.lencode[h&(1<<n.lenbits)-1],mt=Ct>>>24,gt=Ct>>>16&255,yt=65535&Ct,!(p>=mt);){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(16>yt)h>>>=mt,p-=mt,n.lens[n.have++]=yt;else{if(16===yt){for(Nt=mt+2;Nt>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(h>>>=mt,p-=mt,0===n.have){e.msg="invalid bit length repeat",n.mode=ct;break}St=n.lens[n.have-1],m=3+(3&h),h>>>=2,p-=2}else if(17===yt){for(Nt=mt+3;Nt>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}h>>>=mt,p-=mt,St=0,m=3+(7&h),h>>>=3,p-=3}else{for(Nt=mt+7;Nt>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}h>>>=mt,p-=mt,St=0,m=11+(127&h),h>>>=7,p-=7}if(n.have+m>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ct;break}for(;m--;)n.lens[n.have++]=St}}if(n.mode===ct)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=ct;break}if(n.lenbits=9,Tt={bits:n.lenbits},xt=E(x,n.lens,0,n.nlen,n.lencode,0,n.work,Tt),n.lenbits=Tt.bits,xt){e.msg="invalid literal/lengths set",n.mode=ct;break}if(n.distbits=6,n.distcode=n.distdyn,Tt={bits:n.distbits},xt=E(T,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Tt),n.distbits=Tt.bits,xt){e.msg="invalid distances set",n.mode=ct;break}if(n.mode=tt,t===k)break e;case tt:n.mode=nt;case nt:if(a>=6&&f>=258){e.next_out=u,e.avail_out=f,e.next_in=o,e.avail_in=a,n.hold=h,n.bits=p,w(e,v),u=e.next_out,s=e.output,f=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,h=n.hold,p=n.bits,n.mode===$&&(n.back=-1);break}for(n.back=0;Ct=n.lencode[h&(1<<n.lenbits)-1],mt=Ct>>>24,gt=Ct>>>16&255,yt=65535&Ct,!(p>=mt);){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(gt&&0===(240&gt)){for(bt=mt,wt=gt,Et=yt;Ct=n.lencode[Et+((h&(1<<bt+wt)-1)>>bt)],mt=Ct>>>24,gt=Ct>>>16&255,yt=65535&Ct,!(p>=bt+mt);){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}h>>>=bt,p-=bt,n.back+=bt}if(h>>>=mt,p-=mt,n.back+=mt,n.length=yt,0===gt){n.mode=ut;break}if(32&gt){n.back=-1,n.mode=$;break}if(64&gt){e.msg="invalid literal/length code",n.mode=ct;break}n.extra=15&gt,n.mode=rt;case rt:if(n.extra){for(Nt=n.extra;Nt>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=it;case it:for(;Ct=n.distcode[h&(1<<n.distbits)-1],mt=Ct>>>24,gt=Ct>>>16&255,yt=65535&Ct,!(p>=mt);){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(0===(240&gt)){for(bt=mt,wt=gt,Et=yt;Ct=n.distcode[Et+((h&(1<<bt+wt)-1)>>bt)],mt=Ct>>>24,gt=Ct>>>16&255,yt=65535&Ct,!(p>=bt+mt);){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}h>>>=bt,p-=bt,n.back+=bt}if(h>>>=mt,p-=mt,n.back+=mt,64&gt){e.msg="invalid distance code",n.mode=ct;break}n.offset=yt,n.extra=15&gt,n.mode=st;case st:if(n.extra){for(Nt=n.extra;Nt>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ct;break}n.mode=ot;case ot:if(0===f)break e;if(m=v-f,n.offset>m){if(m=n.offset-m,m>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ct;break}m>n.wnext?(m-=n.wnext,dt=n.wsize-m):dt=n.wnext-m,m>n.length&&(m=n.length),vt=n.window}else vt=s,dt=u-n.offset,m=n.length;m>f&&(m=f),f-=m,n.length-=m;do s[u++]=vt[dt++];while(--m);0===n.length&&(n.mode=nt);break;case ut:if(0===f)break e;s[u++]=n.length,f--,n.mode=nt;break;case at:if(n.wrap){for(;32>p;){if(0===a)break e;a--,h|=i[o++]<<p,p+=8}if(v-=f,e.total_out+=v,n.total+=v,v&&(e.adler=n.check=n.flags?b(n.check,s,v,u-v):y(n.check,s,v,u-v)),v=f,(n.flags?h:r(h))!==n.check){e.msg="incorrect data check",n.mode=ct;break}h=0,p=0}n.mode=ft;case ft:if(n.wrap&&n.flags){for(;32>p;){if(0===a)break e;a--,h+=i[o++]<<p,p+=8}if(h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ct;break}h=0,p=0}n.mode=lt;case lt:xt=A;break e;case ct:xt=_;break e;case ht:return D;case pt:default:return M}return e.next_out=u,e.avail_out=f,e.next_in=o,e.avail_in=a,n.hold=h,n.bits=p,(n.wsize||v!==e.avail_out&&n.mode<ct&&(n.mode<at||t!==N))&&c(e,e.output,e.next_out,v-e.avail_out)?(n.mode=ht,D):(d-=e.avail_in,v-=e.avail_out,e.total_in+=d,e.total_out+=v,n.total+=v,n.wrap&&v&&(e.adler=n.check=n.flags?b(n.check,s,v,e.next_out-v):y(n.check,s,v,e.next_out-v)),e.data_type=n.bits+(n.last?64:0)+(n.mode===$?128:0)+(n.mode===tt||n.mode===Q?256:0),(0===d&&0===v||t===N)&&xt===L&&(xt=P),xt)}function p(e){if(!e||!e.state)return M;var t=e.state;return t.window&&(t.window=null),e.state=null,L}function d(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?M:(n.head=t,t.done=!1,L)):M}var v,m,g=e("../utils/common"),y=e("./adler32"),b=e("./crc32"),w=e("./inffast"),E=e("./inftrees"),S=0,x=1,T=2,N=4,C=5,k=6,L=0,A=1,O=2,M=-2,_=-3,D=-4,P=-5,H=8,B=1,j=2,F=3,I=4,q=5,R=6,U=7,z=8,W=9,X=10,V=11,$=12,J=13,K=14,Q=15,G=16,Y=17,Z=18,et=19,tt=20,nt=21,rt=22,it=23,st=24,ot=25,ut=26,at=27,ft=28,lt=29,ct=30,ht=31,pt=32,dt=852,vt=592,mt=15,gt=mt,yt=!0;n.inflateReset=o,n.inflateReset2=u,n.inflateResetKeep=s,n.inflateInit=f,n.inflateInit2=a,n.inflate=h,n.inflateEnd=p,n.inflateGetHeader=d,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){var n=e("../utils/common"),r=15,i=852,s=592,o=0,u=1,a=2,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,p,v,y,b,w,E){var S,x,T,N,C,L,A,O,M,_=E.bits,D=0,P=0,H=0,B=0,F=0,I=0,q=0,R=0,U=0,z=0,W=null,X=0,V=new n.Buf16(r+1),$=new n.Buf16(r+1),J=null,K=0;for(D=0;r>=D;D++)V[D]=0;for(P=0;v>P;P++)V[t[p+P]]++;for(F=_,B=r;B>=1&&0===V[B];B--);if(F>B&&(F=B),0===B)return y[b++]=20971520,y[b++]=20971520,E.bits=1,0;for(H=1;B>H&&0===V[H];H++);for(H>F&&(F=H),R=1,D=1;r>=D;D++)if(R<<=1,R-=V[D],0>R)return-1;if(R>0&&(e===o||1!==B))return-1;for($[1]=0,D=1;r>D;D++)$[D+1]=$[D]+V[D];for(P=0;v>P;P++)0!==t[p+P]&&(w[$[t[p+P]]++]=P);if(e===o?(W=J=w,L=19):e===u?(W=f,X-=257,J=l,K-=257,L=256):(W=c,J=h,L=-1),z=0,P=0,D=H,C=b,I=F,q=0,T=-1,U=1<<F,N=U-1,e===u&&U>i||e===a&&U>s)return 1;for(var Q=0;;){Q++,A=D-q,w[P]<L?(O=0,M=w[P]):w[P]>L?(O=J[K+w[P]],M=W[X+w[P]]):(O=96,M=0),S=1<<D-q,x=1<<I,H=x;do x-=S,y[C+(z>>q)+x]=A<<24|O<<16|M|0;while(0!==x);for(S=1<<D-1;z&S;)S>>=1;if(0!==S?(z&=S-1,z+=S):z=0,P++,0===--V[D]){if(D===B)break;D=t[p+w[P]]}if(D>F&&(z&N)!==T){for(0===q&&(q=F),C+=H,I=D-q,R=1<<I;B>I+q&&(R-=V[I+q],!(0>=R));)I++,R<<=1;if(U+=1<<I,e===u&&U>i||e===a&&U>s)return 1;T=z&N,y[T]=F<<24|I<<16|C-b|0}}return 0!==z&&(y[C+z]=D-q<<24|64<<16|0),E.bits=F,0}},{"../utils/common":27}],37:[function(e,t){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,n){function r(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?ot[e]:ot[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function o(e,t,n){e.bi_valid>$-n?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>$-e.bi_valid,e.bi_valid+=n-$):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function u(e,t,n){o(e,n[2*t],n[2*t+1])}function a(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function f(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function l(e,t){var n,r,i,s,o,u,a=t.dyn_tree,f=t.max_code,l=t.stat_desc.static_tree,c=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,d=t.stat_desc.max_length,v=0;for(s=0;V>=s;s++)e.bl_count[s]=0;for(a[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;X>n;n++)r=e.heap[n],s=a[2*a[2*r+1]+1]+1,s>d&&(s=d,v++),a[2*r+1]=s,r>f||(e.bl_count[s]++,o=0,r>=p&&(o=h[r-p]),u=a[2*r],e.opt_len+=u*(s+o),c&&(e.static_len+=u*(l[2*r+1]+o)));if(0!==v){do{for(s=d-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[d]--,v-=2}while(v>0);for(s=d;0!==s;s--)for(r=e.bl_count[s];0!==r;)i=e.heap[--n],i>f||(a[2*i+1]!==s&&(e.opt_len+=(s-a[2*i+1])*a[2*i],a[2*i+1]=s),r--)}}function c(e,t,n){var r,i,s=new Array(V+1),o=0;for(r=1;V>=r;r++)s[r]=o=o+n[r-1]<<1;for(i=0;t>=i;i++){var u=e[2*i+1];0!==u&&(e[2*i]=a(s[u]++,u))}}function h(){var e,t,n,r,i,s=new Array(V+1);for(n=0,r=0;q-1>r;r++)for(at[r]=n,e=0;e<1<<Z[r];e++)ut[n++]=r;for(ut[n-1]=r,i=0,r=0;16>r;r++)for(ft[r]=i,e=0;e<1<<et[r];e++)ot[i++]=r;for(i>>=7;z>r;r++)for(ft[r]=i<<7,e=0;e<1<<et[r]-7;e++)ot[256+i++]=r;for(t=0;V>=t;t++)s[t]=0;for(e=0;143>=e;)it[2*e+1]=8,e++,s[8]++;for(;255>=e;)it[2*e+1]=9,e++,s[9]++;for(;279>=e;)it[2*e+1]=7,e++,s[7]++;for(;287>=e;)it[2*e+1]=8,e++,s[8]++;for(c(it,U+1,s),e=0;z>e;e++)st[2*e+1]=5,st[2*e]=a(e,5);lt=new pt(it,Z,R+1,U,V),ct=new pt(st,et,0,z,V),ht=new pt(new Array(0),tt,0,W,J)}function p(e){var t;for(t=0;U>t;t++)e.dyn_ltree[2*t]=0;for(t=0;z>t;t++)e.dyn_dtree[2*t]=0;for(t=0;W>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*K]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function d(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function v(e,t,n,r){d(e),r&&(s(e,n),s(e,~n)),O.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function m(e,t,n,r){var i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]}function g(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&m(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!m(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function y(e,t,n){var r,s,a,f,l=0;if(0!==e.last_lit)do r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],s=e.pending_buf[e.l_buf+l],l++,0===r?u(e,s,t):(a=ut[s],u(e,a+R+1,t),f=Z[a],0!==f&&(s-=at[a],o(e,s,f)),r--,a=i(r),u(e,a,n),f=et[a],0!==f&&(r-=ft[a],o(e,r,f)));while(l<e.last_lit);u(e,K,t)}function b(e,t){var n,r,i,s=t.dyn_tree,o=t.stat_desc.static_tree,u=t.stat_desc.has_stree,a=t.stat_desc.elems,f=-1;for(e.heap_len=0,e.heap_max=X,n=0;a>n;n++)0!==s[2*n]?(e.heap[++e.heap_len]=f=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>f?++f:0,s[2*i]=1,e.depth[i]=0,e.opt_len--,u&&(e.static_len-=o[2*i+1]);for(t.max_code=f,n=e.heap_len>>1;n>=1;n--)g(e,s,n);i=a;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],g(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,s[2*i]=s[2*n]+s[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,s[2*n+1]=s[2*r+1]=i,e.heap[1]=i++,g(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],l(e,t),c(s,f,e.bl_count)}function w(e,t,n){var r,i,s=-1,o=t[1],u=0,a=7,f=4;for(0===o&&(a=138,f=3),t[2*(n+1)+1]=65535,r=0;n>=r;r++)i=o,o=t[2*(r+1)+1],++u<a&&i===o||(f>u?e.bl_tree[2*i]+=u:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*Q]++):10>=u?e.bl_tree[2*G]++:e.bl_tree[2*Y]++,u=0,s=i,0===o?(a=138,f=3):i===o?(a=6,f=3):(a=7,f=4))}function E(e,t,n){var r,i,s=-1,a=t[1],f=0,l=7,c=4;for(0===a&&(l=138,c=3),r=0;n>=r;r++)if(i=a,a=t[2*(r+1)+1],!(++f<l&&i===a)){if(c>f){do u(e,i,e.bl_tree);while(0!==--f)}else 0!==i?(i!==s&&(u(e,i,e.bl_tree),f--),u(e,Q,e.bl_tree),o(e,f-3,2)):10>=f?(u(e,G,e.bl_tree),o(e,f-3,3)):(u(e,Y,e.bl_tree),o(e,f-11,7));f=0,s=i,0===a?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4)}}function S(e){var t;for(w(e,e.dyn_ltree,e.l_desc.max_code),w(e,e.dyn_dtree,e.d_desc.max_code),b(e,e.bl_desc),t=W-1;t>=3&&0===e.bl_tree[2*nt[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function x(e,t,n,r){var i;for(o(e,t-257,5),o(e,n-1,5),o(e,r-4,4),i=0;r>i;i++)o(e,e.bl_tree[2*nt[i]+1],3);E(e,e.dyn_ltree,t-1),E(e,e.dyn_dtree,n-1)}function T(e){var t,n=4093624447;for(t=0;31>=t;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return _;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return D;for(t=32;R>t;t++)if(0!==e.dyn_ltree[2*t])return D;return _}function N(e){vt||(h(),vt=!0),e.l_desc=new dt(e.dyn_ltree,lt),e.d_desc=new dt(e.dyn_dtree,ct),e.bl_desc=new dt(e.bl_tree,ht),e.bi_buf=0,e.bi_valid=0,p(e)}function C(e,t,n,r){o(e,(H<<1)+(r?1:0),3),v(e,t,n,!0)}function k(e){o(e,B<<1,3),u(e,K,it),f(e)}function L(e,t,n,r){var i,s,u=0;e.level>0?(e.strm.data_type===P&&(e.strm.data_type=T(e)),b(e,e.l_desc),b(e,e.d_desc),u=S(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,i>=s&&(i=s)):i=s=n+5,i>=n+4&&-1!==t?C(e,t,n,r):e.strategy===M||s===i?(o(e,(B<<1)+(r?1:0),3),y(e,it,st)):(o(e,(j<<1)+(r?1:0),3),x(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),y(e,e.dyn_ltree,e.dyn_dtree)),p(e),r&&d(e)}function A(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ut[n]+R+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1}var O=e("../utils/common"),M=4,_=0,D=1,P=2,H=0,B=1,j=2,F=3,I=258,q=29,R=256,U=R+1+q,z=30,W=19,X=2*U+1,V=15,$=16,J=7,K=256,Q=16,G=17,Y=18,Z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],et=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],nt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],rt=512,it=new Array(2*(U+2));r(it);var st=new Array(2*z);r(st);var ot=new Array(rt);r(ot);var ut=new Array(I-F+1);r(ut);var at=new Array(q);r(at);var ft=new Array(z);r(ft);var lt,ct,ht,pt=function(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length},dt=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},vt=!1;n._tr_init=N,n._tr_stored_block=C,n._tr_flush_block=L,n._tr_tally=A,n._tr_align=k},{"../utils/common":27}],39:[function(e,t){function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},{}]},{},[9])(9)});var saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if(typeof navigator!="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent))return;var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in r,s=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},o=e.webkitRequestFileSystem,u=e.requestFileSystem||o||e.mozRequestFileSystem,a=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},f="application/octet-stream",l=0,c=10,h=function(t){var r=function(){typeof t=="string"?n().revokeObjectURL(t):t.remove()};e.chrome?r():setTimeout(r,c)},p=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i=="function")try{i.call(e,n||e)}catch(s){a(s)}}},d=function(t,a){var c=this,d=t.type,v=!1,m,g,y=function(){p(c,"writestart progress write writeend".split(" "))},b=function(){if(v||!m)m=n().createObjectURL(t);if(g)g.location.href=m;else{var r=e.open(m,"_blank");r==undefined&&typeof safari!="undefined"&&(e.location.href=m)}c.readyState=c.DONE,y(),h(m)},w=function(e){return function(){if(c.readyState!==c.DONE)return e.apply(this,arguments)}},E={create:!0,exclusive:!1},S;c.readyState=c.INIT,a||(a="download");if(i){m=n().createObjectURL(t),r.href=m,r.download=a,s(r),c.readyState=c.DONE,y(),h(m);return}e.chrome&&d&&d!==f&&(S=t.slice||t.webkitSlice,t=S.call(t,0,t.size,f),v=!0),o&&a!=="download"&&(a+=".download");if(d===f||o)g=e;if(!u){b();return}l+=t.size,u(e.TEMPORARY,l,w(function(e){e.root.getDirectory("saved",E,w(function(e){var n=function(){e.getFile(a,E,w(function(e){e.createWriter(w(function(n){n.onwriteend=function(t){g.location.href=e.toURL(),c.readyState=c.DONE,p(c,"writeend",t),h(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&b()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=c["on"+e]}),n.write(t),c.abort=function(){n.abort(),c.readyState=c.DONE},c.readyState=c.WRITING}),b)}),b)};e.getFile(a,{create:!1},w(function(e){e.remove(),n()}),w(function(e){e.code===e.NOT_FOUND_ERR?n():b()}))}),b)}),b)},v=d.prototype,m=function(e,t){return new d(e,t)};return v.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,m}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module!==null?module.exports=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define("filesaver",[],function(){return saveAs}),define("file",["baseModel"],function(e){var t=e.extend({classname:"File",constructor:function(t,n){var r=[{name:t.name,isFile:t.isFile,isDirectory:t.isDirectory,size:t.Size||0,fullPath:t.fullPath,url:t.toURL(),selected:!1,type:null,size:0,modificationTime:null}];e.apply(this,r)}});return t.prototype.initialize=function(e,t){var n=this.get("name").split(".").pop();this.set({type:n})},t.prototype.updateFileData=function(e){var t=new Date(e.modificationTime);this.set({size:e.size,modificationTime:t.getTime()})},t}),define("files",["baseCollection","file"],function(e,t){var n=e.extend({classname:"Files",model:t});return n.prototype.comparator=function(e){return-e.get("modificationTime")},n}),define("fileView",["baseView"],function(e){var t=e.extend({tagName:"div",classname:"FileView",events:{dblclick:"open",click:"select","blur .file-name":"blur"}});return t.prototype.template=new EJS({url:"/file_system/ejs/file.ejs"}),t.prototype.initialize=function(e,t,n,r){this.app=r,this.fileSystem=n,this.files=t,this.file=e,this.listenTo(this.file,"change:selected",this.setSelected.bind(this)),this.listenTo(this.file,"change:name",this.rename.bind(this)),this.listenTo(this.file,"destroy",this.delete.bind(this)),this.listenToActionEvents(),this.render()},t.prototype.listenToActionEvents=function(){$('a[href="#delete-file"]').click(this.deleteFile.bind(this)),$('a[href="#load-data"]').click(this.loadData.bind(this))},t.prototype.render=function(){var e=this.file.toJSON();this.$el.html(this.template.render(e)),this.$file=this.$(".file"),this.$fileName=this.$(".file-name")[0]},t.prototype.deleteFile=function(){var e=this;if(!e.file.get("selected"))return;e.file.get("isFile")?e.fileSystem.get("fs").root.getFile(e.file.get("fullPath"),{},function(t){t.remove(function(){window.console.log("File removed."),e.file.destroy(),e.fileSystem.update()},e.errorHandler.bind(this))},e.errorHandler.bind(this)):e.fileSystem.get("fs").root.getDirectory(e.file.get("fullPath"),{},function(t){t.removeRecursively(function(){window.console.log("Directory removed."),e.file.destroy(),e.fileSystem.update()},e.errorHandler.bind(this))},e.errorHandler.bind(this))},t.prototype.select=function(){var e=this;this.files.each(function(t){t==e.file?t.set({selected:!t.get("selected")}):t.set({selected:!1})})},t.prototype.setSelected=function(){this.file.get("selected")?this.$file.addClass("active"):this.$file.removeClass("active")},t.prototype.blur=function(){this.file.set({name:this.$fileName.textContent})},t.prototype.rename=function(){var e=this;e.file.get("isFile")?e.fileSystem.get("fs").root.getFile(e.file.get("fullPath"),{},function(t){var n=e.file.get("fullPath").split("/");n.pop(),n=n.join("/"),n===""&&(n="/"),e.fileSystem.get("fs").root.getDirectory(n,{},function(n){t.moveTo(n,e.file.get("name")),e.file.destroy(),e.fileSystem.update()},e.errorHandler.bind(this))},e.errorHandler.bind(this)):e.fileSystem.get("fs").root.getDirectory(e.file.get("fullPath"),{},function(t){var n=e.file.get("fullPath").split("/");n.pop(),n=n.join("/"),n===""&&(n="/"),e.fileSystem.get("fs").root.getDirectory(n,{},function(n){t.moveTo(n,e.file.get("name")),e.file.destroy(),e.fileSystem.update()},e.errorHandler.bind(this))},e.errorHandler.bind(this))},t.prototype.open=function(){var e=this;e.file.get("isFile")||(this.fileSystem.set({path:this.file.get("fullPath")}),e.fileSystem.update())},t.prototype.errorHandler=function(e){window.console.log("Error: "+e.name+" "+e.message)},t.prototype.loadData=function(){var e=this;if(e.file.get("isDirectory")||!e.file.get("selected"))return;e.fileSystem.get("fs").root.getFile(e.file.get("fullPath"),{},function(t){t.file(function(t){var n=new FileReader;n.onloadend=function(){e.showCanvas(),e.app.loader.loadData(this.result)},n.readAsText(t)},e.errorHandler.bind(e))},e.errorHandler.bind(e))},t.prototype.showCanvas=function(){$("#canvas").removeClass("hide"),$("#file-system-panel").addClass("hide"),$("a[href='#file-system']").parent().removeClass("active")},t.prototype.delete=function(){this.$el.remove(),this.remove()},t}),define("filesView",["baseView","fileView","file"],function(e,t,n){var r=e.extend({classname:"FilesView",el:"#files-list",events:{}});return r.prototype.template=new EJS({url:"/file_system/ejs/files.ejs"}),r.prototype.initialize=function(e,t,n){this.app=n,this.fileSystem=t,this.files=e,this.listenTo(this.files,"add",this.render),this.listenTo(this.files,"remove",this.delFile),this.listenTo(this.files,"saving-event",this.savingEventTriggered),this.listenToActionEvents(),this.savingEventsList=[],this.render()},r.prototype.listenToActionEvents=function(){$('a[href="#create-file"]').unbind().click(this.createNewFile.bind(this)),$('a[href="#create-dir"]').unbind().click(this.createNewDir.bind(this)),$('a[href="#save-project"]').click(this.saveProject.bind(this)),$('a[href="#download-project').click(this.downloadProject.bind(this))},r.prototype.render=function(){this.$el.html(this.template.render()),this.$list=this.$(".list"),this.files.each(this.addFile.bind(this))},r.prototype.addFile=function(e){var n=new t(e,this.files,this.fileSystem,this.app);this.$list.append(n.el)},r.prototype.createNewFile=function(){var e=this;e.fileSystem.get("fs").root.getDirectory(e.fileSystem.get("path"),{},function(t){e.newFile(t,_.uniqueId("new-file-"))},e.errorHandler.bind(e))},r.prototype.newFile=function(e,t,n){var r=this;e.getFile(t,{create:!0,exclusive:!0},function(e){r.createFile(e,n)},r.errorHandler.bind(r))},r.prototype.createFile=function(e,t){var r=this.fileSystem.get("path");r==="/"?r=[""]:r=this.fileSystem.get("path").split("/"),r.push(e.name),r=r.join("/");if(r===e.fullPath){var i=new n(e);this.files.add(i),this.fileSystem.update()}t!==undefined&&t(e)},r.prototype.createNewDir=function(){var e=this;e.fileSystem.get("fs").root.getDirectory(e.fileSystem.get("path"),{},function(t){e.newDir(t,_.uniqueId("new-folder-"))},e.errorHandler.bind(e))},r.prototype.newDir=function(e,t,n){var r=this;e.getDirectory(t,{create:!0},function(e){r.createFile(e,n)},r.errorHandler.bind(r))},r.prototype.downloadProject=function(){var e=this;e.app.exporter.export();var t=e.getTimeStamp(),n=this.app.type+"-"+t;e.fileSystem.get("fs").root.getDirectory(e.fileSystem.get("path"),{},function(r){e.newDir(r,n,function(n){var r=e.app.type+"-data-"+t+".json",i=e.app.type+"-data-"+t+".txt",s=e.app.exporter.getJSON(),o=e.app.exporter.getText();e.app.exporter.saveAllImages?e.app.exporter.saveAllImages(function(t,r){e.readImageFromFileEntry(n,r)},function(){e.newFile(n,r,function(t){e.writeJSONToAFile(t,s),e.newFile(n,i,function(t){e.writeTextToAFile(t,o,n),e.fileSystem.update()})})}):e.newFile(n,r,function(t){e.writeJSONToAFile(t,s,n),e.newFile(n,i,function(t){e.writeTextToAFile(t,o),e.fileSystem.update()})})})},e.errorHandler.bind(e))},r.prototype.saveProject=function(){var e=this,t=e.getTimeStamp(),n=this.app.type+"-"+t;e.fileSystem.get("fs").root.getDirectory(e.fileSystem.get("path"),{},function(r){e.newDir(r,n,function(n){var r=e.app.type+"-data-"+t+".json",i=e.app.type+"-data-"+t+".txt",s=e.app.exporter.getJSON(),o=e.app.exporter.getText();e.app.exporter.saveAllImages?e.app.exporter.saveAllImages(function(t,r){e.readImageFromFileEntry(n,r)},function(){e.newFile(n,r,function(t){e.writeJSONToAFile(t,s),e.newFile(n,i,function(t){e.writeTextToAFile(t,o),e.fileSystem.update()})})}):e.newFile(n,r,function(t){e.writeJSONToAFile(t,s),e.newFile(n,i,function(t){e.writeTextToAFile(t,o),e.fileSystem.update()})})})},e.errorHandler.bind(e))},r.prototype.readImageFromFileEntry=function(e,t){var n=this;t.file(function(r){var i=new FileReader,s=t.name.split(".").pop(-1);i.onload=function(r){var i={name:t.name,type:s},o=new Image;$(o).load(function(){n.checkAndWrite(null,e,i,n.base64ToBinary(r.target.result))}),o.src=r.target.result},i.readAsDataURL(r)},n.errorHandler.bind(n))},r.prototype.writeJSONToAFile=function(e,t,n){if(e.isDirectory)return;var r=this;r.fileSystem.get("fs").root.getFile(e.fullPath,{create:!0},function(e){e.createWriter(function(e){e.onwriteend=function(){window.console.log("Write completed."),r.files.trigger("saving-event","json-file-generated",n)},e.onerror=function(e){window.console.log("Write failed: "+e.toString())};var i=new Blob([t],{type:"application/json"});e.write(i)},r.errorHandler.bind(this))},r.errorHandler.bind(this))},r.prototype.writeTextToAFile=function(e,t,n){if(e.isDirectory)return;var r=this;r.fileSystem.get("fs").root.getFile(e.fullPath,{create:!0},function(e){e.createWriter(function(e){e.onwriteend=function(){window.console.log("Write completed."),r.files.trigger("saving-event","text-file-generated",n)},e.onerror=function(e){window.console.log("Write failed: "+e.toString())};var i=new Blob([t],{type:"text/plain"});e.write(i)},r.errorHandler.bind(this))},r.errorHandler.bind(this))},r.prototype.getTimeStamp=function(){var e=new Date,t=e.getUTCMonth()+"-"+e.getUTCDate()+"-";return t+=e.getUTCFullYear()+"-"+e.getHours()+"_",t+=e.getMinutes()+"_"+e.getSeconds(),t},r.prototype.errorHandler=function(e){window.console.log("Error: "+e.name+" "+e.message),this.fileSystem.trigger("error","Something went wrong while saving the project.")},r.prototype.delFile=function(){this.fileSystem.set({update:!this.fileSystem.get("update")})},r.prototype.saveFile=function(e,t){if(t.type==="image/png"||t.type==="image/jpg"||t.type==="image/jpeg"||t.type==="image/gif"){var n=new FileReader;n.onload=this.readImage.bind(this,e,t),n.readAsDataURL(t)}},r.prototype.readImage=function(e,t,n){var r=this,i=new Image;$(i).load(function(){r.saveToFileTypeDirectory(e,t,n.target.result)}),i.src=n.target.result},r.prototype.saveToFileTypeDirectory=function(e,t,n){var r=this;n=r.base64ToBinary(n);var i=this.app.type;r.fileSystem.get("fs").root.getDirectory("/"+i,{},function(i){r.checkAndWrite(e,i,t,n)},function(){r.fileSystem.get("fs").root.getDirectory("/",{},function(s){r.newDir(s,i,function(i){r.checkAndWrite(e,i,t,n)})})}),this.fileSystem.set({update:!this.fileSystem.get("update")})},r.prototype.checkAndWrite=function(e,t,n,r){var i=this,s=t.fullPath+"/"+n.name;i.fileSystem.get("fs").root.getFile(s,{},function(t){i.writeToFile(e,t,n,r)},function(){i.newFile(t,n.name,function(t){i.writeToFile(e,t,n,r)})})},r.prototype.writeToFile=function(e,t,n,r){if(t.isDirectory)return;var i=this;i.fileSystem.get("fs").root.getFile(t.fullPath,{create:!0},function(t){var s=t.fullPath;t.createWriter(function(i){i.onwriteend=function(n){window.console.log("Write Completed: "+n.toString()),e&&e.trigger("write-completed",t)},i.onerror=function(t){window.console.log("Write failed: "+t.toString()),e&&e.trigger("write-errored")};var s=new Blob([r],{type:n.type});i.write(s)},i.errorHandler.bind(this))},i.errorHandler.bind(this))},r.prototype.savingEventTriggered=function(e,t){_.indexOf(this.savingEventsList,e)===-1&&this.savingEventsList.push(e),_.difference(this.savingEventsList,["json-file-generated","text-file-generated"]).length===0&&(this.savingEventsList=[],this.fileSystem.trigger("Compress",t))},r}),define("fileSystem",["baseModel"],function(e){var t=e.extend({classname:"FileSystem",constructor:function(t,n){var r=[{fs:t.fs,path:"/",update:!1}];e.apply(this,r)}});return t.prototype.writeCompleted=function(e){this.trigger("write-completed",e)},t.prototype.writeErrored=function(e){this.trigger("write-errored",e)},t}),define("fileSystemView",["jszip","filesaver","baseView","file","files","filesView","fileSystem"],function(e,t,n,r,i,s,o){var u=n.extend({classname:"FileSystemView",el:"#file-system-panel",events:{"click a[href='#parent-dir']":"parentDir","click a[href='#compress-file']":"compress","click a.path-breadcrumb":"setDir"}});return u.prototype.template=new EJS({url:"/file_system/ejs/file_system_panel.ejs"}),u.prototype.initialize=function(e){this.app=e,this.$canvas=$("#canvas");var t=1073741824;navigator&&navigator.webkitPersistentStorage&&navigator.webkitPersistentStorage.requestQuota(t,this.requestFileSystem.bind(this),this.errorHandler.bind(this))},u.prototype.requestFileSystem=function(e){window.webkitRequestFileSystem(window.webkitStorageInfo.PERSISTENT,e,this.render.bind(this),this.errorHandler.bind(this))},u.prototype.updateQuota=function(){var e=this;window.webkitStorageInfo.queryUsageAndQuota(window.webkitStorageInfo.PERSISTENT,function(t,n){e.$quota.html("Used "+parseInt(t/1e5)/10+" mb of "+parseInt(n/1e5)/10+" mb.")},e.errorHandler.bind(e))},u.prototype.render=function(e){this.fileSystem=new o({fs:e}),this.renderDirs(),this.listenTo(this.fileSystem,"update",this.renderDirs.bind(this)),this.listenTo(this.fileSystem,"Compress",this.compressDirEntry),this.listenTo(this.fileSystem,"error",this.compressDirEntry)},u.prototype.renderDirs=function(){this.$el.html(this.template.render(this.fileSystem.toJSON())),this.$quota=this.$(".quota");var e=this,t=this.fileSystem.get("path");this.files=new i,this.filesView=new s(this.files,this.fileSystem,this.app),this.fileSystem.get("fs").root.getDirectory(t,{},function(t){if(t.isDirectory){var n=t.createReader();n.readEntries(e.readDir.bind(e))}},e.errorHandler),this.updateQuota()},u.prototype.compress=function(){var e=this,t=this.fileSystem.get("path");e.fileSystem.get("fs").root.getDirectory(t,{},function(t){t.isDirectory&&e.compressDirEntry(t)},e.errorHandler)},u.prototype.compressDirEntry=function(t){var n=new e,r=t.createReader();r.readEntries(this.compressDir.bind(this,t,n))},u.prototype.compressDir=function(e,t,n){var r=this,i=e.name;if(n===undefined||!n.length)return;var s=n.length;n.forEach(function(e){e.isFile&&e.file(function(e){var n=new FileReader;n.onload=function(e){return function(n){e.type.match("image*")?t.file(e.name,r.base64ToBinary(n.target.result)):(e.type.match("text*")||e.name.match(".*json$"))&&t.file(e.name,n.target.result)}}(e),n.onloadend=function(){s--,s===0&&r.compressionComplete(i,t)},e.type.match("image*")?n.readAsDataURL(e):(e.type.match("text*")||e.name.match(".*json$"))&&n.readAsText(e)})})},u.prototype.compressionComplete=function(e,t){var n=t.generate({type:"blob"});window.saveAs(n,e+".zip")},u.prototype.readDir=function(e){var t=this;t.files.reset();if(e===undefined||!e.length)return;e.forEach(function(e){var n=new r(e);e.getMetadata(function(e){n.updateFileData(e),t.files.add(n)})})},u.prototype.parentDir=function(){var e=this.fileSystem.get("path");if(e==="/")return;e=e.split("/"),e.pop(),e=e.join("/"),this.fileSystem.set({path:e})},u.prototype.setDir=function(e){var t=$(e.target).attr("path");t===""&&(t="/"),this.fileSystem.set({path:t}),this.fileSystem.update()},u.prototype.toggleView=function(){$("a[href='#file-system']").parent().hasClass("active")?($("a[href='#file-system']").parent().removeClass("active"),$(".display-panel").addClass("hide"),this.$canvas.removeClass("hide")):($(".maker-tools").parent().removeClass("active"),$("a[href='#file-system']").parent().addClass("active"),$(".display-panel").addClass("hide"),this.$el.removeClass("hide"),this.app.exporter.export())},u.prototype.errorHandler=function(e){window.console.log("Error: "+e.name+" "+e.message)},u.prototype.saveFile=function(e,t){this.filesView.saveFile(e,t)},o.prototype.saveError=function(e){window.alert(e)},u}),define("loader",["marker","transectWell","polygon","point","transectText"],function(e,t,n,r,i){var s=function(e){this.app=e,this.polygons=this.app.PolygonsCollection,this.zones=this.app.ZonesCollection,this.transects=this.app.TransectsCollection,this.markers=this.app.MarkersCollection,this.wells=this.app.TransectWellsCollection,this.texts=this.app.TransectTextsCollection,this.points=this.app.PointsCollection,this.lines=this.app.LinesCollection};return s.prototype.loadFromLocalStorage=function(){this.loadData(localStorage.transectApp)},s.prototype.loadData=function(e){this.savedData=JSON.parse(e),this.reset(),this.load()},s.prototype.reset=function(){_.invoke(this.texts.toArray(),"destroy"),_.invoke(this.lines.toArray(),"destroy"),_.invoke(this.points.toArray(),"destroy"),_.invoke(this.polygons.toArray(),"destroy"),_.invoke(this.zones.toArray(),"destroy"),_.invoke(this.transects.toArray(),"destroy"),_.invoke(this.markers.toArray(),"destroy"),_.invoke(this.wells.toArray(),"destroy"),this.app.referenceColumn&&this.app.referenceColumn.set({columnId:"none"})},s.prototype.load=function(){this.loadImage(),this.loadMarkersAndZones(),this.loadWellsAndTransects(),this.loadPolygons(),this.loadTexts(),this.updateLines()},s.prototype.loadImage=function(){this.app.ImageOb.set(this.savedData.image)},s.prototype.loadReferenceColumnData=function(){var e=this;e.savedData.referenceColumn&&e.savedData.referenceColumn.columnId!=="none"?(e.app.referenceColumn.set({columnId:e.savedData.referenceColumn.columnId,columnData:e.savedData.referenceColumn.columnData,top:e.savedData.referenceColumn.top,base:e.savedData.referenceColumn.base}),e.updateMarkerPositions()):e.loadMarkersAndZones()},s.prototype.updateMarkerPositions=function(){var e=this;e.savedData.markers.forEach(function(t){var n=e.app.MarkersCollection.findWhere({age:t.age});n&&n.set({y:t.y})})},s.prototype.loadMarkersAndZones=function(){var t=this;t.savedData.zones.forEach(function(n,r){var i=t.markers.findWhere({y:n.topMarker.y})||new e(n.topMarker),s=t.markers.findWhere({y:n.baseMarker.y})||new e(n.baseMarker);t.markers.add(i),t.markers.add(s)}),t.savedData.zones.forEach(function(e,n){var r=t.markers.findWhere({y:e.topMarker.y}),i=t.markers.findWhere({y:e.baseMarker.y}),s=t.zones.findWhere({topMarker:r,baseMarker:i});s!==undefined&&(s.set({name:e.name,description:e.description}),s.update())})},s.prototype.loadWellsAndTransects=function(){var e=this;e.savedData.transects.forEach(function(n,r){var i=e.wells.findWhere({x:n.wellLeft.x}),s=e.wells.findWhere({x:n.wellRight.x});i===undefined&&(i=new t(n.wellLeft),e.wells.add(i)),s===undefined&&(s=new t(n.wellRight),e.wells.add(s))}),e.savedData.transects.forEach(function(t,n){var r=e.wells.findWhere({x:t.wellLeft.x}),i=e.wells.findWhere({x:t.wellRight.x}),s=e.transects.findWhere({wellLeft:r,wellRight:i});s!==undefined&&(s.set({name:t.name,description:t.description}),s.update())})},s.prototype.loadPolygons=function(){var e=this;e.savedData.polygons.forEach(function(t){e.createPolygon(t)})},s.prototype.createPolygon=function(e){var t=this,i=t.polygons.findWhere({id:e.id,name:e.name,patternName:e.patternName})||new n({id:e.id,name:e.name,description:e.description});this.polygons.add(i),e.points.forEach(function(e){var n=t.points.findWhere({x:parseInt(e.x),y:parseInt(e.y)})||new r({x:parseInt(e.x),y:parseInt(e.y)},t.app);i.get("points").add(n)}),i.set({patternName:e.patternName})},s.prototype.loadTexts=function(){var e=this;e.savedData.texts.forEach(function(t){var n=e.texts.findWhere({text:t.text,x:t.x,y:t.y})||new i(t,e.app);e.texts.add(n),n.get("settings").set(t.settings)})},s.prototype.updateLines=function(){var e=this;e.savedData.lines.forEach(function(t){var n=e.points.findWhere({x:parseInt(t.point1.x),y:parseInt(t.point1.y)}),r=e.points.findWhere({x:parseInt(t.point2.x),y:parseInt(t.point2.y)}),i=e.lines.findWhere({point1:n,point2:r})||e.lines.findWhere({point1:r,point2:n});i&&i.set({name:t.name,pattern:i.get("pattern")==="default"?t.pattern:i.get("pattern")})})},s}),define("transectTexts",["baseCollection","transectText"],function(e,t){var n=e.extend({classname:"TransectTexts",model:t});return n.prototype.updateTransectTexts=function(){return this.each(function(e){e.updateTransectAndZone()}),!0},n.prototype.comparator=function(e){return e.get("y")},n}),define("exporter",["polygon","polygons","point","points","line","lines","transects","transectTexts","polyK"],function(e,t,n,r,i,s,o,u,a){var f=function(e){this.app=e};return f.prototype.initialize=function(){var e=this;this.PRECISION=transectApp.precision,this.texts=this.app.TransectTextsCollection,this.polygons=this.app.PolygonsCollection,this.wells=this.app.TransectWellsCollection,this.transects=this.app.TransectsCollection,this.markers=this.app.MarkersCollection,this.zones=this.app.ZonesCollection,this.transectImage=this.app.ImageOb,this.texts.sort(),this.polygons.sort(),e.transectsData={},this.app.TransectsCollection.each(function(n){e.transectsData[n.get("id")]={data:n,polygons:new t,points:new r,texts:new u,matrixPositions:[],matrixAges:[],matrix:{}}}),e.wellsData={},this.app.TransectWellsCollection.each(function(n){e.wellsData[n.get("id")]={data:n,points:new r,polygons:new t,referencePoints:[]}}),e.points=new r,e.lines=new s},f.prototype.export=function(){this.initialize(),this.processData(),this.updateWells(),this.sortData(),this.processTexts()},f.prototype.processTexts=function(){var e=this;e.texts.each(function(t){var n=t.get("transect").id;e.transectsData[n].texts.add(t)})},f.prototype.sortData=function(){var e=this;for(var t in e.transectsData)e.sortTransectsData(e.transectsData[t]),e.sortMatrixDataAndUpdateEndPoints(e.transectsData[t]);for(var t in e.wellsData)e.sortWellsData(e.wellsData[t])},f.prototype.sortMatrixDataAndUpdateEndPoints=function(e){var t=[],n=[];for(var r in e.matrixPositions)e.matrixPositions[r]<3?t.push(e.matrixPositions[r]):e.matrixPositions[r]>97&&n.push(e.matrixPositions[r]);t.sort(function(e,t){return e-t}),n.sort(function(e,t){return t-e});for(var r in e.matrixAges){var i=e.matrix[e.matrixAges[r]];for(var s in t)if(t[s]in i){var o=i[t[s]];delete i[t[s]],i[0]=o,e.matrixPositions.indexOf(0)<0&&e.matrixPositions.push(0);break}for(var s in n)if(n[s]in i){var o=i[n[s]];delete i[n[s]],i[100]=o,e.matrixPositions.indexOf(100)<0&&e.matrixPositions.push(100);break}}},f.prototype.sortTransectsData=function(e){e.matrixPositions=_.uniq(e.matrixPositions),e.matrixAges=_.uniq(e.matrixAges),e.matrixPositions=_.sortBy(e.matrixPositions,function(e){return parseInt(e)}),e.matrixAges=_.sortBy(e.matrixAges,function(e){return parseFloat(e)})},f.prototype.sortWellsData=function(e){e.referencePoints=_.uniq(e.referencePoints),e.referencePoints=_.sortBy(e.referencePoints,function(e){return e.point.get("age")}),e.referencePoints.length>0&&(e.referencePoints[0].pattern="TOP")},f.prototype.processData=function(){this.polygons.each(this.processPolygon.bind(this))},f.prototype.processPolygon=function(e){var t=this.getUnderlyingTransects(e);this.slicePolygon(e,t)},f.prototype.getUnderlyingTransects=function(e){var t=this,n=new o,r=[];e.get("points").each(function(e){var n=e.get("transect"),i=t.transects.indexOf(n);r=_.union(r,i)});var i=_.min(r),s=_.max(r);for(var u=i;u<=s;u++)n.add(t.transects.at(u));return n},f.prototype.slicePolygon=function(n,r){var i=this,s=r.length,o=new t,u=new e;u.get("points").add(n.get("points").clone().toArray()),u.get("lines").add(n.get("lines").clone().toArray()),o.add(u);for(var f=0;f<r.length;f++){var l=r.at(f),c=new t;for(var h=0;h<o.length;h++){var p=o.at(h),d=i.getLineSegmentForWell(l.get("wellRight")),v=p.getPolyKPointsArray();a.GetArea(v)>0&&(v=a.Reverse(v));try{var m=a.Slice(v,d[0],d[1],d[2],d[3]),m=i.getPolygonsFromPolyKPolygonsArray(m);c.add(m.toArray())}catch(g){}}o=c}for(var h=0;h<o.length;h++){var p=o.at(h),l=i.getTransectForPolygon(p,r);if(l===null)continue;var y=l.get("id");p.set({patternName:n.get("patternName")}),p.set({description:n.get("description")}),i.updatePolygonLines(p,n),i.updatePointsOnWell(l.get("wellLeft"),p.get("lines"),n);var f=r.toArray().indexOf(l);f==s-1&&i.updatePointsOnWell(l.get("wellRight"),p.get("lines"),n),i.transectsData[y].points.add(p.get("points").toArray()),i.transectsData[y].polygons.add(p),i.updateTransectMatrix(l,p)}},f.prototype.getTransectForPolygon=function(e,t){for(var n=0;n<t.length;n++){var r=t.at(n),i=r.getPolyKPointsArray(),s=!0;for(var o=0;o<e.get("points").length;o++){var u=e.get("points").at(o);if(!a.ContainsPoint(i,u.get("x"),u.get("y"))){s=!1;break}}if(s)return r}return null},f.prototype.updateTransectMatrix=function(e,t){var n=this,r=t.get("points"),i=n.transectsData[e.get("id")].matrix,s=n.transectsData[e.get("id")].matrixAges,o=n.transectsData[e.get("id")].matrixPositions;r.each(function(t){var n=t.get("age"),r=Math.round(t.get("relativeX")*1e4)/100,u=t.get("transect");u!==e&&(u.get("wellLeft")===e.get("wellRight")?r=101:r=-1),n in i||(i[String(n)]={}),s.indexOf(n)<0&&s.push(n),o.indexOf(n)<0&&o.push(r),i[String(n)][String(r)]=t.get("name")})},f.prototype.updatePointsOnWell=function(e,t,n){var r=this;t.each(function(t){r.isCloseToWell(e,t)&&(r.wellsData[e.get("id")].polygons.add(n),r.wellsData[e.get("id")].points.add(t.get("point1")),r.wellsData[e.get("id")].points.add(t.get("point2")))})},f.prototype.updateWells=function(){var e=this;for(var t in e.wellsData)e.updateWell(e.wellsData[t])},f.prototype.updateWell=function(e){var t=this;e.points.sortBy(function(e){return e.get("y")}),e.points.each(function(n,r){var i=t.getPointPattern(n,e.polygons),s=null,o=null,u="";i!=null&&(s=i.get("patternName"),o=i.get("name"),u+=o+" - "+(i.get("description")||"")),u+=" CALIBRATION = ",u+=Math.round((1-n.get("relativeY"))*1e3)/10+" % up the ",u+=n.get("zone").get("name")+". ",e.referencePoints.push({point:n,pattern:s?s:"TOP",name:o?o:"",description:u?u:""})})},f.prototype.getPointPattern=function(e,n){var r=new t;return n.each(function(t){var n=t.getPolyKPointsArray();(a.ContainsPoint(n,e.get("x")+1,e.get("y")-1)&&a.ContainsPoint(n,e.get("x"),e.get("y")-1)||a.ContainsPoint(n,e.get("x")-1,e.get("y")-1)&&a.ContainsPoint(n,e.get("x"),e.get("y")-1))&&r.add(t)}),r.length==0?null:(r.sort(),r.first())},f.prototype.isCloseToWell=function(e,t){var n=this,r=n.getLineSegmentForWell(e),i=5,s=[r[0]+i,r[1],r[0]-i,r[1],r[2]-i,r[3],r[2]+i,r[3]],o=t.getPolyKPointsArray();return a.ContainsPoint(s,o[0],o[1])&&a.ContainsPoint(s,o[2],o[3])?!0:!1},f.prototype.updatePolygonLines=function(e,t){var n=this,r=e.get("points"),o=new s;r.each(function(s,o){if(o>0){var u=r.at(o-1),a=s,f=n.lines.findWhere({point1:u,point2:a})||n.lines.findWhere({point1:a,point2:u})||new i({},u,a);n.lines.add(f),n.updateLineStyleFromOriginalPolygon(f,t),e.get("lines").add(f)}});var u=r.last(),a=r.first(),f=n.lines.findWhere({point1:u,point2:a})||n.lines.findWhere({point1:a,point2:u})||new i({},u,a);n.lines.add(f),n.updateLineStyleFromOriginalPolygon(f,t),e.get("lines").add(f)},f.prototype.updateLineStyleFromOriginalPolygon=function(e,t){var n=this,r=t.get("lines");for(var i=0;i<r.length;i++){var s=r.at(i);if(s.coincides(e)){e.set({pattern:s.get("pattern")});break}}},f.prototype.getLineSegmentForWell=function(e){return[Math.floor(e.get("x")),0,Math.floor(e.get("x")),this.app.height]},f.prototype.getPolygonsFromPolyKPolygonsArray=function(e){var n=new t;for(var r in e)n.add(this.getPointsFromPolykPolygon(e[r]));return n},f.prototype.getPointsFromPolykPolygon=function(t){var r=new e;for(var i=0;i<t.length;i+=2){var s=this.points.findWhere({x:Math.floor(t[i]),y:Math.floor(t[i+1])})||new n({x:Math.floor(t[i]),y:Math.floor(t[i+1])},this.app);this.points.add(s),r.get("points").add(s)}return r},f.prototype.getText=function(){var e=this,t=e.getMetaColumn();for(var n=0;n<e.transects.length;n++){var r=e.transects.at(n);if(n==0){var i=r.get("wellLeft").id;t+=e.getWellOutputText(i)}t+=e.getTransectOutputText(r.id);var s=r.get("wellRight").id;t+=e.getWellOutputText(s)}return t},f.prototype.getMetaColumn=function(){var e=this,t="\n\nTRANSECTS	:	";for(var n=0;n<e.transects.length;n++){var r=e.transects.at(n);if(n==0){var i=r.get("wellLeft");t+=i.get("name")+"	"}t+=r.get("name")+"	";var s=r.get("wellRight");t+=s.get("name")+"	"}return t+="\n\n",t},f.prototype.getTransectOutputText=function(e){var t=this,n=t.transectsData[e],r="\n\n";return r+=n.data.get("name")+"	",r+="transect	",r+=n.data.get("width")+"	",r+=CssToTscColor(n.data.get("settings").get("backgroundColor"))+"	",r+=n.data.get("status")+"	",r+=t.getTransectMatrixText(e),r+=t.getTransectPolygonsListText(e),r+=t.getTextLabelsOutput(e),r},f.prototype.getTransectMatrixText=function(e){var t=this,n=t.transectsData[e],r=n.matrixAges,i=n.matrixPositions.sort(function(e,t){return parseFloat(e)-parseFloat(t)}),s="\n		";for(var o=0;o<i.length;o++)s+=i[o]+"	";for(var o=0;o<r.length;o++){var u=String(r[o]);s+="\n	",s+=u+"	";for(var a=0;a<i.length;a++){var f=i[a];s+=(n.matrix[String(u)][String(f)]||"")+"	"}}return s},f.prototype.getTransectPolygonsListText=function(e){var t=this,n=t.transectsData[e],r="";for(var i=0;i<n.polygons.length;i++){var s=n.polygons.at(i);r+="\n",r+="POLYGON	",r+="pattern: "+(s.get("patternName")||"None")+"	",r+=s.get("description")||"	";var o=s.get("lines"),u=s.get("points");for(var a=0;a<u.length;a++){var f=u.at(a),l=u.at((a+1)%u.length),c=o.findWhere({point1:f,point2:l})||o.findWhere({point1:l,point2:f}),h=c.get("pattern");r+="\n	",r+=f.get("name").substring(1),h!=="default"&&(r+="\n		",r+=h)}}return r},f.prototype.getWellOutputText=function(e){var t=this,n=t.wellsData[e],r="\n\n";r+=n.data.get("name")+"	",r+="facies	",r+=n.data.get("width")+"	",r+=CssToTscColor(n.data.get("settings").get("backgroundColor"))+"	",r+"\n";for(var i in n.referencePoints)r+="\n",r+="	",r+=(n.referencePoints[i].pattern||"None")+"	",r+=(n.referencePoints[i].name||"")+"	",r+=n.referencePoints[i].point.get("age")+"	",r+=n.referencePoints[i].description+"	";return r},f.prototype.getTextLabelsOutput=function(e){var t="",n=this.transectsData[e].texts;return n.each(function(e){var n=e.get("bBox"),r=e.get("text").split("\n").join(""),i=e.get("settings").get("fontFamily").split(",")[0];t+="\n",t+="TEXT	"+n.y1+"	"+n.x1,t+="	"+r,t+="	font-family: "+i+"; font-size: "+e.get("settings").get("fontSize")+";",t+="	"+Math.round((n.y1-n.y2)*100)/100+"	"+Math.round((n.x2-n.x1)*100)/100}),t},f.prototype.getMapData=function(){var e=this,t=e.getMapDataColData();return t+=e.getMapTransectData(),t},f.prototype.getMapDataColData=function(){var e=this,t="COMMENT	DATA COLUMNS\n\nHEADER-DATACOL	NAME	LAT	LON	NOTE\n";return e.wells.each(function(e){t+="\n",t+="DATACOL	",t+=e.get("name")+"	",t+=(e.get("lat")||"n/a")+"	",t+=(e.get("lon")||"n/a")+"	",t+=e.get("description")||""}),t},f.prototype.getMapInfoPtData=function(){var e=this,t="\n\n\nCOMMENT	INFO POINTS\n\nHEADER-INFORMATION	POINTS	NAME	LAT	LON	NOTE\n";return e.wells.each(function(e){t+="\n",t+="INFOPT	",t+=e.get("name")+"	",t+=(e.get("lat")||"n/a")+"	",t+=(e.get("lon")||"n/a")+"	",t+=e.get("description")||""}),t},f.prototype.getMapTransectData=function(){var e=this,t="\n\n\nCOMMENT	TRANSECTS\n\nHEADER-TRANSECTS	NAME	STARTLOC	ENDLOC	NOTE\n";return e.transects.each(function(e){t+="\n",t+="TRANSECT	",t+=e.get("name")+"	",t+=e.get("wellLeft").get("name")+"	",t+=e.get("wellRight").get("name")+"	",t+=e.get("description")||""}),t},f.prototype.getJSON=function(){var e={};return e.transects=this.transects.toJSON(),e.markers=this.markers.toJSON(),e.zones=this.zones.toJSON(),e.polygons=this.polygons.toJSON(),e.texts=this.texts.toJSON(),e.image=this.transectImage.toJSON(),e.points=this.app.PointsCollection.toJSON(),e.lines=this.app.LinesCollection.toJSON(),e.referenceColumn=this.app.referenceColumn.toJSON(),JSON.stringify(e)},f}),define("zones",["baseCollection","zone"],function(e,t){var n=e.extend({classname:"Zones",model:t});return n.prototype.comparator=function(e){return e.get("topMarker").get("y")},n.prototype.getZoneForY=function(e){var t=null;return this.each(function(n){n.isYInsideZone(e)&&(t=n)}),t},n.prototype.getZoneInNeighborhoodForY=function(e,t){this.sort();if(!t)return null;var n=this.indexOf(t),r=this.at(n-1),i=this.at(n+1);return t.isYInsideZone(e)?t:r&&r.isYInsideZone(e)?r:i&&i.isYInsideZone(e)?i:null},n}),define("transectWells",["baseCollection","transectWell"],function(e,t){var n=e.extend({classname:"TransectWells",model:t});return n.prototype.comparator=function(e){return e.get("x")},n}),define("markers",["baseCollection","marker"],function(e,t){var n=e.extend({classname:"Markers",model:t});return n.prototype.comparator=function(e){return e.get("y")},n.prototype.hasUndefinedAges=function(){return this.any(function(e){return!e.get("age")})},n}),define("referenceBlock",["baseModel","settings"],function(e,t){var n=e.extend({classname:"ReferenceBlock",constructor:function(n,r){var i=[{edit:!1,hover:!1,name:n.name||_.uniqueId("ReferenceBlock "),description:n.description,settings:new t,top:n.top||null,base:n.base||null,blockColumn:n.blockColumn||null}];e.apply(this,i)}});return n.prototype.initialize=function(){this.get("settings").set({backgroundColor:"#FF0000"})},n.prototype.toJSON=function(){var e=_.clone(this.attributes);return delete e.blockColumn,e},n}),define("referenceBlocks",["baseCollection","referenceBlock"],function(e,t){var n=e.extend({classname:"ReferenceBlocks",model:t});return n}),define("referenceBlockMarker",["baseModel","referenceBlocks"],function(e,t){var n=e.extend({classname:"ReferenceBlockMarker",constructor:function(n,r){var i=[{name:n.name||"TOP",edit:!1,hover:!1,y:parseInt(n.y),id:_.uniqueId("block-marker-"),age:n.age?parseFloat(n.age):null,blockColumn:n.blockColumn||null,style:"solid",app:r||null,blocks:new t,marker:null}];e.apply(this,i)}});return n.prototype.initialize=function(){},n.prototype.toJSON=function(){var e=_.clone(this.attributes);return delete e.blocks,delete e.blockColumn,delete e.marker,delete e.app,e},n}),define("referenceBlockMarkers",["baseCollection","referenceBlockMarker"],function(e,t){var n=e.extend({classname:"ReferenceBlockMarkers",model:t});return n.prototype.comparator=function(e){return e.get("y")},n}),define("referenceBlockColumn",["baseModel","referenceBlocks","referenceBlockMarkers","settings"],function(e,t,n,r){var i=e.extend({classname:"ReferenceBlockColumn",constructor:function(i){var s=[{x:i.x||0,id:i.id||_.uniqueId("column-"),name:i.name||_.uniqueId("Column "),width:parseInt(i.width)||200,height:100,description:i.description||null,blockMarkers:new n,blocks:new t,settings:new r}];e.apply(this,s)}});return i.prototype.comparator=function(e){return e.get("x")},i.prototype.toJSON=function(){var e=_.clone(this.attributes);return e},i}),define("referenceColumn",["baseModel","referenceBlockColumn"],function(e,t){var n=e.extend({classname:"ReferenceColumn",constructor:function(t){var n=[{columnId:t.columnId||"none",column:t.column||null,top:t.top||0,base:t.base||15,columnsData:t.columnsData||null}];e.apply(this,n)}});return n.prototype.toJSON=function(){var e=_.clone(this.attributes);return e},n}),define("referenceBlockView",["baseView"],function(e){var t=e.extend({tagName:"li",classname:"ReferenceBlockView",events:{"click .toggle":"toggleBlockForm","click .block-data":"toggleBlockForm","click .destroy":"destroy","keypress :input":"updateBlock","keyup :input":"updateBlock",'change input[name="block-color"]':"updateBlock","change select.block-line-style":"updateBlock",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return t.prototype.template=new EJS({url:"/reference_column_maker/ejs/block.ejs"}),t.prototype.initialize=function(e,t){this.app=e,this.block=t,this.top=this.block.get("top"),this.base=this.block.get("base"),this.blockSet===undefined&&(this.blockSet=this.app.Paper.set(),this.app.BlocksSet.push(this.blockSet)),this.render(),this.listenTo(this.block,"change:edit",this.editBlock.bind(this)),this.listenTo(this.block,"change:hover",this.setHoverStatus.bind(this)),this.listenTo(this.block,"change:name",this.renderBlock.bind(this)),this.listenTo(this.block,"change:description",this.renderBlock.bind(this)),this.listenTo(this.block.get("blockColumn"),"change:x",this.renderBlock.bind(this)),this.listenTo(this.block.get("blockColumn"),"change:width",this.renderBlock.bind(this)),this.listenTo(this.top,"change:y",this.renderBlock.bind(this)),this.listenTo(this.top,"change:age",this.render.bind(this)),this.listenTo(this.base,"change:y",this.renderBlock.bind(this)),this.listenTo(this.base,"change:age",this.render.bind(this)),this.listenTo(this.block.get("settings"),"change",this.renderBlock.bind(this)),this.listenTo(this.block,"destroy",this.delete.bind(this))},t.prototype.render=function(){this.$el.html(this.template.render(this.block.toJSON())),this.$toggle=this.$(".toggle"),this.$blockForm=this.$(".block-form"),this.$blockData=this.$(".block-data"),this.$blockName=this.$('input[name="block-name"]')[0],this.$topAge=this.$('input[name="top-age"]')[0],this.$baseAge=this.$('input[name="base-age"]')[0],this.$blockColor=this.$('input[name="block-color"]')[0],this.$blockDescription=this.$('textarea[name="block-description"]')[0],this.editBlock(),this.renderBlock()},t.prototype.renderBlock=function(){this.bgBox===undefined&&(this.bgBox=this.app.Paper.rect(),this.blockText=this.app.Paper.text(),this.bBox=this.app.Paper.rect(),this.blockSet.push(this.bgBox),this.blockSet.push(this.blockText),this.blockSet.push(this.bBox),this.app.MarkersSet.toFront(),this.app.BlockMarkersSet.toFront(),this.bBox.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this))),this.bgBox.attr({"stroke-width":0,fill:this.block.get("settings").get("backgroundColor"),x:this.block.get("blockColumn").get("x"),y:this.top.get("y"),width:this.block.get("blockColumn").get("width"),height:this.base.get("y")-this.top.get("y")});var e=Math.round(this.block.get("blockColumn").get("x")+this.block.get("blockColumn").get("width")/2),t=Math.round((this.top.get("y")+this.base.get("y"))/2),n=Math.min(Math.round(this.base.get("y")-this.top.get("y")),16);this.blockText.attr({x:e,y:t,text:this.block.get("name"),"font-size":n}),this.bBox.attr({"stroke-width":2,opacity:0,fill:"#FFF",x:this.block.get("blockColumn").get("x"),y:this.top.get("y"),width:this.block.get("blockColumn").get("width"),height:this.base.get("y")-this.top.get("y")}),this.renderTooltip()},t.prototype.renderTooltip=function(){$(this.bBox.node).qtip({content:{text:this.block.get("name")+"<br>"+(this.block.get("description")||"No description yet!")},position:{my:"bottom left",target:"mouse"}})},t.prototype.onMouseOver=function(){this.$el.addClass("hover"),this.block.set({hover:!0})},t.prototype.onMouseOut=function(){this.$el.removeClass("hover"),this.block.set({hover:!1})},t.prototype.setHoverStatus=function(){this.block.get("hover")?(this.$el.addClass("hover"),this.glow=this.bBox.glow()):(this.glow&&this.glow.remove(),this.$el.removeClass("hover"))},t.prototype.toggleBlockForm=function(){this.render(),this.block.set({edit:!this.block.get("edit")})},t.prototype.editBlock=function(){this.block.get("edit")?(this.$blockForm.removeClass("hide"),this.$blockData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$blockForm.addClass("hide"),this.$blockData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},t.prototype.delete=function(){this.blockText&&this.blockText.remove(),this.bgBox&&this.bgBox.remove(),this.bBox&&this.bBox.remove(),this.glow&&this.glow.remove(),this.$el.remove(),this.remove()},t.prototype.destroy=function(){this.block.get("base").set({name:"TOP"}),this.block.destroy()},t.prototype.updateBlock=function(e){var t=this.$blockName.value,n=this.$blockDescription.value,r=this.$blockColor.value,i=this.$("select.block-line-style option:selected").val();this.block.set({name:t,description:n});if(e.keyCode===TimescaleApp.ENTER||e.keyCode===TimescaleApp.ESC)this.block.get("base").set({name:t+" Base",age:parseFloat(this.$baseAge.value||0)}),this.block.get("top").set({age:parseFloat(this.$topAge.value||0)}),this.toggleBlockForm();this.block.get("settings").set({backgroundColor:r}),this.base.set({style:i})},t}),define("referenceBlockMarkerView",["baseView"],function(e){var t=e.extend({classname:"ReferenceBlockMarkerView"});return t.prototype.statusBoxTemplate=new EJS({url:"/reference_column_maker/ejs/status_box.ejs"}),t.prototype.initialize=function(e,t){this.app=e,this.blockMarker=t,this.render(),this.listenTo(this.blockMarker.get("blockColumn"),"change:x",this.renderBlockMarker.bind(this)),this.listenTo(this.blockMarker.get("blockColumn"),"change:width",this.renderBlockMarker.bind(this)),this.listenTo(this.blockMarker,"change:hover",this.setHoverStatus.bind(this)),this.listenTo(this.blockMarker,"change",this.renderBlockMarker.bind(this)),this.listenTo(this.blockMarker,"destroy",this.delete.bind(this)),this.listenTo(this.blockMarker.get("blocks"),"remove",this.checkAndDelete.bind(this)),this.render()},t.prototype.render=function(){this.renderBlockMarker()},t.prototype.renderBlockMarker=function(){this.element===undefined&&(this.element=this.app.Paper.path(),this.element.attr({"stroke-width":2,stroke:"#0000FF"}),this.element.hover(this.onMouseOver.bind(this),this.onMouseOut.bind(this)),this.element.drag(this.dragMove.bind(this),this.dragStart.bind(this),this.dragEnd.bind(this)),this.app.BlockMarkersSet.push(this.element),this.app.MarkersSet.toFront()),this.blockMarker.get("marker")&&this.listenTo(this.blockMarker.get("marker"),"change:y",this.updateBlockMakereY.bind(this));var e=this.blockMarker.get("style"),t=[];e==="dashed"?t=["-"]:e==="dotted"&&(t=["."]),this.element.attr({path:this.getPath(),"stroke-dasharray":t}),this.resizePaper(),this.updateStatusBox(),this.renderTooltip()},t.prototype.renderTooltip=function(){var e=this;$(this.element.node).qtip({content:{text:this.blockMarker.get("name")+"("+this.blockMarker.get("age")+" myr )"},position:{my:"bottom left",target:"mouse"}})},t.prototype.resizePaper=function(){var e=Math.max(this.app.Paper.height,this.blockMarker.get("y")+100);this.blockMarker.get("blockColumn").set({height:e}),this.app.Paper.setSize(this.app.Paper.width,e)},t.prototype.updateBlockMakereY=function(){this.blockMarker.get("marker")&&this.blockMarker.set({y:this.blockMarker.get("marker").get("y")})},t.prototype.updateStatusBox=function(){this.app.StatusBox&&this.app.StatusBox.html(this.statusBoxTemplate.render(this.blockMarker.toJSON()))},t.prototype.getPath=function(){var e=this.blockMarker.get("blockColumn").get("x")+this.blockMarker.get("blockColumn").get("width");return"M"+this.blockMarker.get("blockColumn").get("x")+","+this.blockMarker.get("y")+"H"+e},t.prototype.dragStart=function(e,t,n){var r=this.blockMarker.get("blockColumn").get("blockMarkers"),i=r.indexOf(this.blockMarker);this.prevMarker=r.at(i-1),this.nextMarker=r.at(i+1)},t.prototype.dragMove=function(e,t,n,r,i){if(this.prevMarker&&this.nextMarker&&(this.prevMarker.get("y")+2>i.offsetY||i.offsetY>this.nextMarker.get("y")-2))return;if(!this.prevMarker&&this.nextMarker&&i.offsetY>this.nextMarker.get("y")-2)return;if(this.prevMarker&&!this.nextMarker&&this.prevMarker.get("y")+2>i.offsetY)return;this.blockMarker.set({y:i.offsetY})},t.prototype.onMouseOver=function(){this.$el.addClass("hover"),this.blockMarker.set({hover:!0})},t.prototype.onMouseOut=function(){this.$el.removeClass("hover"),this.blockMarker.set({hover:!1})},t.prototype.setHoverStatus=function(){this.blockMarker.get("hover")?(this.element.attr({"stroke-width":5}),this.$el.addClass("hover")):(this.element.attr({"stroke-width":2}),this.$el.removeClass("hover"))},t.prototype.dragEnd=function(e){},t.prototype.delete=function(){this.element!==undefined&&this.element.remove(),this.$el.remove(),this.remove()},t.prototype.checkAndDelete=function(){this.blockMarker.get("blocks").length==0&&this.destroy()},t.prototype.destroy=function(){this.blockMarker.destroy()},t}),define("referenceBlockColumnView",["baseView","referenceBlockView","referenceBlockMarkerView","referenceBlock","referenceBlockMarker"],function(e,t,n,r,i){var s=e.extend({tagName:"li",classname:"ReferenceBlockColumnView",events:{"click .toggle":"ReferencetoggleBlockColumnForm","click .block-column-data":"ReferencetoggleBlockColumnForm","click .destroy":"destroy","click label.block-column-blocks-data":"showBlocksList","keypress :input":"ReferenceupdateBlockColumn","keyup :input":"ReferenceupdateBlockColumn",'change input[name="block-column-bg-color"]':"ReferenceupdateBlockColumn",mouseover:"onMouseOver",mouseout:"onMouseOut"}});return s.prototype.template=new EJS({url:"/reference_column_maker/ejs/block_column.ejs"}),s.prototype.initialize=function(e,t){this.app=e,this.blockColumn=t,this.render(),this.listenTo(this.blockColumn,"change:edit",this.editBlockColumn.bind(this)),this.listenTo(this.blockColumn,"change",this.renderBlockColumn.bind(this)),this.listenTo(this.blockColumn.get("settings"),"change",this.renderBlockColumn.bind(this)),this.listenTo(this.blockColumn.get("blockMarkers"),"add",this.addBlockMarker.bind(this)),this.listenTo(this.blockColumn.get("blocks"),"remove",this.removeBlock.bind(this)),this.listenTo(this.blockColumn.get("blocks"),"add",this.addBlock.bind(this)),this.listenTo(this.blockColumn,"destroy",this.delete.bind(this))},s.prototype.render=function(){this.$el.html(this.template.render(this.blockColumn.toJSON())),this.$toggle=this.$(".toggle"),this.$blockColumnForm=this.$(".block-column-form"),this.$blockColumnData=this.$(".block-column-data"),this.$blockColumnName=this.$('input[name="block-column-name"]')[0],this.$blockColumnWidth=this.$('input[name="block-column-width"]')[0],this.$blockColumnBgColor=this.$('input[name="block-column-bg-color"]')[0],this.$blockColumnDescription=this.$('textarea[name="block-column-description"]')[0],this.$blocksList=this.$(".blocks-list"),this.renderBlockColumn()},s.prototype.renderBlockColumn=function(){this.element===undefined&&(this.element=this.app.Paper.rect(this.blockColumn.get("x"),0,this.blockColumn.get("width"),this.app.Paper.height),this.element.dblclick(this.createBlockMarker.bind(this)),this.app.MarkersSet.toFront()),this.element.attr({x:this.blockColumn.get("x"),width:this.blockColumn.get("width"),height:this.blockColumn.get("height"),fill:this.blockColumn.get("settings").get("backgroundColor")}),this.resizePaper(),this.updateBlockColumns()},s.prototype.resizePaper=function(){var e=Math.max(this.app.Paper.width,this.blockColumn.get("x")+this.blockColumn.get("width"));this.app.Paper.setSize(e,this.app.Paper.height)},s.prototype.resetBlocks=function(){this.$blocksList.html(""),this.blockColumn.get("blocks").each(this.addBlock.bind(this))},s.prototype.ReferencerenderBlocks=function(){this.blockColumn.get("blocks").each(this.addBlockMarker.bind(this))},s.prototype.ReferencetoggleBlockColumnForm=function(){this.renderBlockColumn(),this.blockColumn.set({edit:!this.blockColumn.get("edit")})},s.prototype.editBlockColumn=function(){this.blockColumn.get("edit")?(this.$blockColumnForm.removeClass("hide"),this.$blockColumnData.addClass("hide"),this.$toggle.removeClass("hide-data"),this.$toggle.addClass("show-data")):(this.$blockColumnForm.addClass("hide"),this.$blockColumnData.removeClass("hide"),this.$toggle.removeClass("show-data"),this.$toggle.addClass("hide-data"))},s.prototype.delete=function(){this.element!==undefined&&this.element.remove(),this.$el.remove(),this.remove()},s.prototype.ReferenceupdateBlockColumn=function(e){e.keyCode==13&&this.ReferencetoggleBlockColumnForm();var t=this.$blockColumnName.value,n=this.$blockColumnDescription.value,r=this.$blockColumnWidth.value,i=this.$blockColumnBgColor.value;this.blockColumn.set({name:t,description:n,width:parseInt(r)||0}),this.blockColumn.get("settings").set({backgroundColor:i})},s.prototype.createBlockMarker=function(e){if(!this.app.enBlocks)return;var t=new i({y:e.offsetY,blockColumn:this.blockColumn},this.app);this.blockColumn.get("blockMarkers").add(t)},s.prototype.addBlockMarker=function(e){var t=new n(this.app,e),i=this,s=this.blockColumn.get("blocks"),o=this.blockColumn.get("blockMarkers");o.sort();var u=o.indexOf(e),a,f;if(o.length>1){u==0?(a=o.at(u),f=o.at(u+1)):(a=o.at(u-1),f=o.at(u));var l=s.findWhere({top:a,base:f})||new r({top:a,base:f,blockColumn:i.blockColumn});a.get("blocks").add(l),f.get("blocks").add(l),f.set({name:l.get("name")+" Base"}),s.add(l)}},s.prototype.removeBlock=function(e){var t=e.get("top"),n=e.get("top")},s.prototype.addBlock=function(e){var n=new t(this.app,e);this.$blocksList.append(n.el)},s.prototype.updateBlockColumns=function(){var e=this;if(!this.app.ReferenceBlockColumnsCollection)return;var t=this.app.ReferenceBlockColumnsCollection.indexOf(this.blockColumn);this.app.ReferenceBlockColumnsCollection.each(function(n,r){if(r>t){var i=e.app.ReferenceBlockColumnsCollection.at(r-1),s=i.get("x")+i.get("width");n.set({x:s})}})},s.prototype.showBlocksList=function(){this.$blocksList.hasClass("hide")?this.$blocksList.removeClass("hide"):this.$blocksList.addClass("hide")},s.prototype.delete=function(){_.invoke(this.blockColumn.get("blocks").toArray(),"destroy"),this.element&&this.element.remove(),this.$el.remove(),this.remove()},s.prototype.destroy=function(){this.blockColumn.destroy()},s}),define("referenceColumnSideView",["baseView","referenceColumn","referenceBlockColumn","referenceBlockColumnView","referenceColumnSideView","referenceBlockMarker","referenceBlock","marker"],function(e,t,n,r,i,s,o,u){var i=e.extend({el:"#ref-col-set-list",classname:"ReferenceColumnSideView",events:{"keypress :input":"updateReferenceColumnSettings","keyup :input":"updateReferenceColumnSettings","click input[type=radio]":"updateReferenceColumnSettings","dragover #reference-column-box":"dataDragover","drop #reference-column-box":"dataDrop"}});return i.prototype.template=new EJS({url:"/reference_column_maker/ejs/reference_column.ejs"}),i.prototype.settingsTemplate=new EJS({url:"/reference_column_maker/ejs/reference_column_settings.ejs"}),i.prototype.initialize=function(e){this.app=e,this.app.refCol={},this.zones=this.app.ZonesCollection,this.markers=this.app.MarkersCollection,this.referenceColumn=new t({top:0,base:15}),this.app.referenceColumn=this.referenceColumn,this.listenTo(this.referenceColumn,"change:columnsData",this.render.bind(this)),this.listenTo(this.referenceColumn,"change:columnId",this.render.bind(this)),this.listenTo(this.referenceColumn,"change:top",this.render.bind(this)),this.listenTo(this.referenceColumn,"change:base",this.render.bind(this)),this.renderReferenceColumnPaper(),this.loadReferenceColumnData()},i.prototype.listenToActionEvents=function(){var e=this;this.$enRefPanel=$("a[href='#show-ref-panel']"),this.$enRefPanel.click(function(){e.$refPanel.toggleClass("hidden")})},i.prototype.renderReferenceColumnPaper=function(){this.$refPanel=$("#ref-panel"),this.$refPanel.html(this.template.render({})),this.app.refCol.$canvas=$("#ref-canvas"),this.$canvas=this.app.refCol.$canvas,this.app.refCol.Paper=new Raphael(this.$canvas[0],0,0),this.app.refCol.MarkersSet=this.app.refCol.Paper.set(),this.app.refCol.BlockMarkersSet=this.app.refCol.Paper.set(),this.app.refCol.BlocksSet=this.app.refCol.Paper.set(),this.listenToActionEvents()},i.prototype.loadReferenceColumnData=function(){var e=this;$.get("/commons/json/default-reference-column-data.json",function(t){e.referenceColumn.set({columnsData:t.referenceBlockColumns})})},i.prototype.render=function(){var e=this;e.$el.html(e.settingsTemplate.render(e.referenceColumn.toJSON())),this.$topAge=this.$('input[name="top-age"]'),this.$baseAge=this.$('input[name="base-age"]'),this.updateReferenceColumn()},i.prototype.updateReferenceColumnSettings=function(e){var t=this;this.$columnId=this.$('input[name="ref-column"]:checked'),t.referenceColumn.set({columnId:t.$columnId.val()}),(e.keyCode==TimescaleApp.ENTER||e.keyCode==TimescaleApp.ESC)&&t.referenceColumn.set({top:parseFloat(t.$topAge.val()),base:parseFloat(t.$baseAge.val())})},i.prototype.getColumnData=function(e){var t=null;return this.referenceColumn.get("columnsData").forEach(function(n){n.id===e&&(t=n)}),t},i.prototype.updateReferenceColumn=function(e,t,n){_.invoke(this.markers.toArray(),"destroy"),_.invoke(this.zones.toArray(),"destroy"),this.referenceColumn.get("column")&&this.referenceColumn.get("column").destroy();if(this.referenceColumn.get("top")>this.referenceColumn.get("base")||this.referenceColumn.get("columnId")==="none")return;var r=this.getColumnData(this.referenceColumn.get("columnId"));r?(this.referenceColumn.set({column:this.loadBlockColumn(r)}),this.resizeReferenceColumnPaper()):this.referenceColumn.set({columnId:"none"})},i.prototype.loadBlockColumn=function(e){var t=this;e.x=0;var i=new n(e),s=new r(this.app.refCol,i);return t.addBlockMarkers(e,i),i},i.prototype.resizeReferenceColumnPaper=function(){var e=this.referenceColumn.get("column").get("width"),t=this.referenceColumn.get("column").get("blockMarkes")?this.referenceColumn.get("column").get("blockMarkes").last().get("y")+100:0;t=Math.max(this.app.Paper.height,t),this.app.refCol.Paper.setSize(e,t),this.app.Paper.setSize(this.app.Paper.width,t)},i.prototype.addBlockMarkers=function(e,t){var n=this,r=n.referenceColumn.get("top"),i=n.referenceColumn.get("base");e.blockMarkers.forEach(function(s,o){if(s.age<r||s.age>i)return;n.addBlockMarkerToColumn(s,t,o,e)})},i.prototype.addBlockMarkerToColumn=function(e,t,n,r){var i=this;e.y=t.get("blockMarkers").length>0?(t.get("blockMarkers").length+1)*50:50;var o=t.get("blockMarkers").findWhere({age:e.age})||new s({y:e.y,blockColumn:t,age:e.age},this.app);t.get("blockMarkers").add(o);var a=i.markers.findWhere({age:e.age})||new u(e);i.markers.add(a),o.set({name:e.name,marker:a}),a.set({name:e.name});if(n>0){var f=i.zones.last(),l=t.get("blocks").last(),c=r.blocks[n-1];f&&f.set({name:c.name,description:c.description}),l&&(l.set({name:c.name,description:c.description}),l.get("settings").set({backgroundColor:c.settings.backgroundColor}))}},i.prototype.updateBlockNames=function(e,t){var n=this;e.blocks.forEach(function(e,r,i){var s=t.get("blockMarkers").findWhere({age:e.top.age}),o=t.get("blockMarkers").findWhere({age:e.base.age}),u=n.markers.findWhere({age:e.top.age}),a=n.markers.findWhere({age:e.base.age});if(u!==null&&a!==null){var f=n.zones.findWhere({topMarker:u,baseMarker:a});f&&f.set({name:e.name,description:e.description})}if(s!==null&&o!==null){var l=t.get("blocks").findWhere({top:s,base:o});l&&(l.set({name:e.name,description:e.description}),l.get("settings").set({backgroundColor:e.settings.backgroundColor}))}})},i.prototype.dataDragover=function(e){var e=e.originalEvent;e.stopPropagation(),e.preventDefault()},i.prototype.dataDrop=function(e){var t=this,e=e.originalEvent;e.stopPropagation(),e.preventDefault();var n=e.dataTransfer.files[0],r=n.name.split(".").pop(),i=new FileReader;i.onloadend=function(e){r==="json"&&t.referenceColumn.set({columnsData:JSON.parse(this.result).referenceBlockColumns})},i.readAsText(n)},i}),define("transectAppView",["raphael","baseView","cursorView","transectsView","imageView","markersView","transectWellsView","transectTextsView","zonesView","polygonsView","dataImportView","dataExportView","fileSystemView","imageOb","loader","exporter","transects","transectTexts","polygons","lines","points","zones","transectWells","markers","referenceColumnSideView"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T){var N=t.extend({el:".container",classname:"TransectAppView",events:{"click a.transect-settings":"showSettings","click a.maker-tools":"enableTool","click a.continue":"showPaper","dragover #data-box":"dataDragover","drop #data-box":"dataDrop"}});return N.prototype.initialize=function(){this.transectApp={type:"transect",span:!0},this.transectApp.TransectsCollection=new m,this.transectApp.TransectTextsCollection=new g,this.transectApp.PolygonsCollection=new y,this.transectApp.LinesCollection=new b,this.transectApp.PointsCollection=new w,this.transectApp.ZonesCollection=new E,this.transectApp.TransectWellsCollection=new S,this.transectApp.MarkersCollection=new x,this.transectApp.CurrentPolygon=null,this.transectApp.StatusBox=$(".status-box"),this.$introScreen=this.$("#intro-screen"),this.transectApp.$canvas=this.$("#canvas"),this.transectApp.$display=this.$("#display"),this.$canvas=this.transectApp.$canvas,this.$displayPanels=this.$(".display-panel"),this.transectApp.x=0,this.transectApp.y=0,this.transectApp.width=this.transectApp.$display.width(),this.transectApp.height=this.transectApp.$display.height(),this.transectApp.ImageOb=new p({}),this.transectApp.Paper=new e(this.$canvas[0],this.transectApp.width,this.transectApp.height),this.transectApp.Paper.setViewBox(0,0,this.transectApp.width,this.transectApp.height),this.initPan(),this.transectApp.TextsSet=this.transectApp.Paper.set(),this.transectApp.MarkersSet=this.transectApp.Paper.set(),this.transectApp.WellsSet=this.transectApp.Paper.set(),this.transectApp.PointsSet=this.transectApp.Paper.set(),this.transectApp.LinesSet=this.transectApp.Paper.set(),this.transectApp.PolygonsSet=this.transectApp.Paper.set(),this.transectApp.loader=new d(this.transectApp),this.transectApp.exporter=new v(this.transectApp),this.listenToActionEvents(),this.render()},N.prototype.initPan=function(){this.transectApp.BgRect=this.transectApp.Paper.rect(0,0,this.transectApp.width,this.transectApp.height),this.transectApp.BgRect.attr({fill:"#ffffff","fill-opacity":1}),this.transectApp.BgRect.drag(this.onDragMove.bind(this),this.onDragStart.bind(this),this.onDragEnd.bind(this)),this.disPan()},N.prototype.listenToActionEvents=function(){var e=this;$(".close-reveal-modal").click(function(e){$(e.target).parent().foundation("reveal","close")}),$("a[href=#continue-load-from-local-storage]").click(function(e){$(e.target).parent().foundation("reveal","close")}),$("a[href=#continue-save-to-local-storage]").click(function(e){$(e.target).parent().foundation("reveal","close")}),$(document).on("close.fndtn.reveal","[data-reveal]",function(){switch(this.id){case"load-saved-data":e.loadFromLocalStorage();break;case"save-to-local-storage":e.saveToLocalStorage();break;default:}}),$(document).on("closed.fndtn.reveal","[data-reveal]",function(){})},N.prototype.showPaper=function(){this.$canvas.removeClass("hide"),this.$introScreen.addClass("hide")},N.prototype.render=function(){this.dataImportView=new l(this.transectApp),this.dataExportView=new c(this.transectApp),this.fileSystemView=new h(this.transectApp),this.cursorView=new n(this.transectApp),this.imageObView=new i(this.transectApp),this.markersView=new s(this.transectApp),this.zonesView=new a(this.transectApp),this.transectWellsView=new o(this.transectApp),this.transectsView=new r(this.transectApp),this.transectTextsView=new u(this.transectApp),this.polygonsView=new f(this.transectApp),this.referenceColumnSideView=new T(this.transectApp,"#reference-column-settings"),$(".linked").scroll(function(){$(".linked").scrollTop($(this).scrollTop())})},N.prototype.showSettings=function(e){var t=e.target.getAttribute("href")+"-list";$(t).hasClass("active")?($(t).removeClass("active"),$(e.target).removeClass("active"),$(e.target).parent().removeClass("active"),this.$("#sections-panel").removeClass("active")):(this.$(".settings-content").removeClass("active"),this.$(".settings-links").removeClass("active"),this.$(".transect-settings").removeClass("active"),$(t).addClass("active"),$(e.target).addClass("active"),$(e.target).parent().addClass("active"),this.$("#sections-panel").addClass("active"))},N.prototype.showExportDataPanel=function(e){this.$exportPanel.hasClass("active")||this.dataExportView.render()},N.prototype.exportPaperAsImage=function(){},N.prototype.saveToLocalStorage=function(){this.transectApp.exporter.export(),localStorage.transectApp=this.transectApp.exporter.getJSON()},N.prototype.loadFromLocalStorage=function(){this.showPaper(),this.transectApp.loader.loadFromLocalStorage()},N.prototype.dataDragover=function(e){var e=e.originalEvent;e.stopPropagation(),e.preventDefault()},N.prototype.dataDrop=function(e){var t=this,e=e.originalEvent;e.stopPropagation(),e.preventDefault();var n=e.dataTransfer.files[0],r=n.name.split(".").pop(),i=new FileReader;i.onloadend=function(e){t.showPaper(),r==="json"&&t.transectApp.loader.loadData(this.result)},i.readAsText(n)},N.prototype.enableTool=function(e){var t=e.target.getAttribute("href");if(t==="#new-polygon"||t==="#lock-cursor-h"||t==="#lock-cursor-v")return;this.markersView.enMarkers&&this.markersView.toggleMarkers(),this.transectWellsView.enWells&&this.transectWellsView.toggleWells(),this.transectTextsView.enTransectTexts&&this.transectTextsView.toggleTransectTexts(),this.polygonsView.enPolygons&&this.polygonsView.togglePolygons(),this.transectApp.Cursor.get("lockH")&&this.cursorView.toggleHlock(),this.transectApp.Cursor.get("lockV")&&this.cursorView.toggleVlock(),this.polygonsView.checkAndDeleteCurrentPolygon(),this.disPan();switch(t){case"#add-marker":this.markersView.toggleMarkers();break;case"#add-well":this.transectWellsView.toggleWells();break;case"#add-transect-text":this.transectTextsView.toggleTransectTexts();break;case"#add-polygon":this.polygonsView.togglePolygons();break;case"#export-data":this.dataExportView.toggleExportView();break;case"#file-system":this.fileSystemView.toggleView();break;case"#save-to-local-storage":$("#quick-save-data").foundation("reveal","open");break;case"#reload-data":$("#load-saved-data").foundation("reveal","open");break;case"#zoom-in":this.zoomIn();break;case"#zoom-out":this.zoomOut();break;case"#pan":this.enPan();break;default:}},N.prototype.zoomIn=function(){var e=this.transectApp.Paper.canvas.viewBox.baseVal;this.transectApp.BgRect.attr({width:e.width*.8,height:e.height*.8}),this.transectApp.width=Math.max(e.width*.8,this.transectApp.width),this.transectApp.height=Math.max(e.height*.8,this.transectApp.height),this.transectApp.Paper.setViewBox(e.x,e.y,e.width*.8,e.height*.8)},N.prototype.zoomOut=function(){var e=this.transectApp.Paper.canvas.viewBox.baseVal;this.transectApp.BgRect.attr({width:e.width*1.2,height:e.height*1.2}),this.transectApp.width=Math.max(e.width*1.2,this.transectApp.width),this.transectApp.height=Math.max(e.height*1.2,this.transectApp.height),this.transectApp.Paper.setViewBox(e.x,e.y,e.width*1.2,e.height*1.2)},N.prototype.enPan=function(){this.pan=!0,this.transectApp.BgRect.attr({fill:"#FFCC66","fill-opacity":.5}),this.transectApp.BgRect.toFront(),$("a[href='#pan']").parent().addClass("active")},N.prototype.disPan=function(){this.pan=!1,this.transectApp.BgRect.attr({fill:"#ffffff","fill-opacity":1}),this.transectApp.BgRect.toBack(),$("a[href='#pan']").parent().removeClass("active")},N.prototype.onDragStart=function(e,t,n){var r=this.transectApp.Paper.canvas.viewBox.baseVal;this.initX=r.x,this.initY=r.y},N.prototype.onDragMove=function(e,t,n,r,i){if(!this.pan)return;var s=this.transectApp.Paper.canvas.viewBox.baseVal;this.transectApp.BgRect.attr({x:this.initX-e,y:this.initY-t}),this.transectApp.Paper.setViewBox(this.initX-e,this.initY-t,s.width,s.height)},N.prototype.onDragEnd=function(e){},N}),requirejs.config({baseUrl:"../../",paths:{polyK:"commons/js/lib/polyK",raphael:"commons/js/lib/raphael",jszip:"commons/js/lib/jszip.min",filesaver:"commons/js/lib/FileSaver",baseView:"commons/js/views/base_view",baseModel:"commons/js/models/base_model",baseCollection:"commons/js/collections/base_collection",app:"commons/js/models/app",cursorView:"commons/js/views/cursor_view",cursor:"commons/js/models/cursor",imageView:"commons/js/views/image_view",imageOb:"commons/js/models/image",markersView:"commons/js/views/markers_view",markerView:"commons/js/views/marker_view",marker:"commons/js/models/marker",markers:"commons/js/collections/markers",transectWellsView:"transect_maker/js/views/transect_wells_view",transectWellView:"transect_maker/js/views/transect_well_view",transectWell:"transect_maker/js/models/transect_well",transectWells:"transect_maker/js/collections/transect_wells",zoneView:"commons/js/views/zone_view",zonesView:"commons/js/views/zones_view",zone:"commons/js/models/zone",zones:"commons/js/collections/zones",transectView:"transect_maker/js/views/transect_view",transectsView:"transect_maker/js/views/transects_view",transect:"transect_maker/js/models/transect",transects:"transect_maker/js/collections/transects",polygonView:"transect_maker/js/views/polygon_view",polygonsView:"transect_maker/js/views/polygons_view",polygon:"transect_maker/js/models/polygon",polygons:"transect_maker/js/collections/polygons",pointView:"transect_maker/js/views/point_view",point:"transect_maker/js/models/point",points:"transect_maker/js/collections/points",lineView:"transect_maker/js/views/line_view",line:"transect_maker/js/models/line",lines:"transect_maker/js/collections/lines",transectTextView:"transect_maker/js/views/transect_text_view",transectTextsView:"transect_maker/js/views/transect_texts_view",transectText:"transect_maker/js/models/transect_text",transectTexts:"transect_maker/js/collections/transect_texts",exporter:"transect_maker/js/utils/exporter",dataExportView:"transect_maker/js/views/data_export_view",loader:"transect_maker/js/utils/loader",dataImportView:"transect_maker/js/views/data_import_view",transectAppView:"transect_maker/js/views/transect_app_view",settings:"commons/js/models/settings",file:"file_system/js/models/file",files:"file_system/js/collections/files",fileView:"file_system/js/views/file_view",filesView:"file_system/js/views/files_view",fileSystem:"file_system/js/models/file_system",fileSystemView:"file_system/js/views/file_system_view",referenceColumnLoader:"reference_column_maker/js/utils/loader",referenceColumn:"reference_column_maker/js/models/reference_column",referenceBlock:"reference_column_maker/js/models/reference_block",referenceBlocks:"reference_column_maker/js/collections/reference_blocks",referenceBlockMarker:"reference_column_maker/js/models/reference_block_marker",referenceBlockMarkers:"reference_column_maker/js/collections/reference_block_markers",referenceBlockColumn:"reference_column_maker/js/models/reference_block_column",referenceBlockColumns:"reference_column_maker/js/collections/reference_block_columns",referenceBlockView:"reference_column_maker/js/views/reference_block_view",referenceBlockMarkerView:"reference_column_maker/js/views/reference_block_marker_view",referenceBlockColumnView:"reference_column_maker/js/views/reference_block_column_view",referenceBlockColumnsView:"reference_column_maker/js/views/reference_block_columns_view",referenceColumnSideView:"reference_column_maker/js/views/reference_column_side_view"}});var transectApp=transectApp||{};requirejs(["transectAppView"],function(e){var t=new e}),define("transect_maker/js/transect_app",function(){});